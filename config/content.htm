<h1>About</h1>
<p>課程名稱: 電腦輔助設計與實習</p>
<p>本網頁是 2025 年的電腦輔助設計與實習課程內容，相較之下 2013 年同一門課程在<a href="https://vimeo.com/tag:2013fallcadp/page:1/sort:date/format:thumbnail">上甚麼內容</a>?</p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/0reJAHMwTpw?si=Obl5dsXnErN6Qzey" title="YouTube video player" width="560"></iframe></p>
<p>Repo: <a href="https://github.com/mdecycu/cad2025">https://github.com/mdecycu/cad2025</a></p>
<p>Web: <a href="https://mde.tw/cad2025">https://mde.tw/cad2025</a> (cad for computer aided design)</p>
<p>分組示範網站: <a href="https://mde.tw/cad_demo">https://mde.tw/cad_demo</a> </p>
<p>協同設計示範網站: <a href="https://github.com/mdecycu/cd">https://github.com/mdecycu/cd</a> </p>
<p>Tutorial3:</p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/f1z9yWpLkHk?si=XwKhHIuMXbFw7v7C" title="YouTube video player" width="560"></iframe></p>
<p>Tutorial4:</p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/VPyjCJ8JhYg?si=8ofEVjulAEHaXljs" title="YouTube video player" width="560"></iframe></p>
<p>Tutorial 5: 將 SolidReference 設定在 joint3 端點的版本</p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/4n2zto1qxO8?si=xz3PaG0zsLORuxdn" title="YouTube video player" width="560"></iframe></p>
<p>Tutorial 6: <a href="https://github.com/mdecycu/fivebar_box">https://github.com/mdecycu/fivebar_box</a> </p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/HetOHdRZDH4?si=SGlHMiFwSHQ0iHCq" title="YouTube video player" width="560"></iframe></p>
<hr/>
<p><a href="https://mde.tw/cad_demo/downloads/fivebar_box.7z">fivebar_box.7z</a> (fivebar)</p>
<p><a href="https://mde.tw/cad_demo/downloads/Jansen_whitworth_mechanism.7z">Jansen_whitworth_mechanism.7z</a> (eightbar)</p>
<p><a href="https://link.springer.com/book/10.1007/978-3-032-09008-9">Let's Talk AI</a></p>
<p>課程簡介:</p>
<p style="padding-left: 30px;">cad2025 課程將以每組至多六人分組進行，從繪圖範圍 20cm x 20cm 的 <a href="https://youtu.be/iOLFP90DneY">5-bar Linkage Plotter</a> 與 <a href="https://mde.tw/cad2025/content/OpenDuck.html">Openduck mini</a> 零組件設計繪圖作為開端，各組成員可以自選 CAD 套件完成。其中 Plotter 驅動設計建議採用 NEMA 17 步進馬達 (<a href="https://cad.onshape.com/documents/5357a44dafa83155102461c8/w/dd949e9201268e32e36df4d2/e/c5d9632732f2c0ffa8979372">NEMA 17 Onshape</a>) 或自選伺服馬達進行設計繪圖，而 Openduck mini 驅動則建議採用 <a href="https://www.feetechrc.com/74v-19-kgcm-plastic-case-metal-tooth-magnetic-code-double-axis-ttl-series-steering-gear.html">STS3215 磁編碼數位伺服機</a> (<a href="https://cad.onshape.com/documents/26c83cdd49510fc094b845a1/w/1f0ebd66fbcba930fc39351f/e/19fe5ef32f086021ee8880ac?renderMode=0&amp;uiState=68c666415b74dd05454f1e34">STS3215 Onshape</a>) 進行設計繪圖。</p>
<p style="padding-left: 30px;"><a href="https://youtu.be/iOLFP90DneY">5-bar Linkage Plotter</a> 與 <a href="https://mde.tw/cad2025/content/OpenDuck.html">Openduck mini</a> 零組件設計繪圖完成後，將設法利用 <a href="https://cyberbotics.com/">Webots</a> 進行控制系統設計與動態模擬 (Dynamic Simulation)，課程最後將針對此兩項機電系統的實作進行規劃與討論。</p>
<p>可攜程式套件:</p>
<p style="padding-left: 30px;"><a href="http://229.cycu.org/portable_2026.7z">portable_2026.7z</a> (387MB)</p>
<p style="padding-left: 60px;">解開壓縮後，雙點擊 start_miniconda3.bat 啟動可攜系統，雙點擊 stop.bat 關閉可攜系統。</p>
<p style="padding-left: 60px;">可攜系統啟動後，在命令列執行 conda activate y:\envs\cmsimde 可進入能執行 CMSiMDE 的環境。</p>
<p style="padding-left: 60px;">若希望可攜系統啟動直接進入 cmsimde 環境，可將 start_miniconda3.bat 檔案中第 98 行: call "%CONDA_ROOT%\Scripts\activate.bat" %ENV_NAME% 更換為 call "%CONDA_ROOT%\Scripts\activate.bat" %Disk%:\envs\cmsimde。</p>
<p style="padding-left: 30px;"><a href="http://229.cycu.org/cad_data.7z">cad_data.7z</a> (包括 NX2312、Blender4.2 與 Webots2023b，4.2GB)</p>
<p style="padding-left: 60px;">解開壓縮檔，將 nx、Webots_2023b 與 Blender 4.2 等目錄放入可攜系統的 data 目錄中。</p>
<p style="padding-left: 60px;">在命令列執行 webotsw 可啟動 Webots，設定 NX 使用授權後，執行 ugraf -nx 可啟動 NX2312。</p>
<p style="padding-left: 60px;">Webots2023b 啟動時需要 openssl_lh_set_thunks 函式，因為這是特別的 OpenSSL 介接，其目的可能是透過此函式與 OpenSSL 整合記憶體分配、除錯、或 OpenSSL 引擎擴充。</p>
<p style="padding-left: 60px;">目前已知 miniconda 中必須透過 conda install openssl=3.0.16 安裝舊版後的 openssl-3-x64.dll 中才會包含openssl_lh_set_thunks 函式。</p>
<p style="padding-left: 30px;"><a href="https://learn.microsoft.com/zh-tw/cpp/windows/latest-supported-vc-redist?view=msvc-170">Microsoft Visual C++ 可轉散發套件</a> (<a href="https://drive.google.com/file/d/10dzQbk_OT1Cm354rnk-2_sXwRRUmDrjK/view?usp=drive_link">VC_redist.x64.exe</a>)</p>
<p>Teams 線上教學:</p>
<p style="padding-left: 30px;">以 "學號@nfu.edu.tw" 登入<span> </span><a href="https://login.microsoftonline.com/">https://login.microsoftonline.com/</a><span> </span>Office 365</p>
<p style="padding-left: 30px;">MS Teams 團隊代碼: wpv2s7j</p>
<p>課程評分:</p>
<p style="padding-left: 30px;"><span style="background-color: #ffff00;">學習心得報告 (60%)</span> - MS Teams 線上參與，6人一組每三週發表學習心得。</p>
<p style="padding-left: 60px;">w3、w7、w10、w14、w17、w18</p>
<p style="padding-left: 60px;"><span style="background-color: #ffcc99;">學習心得報告主題</span>:</p>
<p style="padding-left: 60px;">w3: 用什麼套件完成 <a href="https://youtu.be/iOLFP90DneY">5-bar Linkage Plotter</a> 與 <a href="https://mde.tw/cad2025/content/OpenDuck.html">Openduck mini</a> 零組件設計繪圖？ <a href="https://solvespace.com">Solvespace</a>, <a href="https://plm.sw.siemens.com/en-US/nx/cad-online/">Siemens NX</a>, <a href="https://www.onshape.com/en/">Onshape</a> 或其他？各有什麼優缺點？ (<a href="https://mde.tw/cad2025/downloads/plotter.7z">plotter.7z</a>, <a href="/downloads/open_duck_mini.7z">open_duck_mini.7z</a>)</p>
<p style="padding-left: 90px;">提供 <a href="https://mde.tw/cad_demo">cad_demo</a> 作為各組網站與專案設計參考</p>
<p style="padding-left: 60px;">w7 (<span style="background-color: #ccffcc;">2a 採 Youtube 影片簡報</span>): <a href="https://youtu.be/iOLFP90DneY">5-bar Linkage Plotter</a> 與 <a href="https://mde.tw/cad2025/content/OpenDuck.html">Openduck mini</a> 零組件設計繪製完成之後，如何切割零件? 為何要切割零件？ 如何利用 <a href="https://cyberbotics.com/">Webots</a> 進行後續的控制系統設計與動態模擬 (Dynamic Simulation)？(<a href="https://mde.tw/cad2025/downloads/plotter_project.7z">plotter_project.7z</a>)</p>
<p style="padding-left: 60px;">w10: <a href="https://cyberbotics.com/">Webots</a> 是什麼？有什麼特點？ 如何進行場景模擬？ 如何用 Python 進行控制系統設計？ (<a href="https://cyberbotics.com/doc/guide/tutorials">Tutorial</a>)</p>
<p style="padding-left: 60px;">w14: <a href="https://cyberbotics.com/">Webots</a> 的模型有沒有辦法用程式方法建立? 有沒有辦法直接從 CAD 套件中轉出 <a href="https://cyberbotics.com/">Webots</a> 的場景模型？</p>
<p style="padding-left: 60px;">w17: 如何實作一套 <a href="https://youtu.be/iOLFP90DneY">5-bar Linkage Plotter</a> 與 <a href="https://mde.tw/cad2025/content/OpenDuck.html">Openduck mini</a>？(<a href="https://la.disneyresearch.com/publication/design-and-control-of-a-bipedal-robotic-character/">Disney Bipedal Robot</a>)</p>
<p style="padding-left: 60px;">w18: 課程總結</p>
<p style="padding-left: 30px;"><span style="background-color: #ffff00;">個人與分組網站維護 (40%)</span> - 每週至少兩次推送與課程進度相關的學習內容與心得。</p>
<p style="padding-left: 60px;">w9 期中自評、w18 期末自評</p>
<p>實習項目:</p>
<p style="padding-left: 30px;">如何維持教室整齊清潔?</p>
<p style="padding-left: 60px;">學員定期打掃 (由助教安排) </p>
<p style="padding-left: 60px;">學員自律</p>
<p style="padding-left: 30px;">如何善用教室與工作站室硬體?</p>
<p style="padding-left: 60px;">電腦設定</p>
<p style="padding-left: 60px;">網路連線</p>
<p style="padding-left: 60px;">課餘時間預約 (由助教安排) </p>
<p style="padding-left: 30px;"><a href="https://youtu.be/iOLFP90DneY">5-bar Linkage Plotter</a> 與 <a href="https://mde.tw/cad2025/content/OpenDuck.html">Openduck mini</a> 機電系統的設計模擬與製作規劃。</p>
<p style="padding-left: 60px;"><a href="https://mde.tw/cad2025/downloads/fivebar_parallel_linkage.7z">fivebar_parallel_linkage.7z</a> (in Solidworks and NX2312)</p>
<p style="padding-left: 60px;"><a href="/downloads/plotter.7z">plotter.7z</a> (in Solvespace)</p>
<p>行事曆:</p>
<p style="padding-left: 30px;">2a 上課時段: 每週五 13:20 - 16:10 (w5 10/10 國慶日放假, w7 10/24 光復節補假, w11 11/21 全校運動會)</p>
<p style="padding-left: 30px;">2b 上課時段: 每週二 09:10 - 12:00</p>
<p><a href="https://calendar.google.com/calendar/embed?src=mde.nfu.edu.tw_3439313938333136353439%40resource.calendar.google.com&amp;ctz=Asia%2FTaipei&amp;mode=week&amp;src=mde.nfu.edu.tw_35303530373431313438%40resource.calendar.google.com&amp;ctz=Asia%2FTaipei&amp;src=yen%40gm.nfu.edu.tw&amp;ctz=Asia%2FTaipei"> 全頁檢視 </a></p>
<p><iframe height="600" src="https://calendar.google.com/calendar/embed?src=mde.nfu.edu.tw_3439313938333136353439%40resource.calendar.google.com&amp;ctz=Asia%2FTaipei&amp;mode=week&amp;src=mde.nfu.edu.tw_35303530373431313438%40resource.calendar.google.com&amp;ctz=Asia%2FTaipei&amp;src=yen%40gm.nfu.edu.tw&amp;ctz=Asia%2FTaipei" width="800"></iframe></p><h2>Mind-Map</h2>
<p><object data="/images/cad2025.svg" height="1158" type="image/svg+xml" width="1321"></object></p>
<p><a href="https://mde.tw/mind-map/#/?fileURL=https://mde.tw/cad2025/downloads/cad2025.smm">Edit cad2025.smm</a></p><h2>AI</h2>
<p><a href="https://grok.com">https://grok.com</a> </p>
<p><a href="https://chat.z.ai">https://chat.z.ai</a> </p>
<p><a href="https://chatgpt.com/">https://chatgpt.com/</a> </p>
<p><a href="https://github.com/copilot">https://github.com/copilot</a> </p>
<p><a href="https://gemini.google.com/app">https://gemini.google.com/app</a> </p>
<hr/>
<p>繪圖範圍 20cm x 20cm 的小型 5bar linkage plotter，你會建議 BOM 零組件規格如何? 請詳細說明原因。</p>
<p>https://www.feetechrc.com/products 中的各 motor 若要用在 5bar linkage plotter 專案, 選哪一個, 請詳細說明原因。</p>
<p>希望實作 Openduck mini 專案，你會建議 BOM 零組件規格如何? 請詳細說明原因。</p>
<p>5bar linkage plotter 參考 BOM:</p>
<p>採用步進馬達:</p>
<p><img caption="false" height="296" src="/images/5bar_linkage_plotter_BOM.png" width="600"/></p>
<p>採用 STS3215:</p>
<p><img alt="" height="447" src="/images/5bar_linkage_plotter_sts3215.png" width="600"/></p>
<p>Openduck mini 參考 BOM:</p>
<p>ST3215: <a href="https://aifitlab.com/products/feetech-sts3215-servo-motor">https://aifitlab.com/products/feetech-sts3215-servo-motor</a> </p>
<p><img alt="" height="544" src="/images/openduck_mini_BOM.png" width="600"/></p>
<p></p>
<hr/>
<p>提問:</p>
<p><span style="background-color: #ccffcc;">請以目前最具前瞻與權威的教育學者群觀點發言，說明機械設計相關科系的大二學生該如何學習「電腦輔助設計與實習」課程，並透過虛實整合，驗證機電資控制系統的可行性?</span></p>
<p style="padding-left: 30px;">請就此一主題，建議學習步驟，並列出學生身分可以免費使用的工具。</p>
<p style="padding-left: 30px;">請就此一主題提供 15 則可以深入取得具體答覆的 AI 系統詢問句</p>
<p style="padding-left: 60px;">1. 請詳細說明大二學生在學習 Fusion 360 進行機械零件參數化建模時，應該掌握的核心技能有哪些？<br/>2. 如何利用 Onshape 教育版進行團隊協作設計，並確保版本控制與設計一致性？<br/>3. 請列出 FreeCAD 中適合初學者進行機械運動學模擬的模組及使用步驟。<br/>4. 在機械設計課程中，使用 Fusion 360 的 Motion Study 功能進行連桿機構運動模擬，該如何設定拘束條件？<br/>5. 請解釋 Webots 如何整合機械模型與控制程式，並用具體範例說明 PID 控制在其中的應用。<br/>6. 如何用 Tinkercad Circuits 模擬一個包含光電感測器與伺服馬達的簡易自動門控制系統？<br/>7. 請比較 Scilab Xcos 與 MATLAB Simulink 在控制系統模擬上的優缺點，特別針對機電系統設計。<br/>8. 學生如何利用 Wokwi Arduino 模擬環境有效測試多感測器控制系統的穩定性與反應速度？<br/>9. 請提供一個完整的機電系統設計專案案例，從 CAD 建模到控制系統模擬，再到 Webots 虛擬測試。<br/>10. 針對學生免費使用的軟體資源，如何設計一套循序漸進的學習計畫，有效結合機械設計與控制系統？<br/>11. 如何使用 Fusion 360 與 Simscale 整合進行結構強度與熱傳模擬，以驗證機械設計的可靠性？<br/>12. 請詳細說明 Arduino IDE 與 PlatformIO 開發環境在控制系統軟體撰寫上的差異與選擇建議。<br/>13. Webots 中如何設定真實物理參數（如摩擦力、慣性矩）來提升機器人運動模擬的準確度？<br/>14. 學生若無法取得實體機器人硬體，如何利用虛擬模擬工具達成機電系統整合的實作學習？<br/>15. 請介紹目前最適合機械設計系學生免費取得的線上課程或教學平台，針對 CAD 與機電整合控制系統教學。</p>
<h3>Teams</h3>
<p>建議各組先細分為兩小組，每一小組三人，由小組長利用 <a href="https://github.com/mdecycu/cad2025_hw">https://github.com/mdecycu/cad2025_hw</a> 作為 template，建立一個協同設計練習用的倉儲，名稱定為 "team" 之後，將小組中其他兩位組員設為 collaborators，然後利用 Github Pages 中的頁面內容整合，以及 Onshape 上的 <a href="https://youtu.be/iOLFP90DneY">5-bar Linkage Plotter</a> 及 <a href="https://mde.tw/cad2025/content/OpenDuck.html">Openduck mini</a> 零組件協同設計，作為練習標的。待所有組員都充分了解如何利用 Github 與 Onshape 進行協同設計後，再由組長在 Github Classroom 中建立小組團隊。</p>
<p><a href="/downloads/cmsimde_ai_1.txt">cmsimde_ai_1.txt</a></p>
<p><a href="/downloads/協同設計流程.txt">協同設計流程.txt</a></p>
<p><a href="https://mde.tw/cad_w1">https://mde.tw/cad_w1</a> </p>
<p><img alt="" height="290" src="/images/copilot_answer_cmsimde_teams.png" width="300"/></p>
<p>本課程利用 Github Classroom 由各組組長建立 Team (團隊) 後，再由組員逐一加入團隊，每組最多 6 名組員。</p>
<p>由於各組的網站是由 6 位組員協同編輯，因此其過程的專案描述如下:</p>
<p><span style="background-color: #ffff99;">Prompt 1:</span></p>
<p><span style="background-color: #ccffcc;">目前有一個專案，透過解析 config/content.htm 檔案中 HTML 的 &lt;h1&gt;、&lt;h2&gt;、&lt;h3&gt; 標籤來進行內容分頁，並以這些標題作為靜態網站中各頁面的標題。系統根據 &lt;h1&gt;、&lt;h2&gt;、&lt;h3&gt; 的層級順序，動態建立多層次的網站導覽選單 (menu)。</span><br/><br/><span style="background-color: #ccffcc;">content.htm 的內容編輯採用 Python Flask 搭配 JavaScript 編輯器，讓使用者能在瀏覽器中即時編輯各層級頁面的內容。編輯完成後，透過 Python 程式將內容分頁並產生含多層次選單的靜態頁面，並存放於 content 目錄中。</span><br/><br/><span style="background-color: #ccffcc;">針對此一網站，若由六名組員同步協同維護，組員可選擇在本地端啟動動態編輯環境完成內容修改及靜態頁面生成，或直接利用 GitHub Codespaces 進行雲端開發。請詳述並說明在此協同編輯流程中會使用的 Git 指令與使用情境，同時指導各組員應如何有效同步作業以確保版本一致與作業流暢。</span></p>
<p><span style="background-color: #ffff99;">Prompt 2:</span></p>
<p><span style="background-color: #ccffcc;">此外，六名組員中有三人必須負責以 CAD 協同完成 「5-bar Linkage Plotter」 的設計，另三人則協同進行 「Openduck mini」 零組件的設計繪圖。六人在設計過程中需同步記錄系統開發歷程並共同維護網站內容，請提出詳細網站頁面架構的規劃建議，以及可用於協同設計的 CAD 系統，以利整合設計成果與技術文件。請用繁體中文詳細說明各組員在此電腦輔助設計工程中會分別使用的 git 指令與使用情境，並建議該如何兼顧零組件設計繪圖與網站內容整理。</span></p>
<p><span style="background-color: #ffff99;">Prompt 3:</span></p>
<p><span style="background-color: #ccffcc;">請設定組員 A 負責開發零件 A 及其相關網頁內容，組員 B 負責執行任務 B，組員 C 則負責任務 C。三位組員將同步進行各自的零組件開發工作，並分別在開發過程透過多次 git 提交維護對應的頁面 A、B 與 C。請列出每位組員在開發過程中所需使用的 Git 指令及其使用情境，並詳細說明在三項任務各自完成後，由組員 A 負責將所有成果整合至 main 分支所需的完整 Git 操作流程。同時，也請詳細說明組員 B 與 C 在整個協作過程中所需執行的 Git 指令與步驟。</span></p>
<p><span style="background-color: #ffff99;">Prompt 4:</span></p>
<p><span style="background-color: #ccffcc;"><!--StartFragment -->A, B, C 三名組員若使用 Onshape 執行同步零組件繪圖, 該如何協同整合?<!--EndFragment --></span></p>
<p><span style="background-color: #ccffcc;"></span>專案概述與協同維護流程建議</p>
<p>一、專案概述<br/><br/>本專案透過解析 config/content.htm 檔案中的 HTML 標籤 &lt;h1&gt;、&lt;h2&gt; 及 &lt;h3&gt;，實現內容分頁功能。系統將這些標題作為靜態網站中各頁面的標題，並依據標題的層級順序，動態生成多層次的網站導覽選單（Menu），以提升使用者瀏覽體驗。<br/><br/>內容編輯採用 Python Flask 框架結合 JavaScript 編輯器，讓使用者能直接在瀏覽器中編輯各層級頁面內容。完成內容編輯後，系統透過 Python 程式將分頁資料轉換為帶有多層次選單的靜態網頁，並將生成的靜態頁面存放於 content 目錄中。</p>
<p>二、協同維護環境</p>
<p>為提升協作效率，六名組員可選擇：<br/><br/>在本地端啟動動態編輯環境，進行內容修改及靜態頁面生成。<br/><br/>直接利用 GitHub Codespaces 進行遠端雲端開發與協作。</p>
<p>三、協同編輯與版本同步建議</p>
<p>針對六人團隊的同步維護，建議採用以下工作流程：</p>
<p>版本控管</p>
<p style="padding-left: 30px;">使用 Git 進行版本管理，並採用分支（Branch）策略，每位組員於獨立分支上進行內容編輯，避免直接衝突。</p>
<p>本地或雲端編輯</p>
<p style="padding-left: 30px;">組員可在本地端或 Codespaces 環境中，透過 Flask + JavaScript 編輯器進行內容更新，並執行 Python 程式生成靜態頁面以供預覽與測試。</p>
<p>提交與合併流程</p>
<p style="padding-left: 30px;">編輯完成後，組員將修改提交至個人分支並推送至遠端倉庫，透過 Pull Request (PR) 進行代碼審核與合併，確保內容品質及版本一致。</p>
<p>衝突管理與溝通協調</p>
<p style="padding-left: 30px;">由於多組員共同編輯相同檔案，需定期拉取主分支最新版本，及時解決合併衝突。團隊成員間應保持密切溝通，避免重複編輯同一內容區塊。</p>
<p>自動化測試與部署</p>
<p style="padding-left: 30px;">可結合 CI/CD 工具，於 PR 流程中自動執行靜態網站生成及測試，確保產出結果符合預期，並自動部署至測試或正式環境。</p>
<p>此工作流程能有效保障多名組員在分散開發環境下，協同完成內容維護與靜態頁面產出，提升團隊合作效率與網站品質。</p><h3>Prompts</h3>
<p>繪圖範圍 20cm x 20cm 的 5-bar Linkage Plotter, 各連桿的尺寸該如何規劃配置，請詳細說明。</p>
<p style="padding-left: 30px;"><a href="/downloads/plotter_ai_1.txt">plotter_ai_1.txt</a></p>
<p style="padding-left: 30px;"><a href="/downloads/plotter_ai_1_1.py">plotter_ai_1_1.py</a></p>
<p style="padding-left: 30px;"><a href="/downloads/plotter_ai_1_2.py">plotter_ai_1_2.py</a></p>
<p style="padding-left: 30px;"><img alt="" height="400" src="/images/5_bar_linkage_600px.gif" width="400"/></p>
<p style="padding-left: 30px;">L0=26.00, L1=18.00, L2=18.00, L3=16.00, L4=16.00</p>
<p>如何進行設計運算?包括正向運動分析與逆向運動分析。</p><h2>Homework</h2>
<p>HW1:</p>
<p style="padding-left: 30px;">利用 NX2312、<a href="https://www.onshape.com/en/">Onshape</a>、Solvespace 或自選 CAD 套件繪製五連桿機構零組件。</p>
<p style="padding-left: 60px;">參考資料: <a href="/downloads/plotter.7z">plotter.7z</a> (in Solvespace)</p>
<p style="padding-left: 30px;">利用 NX2312、<a href="https://www.onshape.com/en/">Onshape</a>、Solvespace 或自選 CAD 套件繪製 Openduck mini 系統零組件。</p>
<p>HW2:</p>
<p style="padding-left: 30px;">Webots 五連桿 plotter 機構模擬，可讀取任何 png 圖檔，利用 plotter 在其工作範圍完成外圍輪廓線條繪圖。</p>
<p style="padding-left: 30px;"><img alt="" height="300" src="/images/mickey_mouse_plot.gif" width="300"/></p>
<p style="padding-left: 60px;">參考資料: <a href="/downloads/plotter.7z">plotter.7z</a> (in Solvespace)</p>
<p style="padding-left: 60px;"><img alt="" height="300" src="/images/5bar_simulation.gif" width="300"/></p>
<p style="padding-left: 60px;"><img caption="false" height="348" src="/images/fivebar_plotter.gif" width="500"/></p>
<p style="padding-left: 60px;"><a href="/downloads/plotter_project.7z">plotter_project.7z</a></p>
<p style="padding-left: 30px;">Webots Openduck mini 系統動態模擬。</p>
<p style="padding-left: 60px;">參考資料: <a href="https://mde.tw/cad2025/content/OpenDuck.html">Openduck mini</a> </p>
<p style="padding-left: 30px;"><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/-cfIm06tcfA?si=NUajq0qNFOImgAbc" title="YouTube video player" width="560"></iframe></p>
<p>HW3:</p>
<p style="padding-left: 30px;">五連桿 plotter 與 Openduck mini 機電系統實作規劃。</p>
<p style="padding-left: 60px;">參考資料: <a href="/downloads/plotter.7z">plotter.7z</a> (in Solvespace)</p><h3>HW2</h3>
<p>一個五連桿平面機構，固定點 A 與 E 的座標分別為 (0, 0), (-50, 0), link1 從 A 點連接向 B 點長度, 為一個直角三角形的斜邊, 此三角形的長邊尺寸為 50, 短邊尺寸為 45, link2 從 B 點連接向 C 點, 長度為 110, link3 從 C 點連接向 D 點長度也是 110, 而最後 link4 從 D 點連接向 E 點 長度也是一個直角三角形的斜邊, 此三角形的長邊尺寸為 50, 短邊尺寸為 45。請問 link1 及 llink4 的長度分別為多少?<br/><br/>假設 A 點與 E 點分別裝設步進馬達, 其 A 點的旋轉角度是由其點右邊延伸水平線作為旋轉 0 度點，B 點起始點位於 X 軸上, 且旋轉方向為順時針方向, 而 E 點的旋轉角度則是由其點左邊延伸水平線作為旋轉 0 度點, D 點起始點也是位於 X 軸上, 且旋轉方向為逆時針方向旋轉, link1 的旋轉角度設為 theta1, 角度單位為 degree, 而 link4 的旋轉角度設為 theta2, 角度單位也是 degree, 請先利用此平面機構的兩個輸入角度作為函式的輸入變數, 用 link1 、link2、link3、link4 代表這四個連桿長度的符號名稱，且將此函數命名為 forward(theta1, theta2), 請利用正向運動學 (Forward Kinematics) 的方式，採符號運算法 (Symbolic Formulation)，利用 Python 的 sympy 模組, 讓 forward 函式的輸出為點 C 的 X 與 Y 座標。 請推導。 另外也請利用逆向運動學 (Inverse Kinematics) 的方式, 採符號運算法 (Symbolic Formulation)，利用 Python 的 sympy 模組, 讓 Inverse(C 點的 X 座標, C 點的 Y 座標) 函式的輸出為對應的 theta1 與 theta2 的轉角表示式。 請推導, 且各推導過程均列出機構各點的 floating point 座標點的位置.</p>
<p><a href="/downloads/fivebar_robot_2d.slvs">fivebar_robot_2d.slvs</a></p>
<p><img alt="" height="303" src="/images/fivebar_linkage_2d.png" width="300"/></p>
<p><!--StartFragment --></p>
<p>利用畢氏定理計算 link1 與 link4 的長度：</p>
<p>\[\sqrt{50^2 + 45^2} = \sqrt{2500 + 2025} = \sqrt{4525} \approx 67.27\]</p>
<p>因此定義如下:</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">import sympy as sp

L1 = L4 = sp.sqrt(45**2 + 50**2)  # ≈ 67.24
L2 = 110
L3 = 110</pre>
<p><!--StartFragment --></p>
<p>Forward Kinematics</p>
<p>目標是定義 forward(theta1, theta2) 輸出點 C 的 (x, y)。</p>
<p>幾何分析</p>
<ol>
<li>點 A 為原點 (0, 0)，link1 由 A 旋轉 \(\theta_1\) 延伸至點 B。</li>
<li>點 E 座標為 (-50, 0)，link4 由 E 旋轉 \(\theta_2\) 延伸至點 D。</li>
<li>B 與 D 透過兩段連桿（link2 與 link3）連接，經過點 C。</li>
</ol>
<p>先定義這些變數並推導 B、D、C 的位置。</p>
<p>forward 函式: <a href="/downloads/fivebar_forward.py">fivebar_forward.py</a></p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">import sympy as sp

# 正向運動學：給定角度與長度，求 C 點（兩個構型）
def forward(theta1_deg, theta2_deg, l1, l2, l3, l4):
    # 角度轉弧度，考慮旋轉方向
    theta1 = -theta1_deg * sp.pi / 180             # A 點，順時針
    theta2 = (180 + theta2_deg) * sp.pi / 180      # E 點，左水平方向起點，逆時針旋轉

    # 固定點座標
    Ax, Ay = 0, 0
    Ex, Ey = -50, 0

    # B, D 點位置
    Bx = Ax + l1 * sp.cos(theta1)
    By = Ay + l1 * sp.sin(theta1)
    Dx = Ex + l4 * sp.cos(theta2)
    Dy = Ey + l4 * sp.sin(theta2)

    # 向量 BD
    vec_x = Dx - Bx
    vec_y = Dy - By
    d = sp.sqrt(vec_x**2 + vec_y**2)

    # 中點 M
    Mx = (Bx + Dx) / 2
    My = (By + Dy) / 2

    # 高（從 M 垂直方向偏移）
    try:
        h = sp.sqrt(l2**2 - (d / 2)**2)
    except:
        raise ValueError("構型不可行：連桿無法形成三角形")

    # 單位向量 u = BD / ||BD||
    ux = vec_x / d
    uy = vec_y / d

    # 垂直向量（旋轉 90°）
    vx = -uy
    vy = ux

    # C 點 1（上構型）
    C1x = Mx + h * vx
    C1y = My + h * vy

    # C 點 2（下構型）
    C2x = Mx - h * vx
    C2y = My - h * vy

    print("B 點座標:", float(Bx.evalf()), float(By.evalf()))
    print("D 點座標:", float(Dx.evalf()), float(Dy.evalf()))
    print("C 點 1（上構型）:", float(C1x.evalf()), float(C1y.evalf()))
    print("C 點 2（下構型）:", float(C2x.evalf()), float(C2y.evalf()))

    return (float(C1x.evalf()), float(C1y.evalf())), (float(C2x.evalf()), float(C2y.evalf()))
    
print(forward(30, 45, 67.27, 110, 110, 67.27))</pre>
<p>Inverse Kinematics: <a href="/downloads/fivebar_inverse.py">fivebar_inverse.py</a></p>
<p>現在要從點 C 的座標反推出 \(\theta_1, \theta_2\)。這部分相當複雜，因為存在多組解，因此我們專注於符號推導步驟。</p>
<p>幾何觀念</p>
<ol>
<li>給定 C 點座標，要反推出：</li>
<li>B 點在以 A 為中心，半徑為 L1 的圓周上</li>
<li>D 點在以 E 為中心，半徑為 L4 的圓周上</li>
<li>B → C 與 D → C 分別長 L2, L3</li>
<li>使用向量反推、餘弦定理與 atan2 組合來求解旋轉角。</li>
</ol>
<p>Inverse Kinematics:</p>
<p><!--StartFragment --><!--EndFragment --></p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false"># 逆向運動學：輸入 C 點位置與桿長，反推所有可能的角度組合
import sympy as sp

def inverse(cx_val, cy_val, l1_val, l2_val, l3_val, l4_val):
    # 定義符號變數
    Cx, Cy, L1, L2, L3, L4 = sp.symbols('Cx Cy L1 L2 L3 L4', real=True)

    # 固定點 A 與 E
    Ax, Ay = 0, 0
    Ex, Ey = -50, 0

    # ========== θ₁（順時針，從 +X 起算） ==========
    vec_A = sp.Matrix([Cx - Ax, Cy - Ay])
    r1 = vec_A.norm()
    angle_A = sp.atan2(vec_A[1], vec_A[0])
    cos_alpha1 = (L1**2 + r1**2 - L2**2) / (2 * L1 * r1)
    cos_alpha1 = sp.Max(-1, sp.Min(1, cos_alpha1))  # 保護 acos 領域
    alpha1 = sp.acos(cos_alpha1)
    theta1_a = -sp.deg(angle_A - alpha1)
    theta1_b = -sp.deg(angle_A + alpha1)

    # ========== θ₂（逆時針，從 –X 起算） ==========
    vec_E = sp.Matrix([Cx - Ex, Cy - Ey])
    r2 = vec_E.norm()
    angle_E = sp.atan2(vec_E[1], vec_E[0])
    cos_alpha2 = (L4**2 + r2**2 - L3**2) / (2 * L4 * r2)
    cos_alpha2 = sp.Max(-1, sp.Min(1, cos_alpha2))  # 保護 acos 領域
    alpha2 = sp.acos(cos_alpha2)
    # 補回 forward 中的 +180°
    theta2_a = sp.deg(angle_E - alpha2) - 180
    theta2_b = sp.deg(angle_E + alpha2) - 180

    # 數值代入
    subs = {
        Cx: cx_val,
        Cy: cy_val,
        L1: l1_val,
        L2: l2_val,
        L3: l3_val,
        L4: l4_val
    }

    try:
        θ1a = float(theta1_a.evalf(subs=subs))
        θ1b = float(theta1_b.evalf(subs=subs))
        θ2a = float(theta2_a.evalf(subs=subs))
        θ2b = float(theta2_b.evalf(subs=subs))
    except Exception as e:
        return [f"發生錯誤：{e}"]
        
    def normalize(a):
        return round(a % 360, 4)


    # 組合所有可能構型角度
    results = [
        (normalize(θ1a), normalize(θ2a)),
        (normalize(θ1a), normalize(θ2b)),
        (normalize(θ1b), normalize(θ2a)),
        (normalize(θ1b), normalize(θ2b)),
    ]

    return results
    
print(inverse(-12.77, -117.63, 67.27, 110, 110, 67.27))</pre>
<p><br/><br/></p>
<p>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</p>
<h3>Plotter</h3>
<p dir="auto" style="white-space: pre-wrap;">To determine the drawable workspace of the five-bar linkage mechanism described in the provided Webots controller code and to outline it with a green contour, we need to compute the reachable workspace of the end-effector (point C) based on the kinematic constraints of the mechanism. Then, we will generate the outer and inner boundary contours and instruct the plotter to trace these contours. Below is the step-by-step solution.</p>
<hr/>
<h4 dir="auto">Step 1: Understanding the Five-Bar Linkage and Workspace</h4>
<p dir="auto" style="white-space: pre-wrap;">The five-bar linkage mechanism consists of two fixed points (A and E) and two actuated joints (θ1 and θ2) that control the positions of points B and D, respectively. Point C is the end-effector, determined by the intersection of two circles centered at B (radius L2) and D (radius L3). The mechanism parameters are:</p>
<ul dir="auto">
<li><strong>L1 = L4 = 0.1682 m</strong> (lengths of the first and fourth links)</li>
<li><strong>L2 = L3 = 0.275 m</strong> (lengths of the second and third links)</li>
<li><strong>A = [0.0625, 0.15] m</strong> (fixed pivot for θ1)</li>
<li><strong>E = [-0.0625, 0.15] m</strong> (fixed pivot for θ2)</li>
<li><strong>offset = 41.9872°</strong> (affects the angle calculations)</li>
</ul>
<p dir="auto" style="white-space: pre-wrap;">The workspace is the set of all possible positions of point C, constrained by the joint angles θ1 and θ2 (ranging from -180° to 180°) and the geometric constraints of the linkage. The workspace is typically an annulus-like region (a ring-shaped area) due to the fixed distances from A to B (L1), B to C (L2), E to D (L4), and D to C (L3).</p>
<h4 dir="auto">Step 2: Computing the Workspace Boundaries</h4>
<p dir="auto" style="white-space: pre-wrap;">To find the workspace, we need to determine the outer and inner boundaries of the region where point C can exist. This involves:</p>
<ul dir="auto">
<li><strong>Outer boundary</strong>: The maximum extent of point C when the linkage is fully extended.</li>
<li><strong>Inner boundary</strong>: The minimum extent when the linkage is folded inward, subject to valid kinematic solutions.</li>
</ul>
<p dir="auto" style="white-space: pre-wrap;">The workspace can be approximated by sampling the joint angles θ1 and θ2 over their range and computing the corresponding positions of point C using the forward kinematics function. The boundaries are traced by finding the extreme points (maximum and minimum radial distances from a reference point, e.g., the origin or the midpoint between A and E).</p>
<h4 dir="auto">Forward Kinematics Recap</h4>
<p dir="auto" style="white-space: pre-wrap;">The <span>forward_kinematics(theta1_rad, theta2_rad)</span> function computes point C as follows:</p>
<ol dir="auto">
<li><strong>Point B</strong>: <span>B = A + L1 * [cos(θ1 + offset), -sin(θ1 + offset)]</span></li>
<li><strong>Point D</strong>: <span>D = E - L4 * [cos(θ2 + offset), sin(θ2 + offset)]</span></li>
<li><strong>Point C</strong>: The intersection of a circle centered at B with radius L2 and a circle centered at D with radius L3. The function selects the intersection with the smaller y-coordinate (elbow-down configuration).</li>
</ol>
<h4 dir="auto">Workspace Boundary Calculation</h4>
<p dir="auto" style="white-space: pre-wrap;">To trace the workspace boundaries:</p>
<ul dir="auto">
<li><strong>Outer boundary</strong>: Occurs when the linkage is fully extended, e.g., when B and C are aligned such that the distance from A to C is maximized (approximately L1 + L2 = 0.1682 + 0.275 = 0.4432 m).</li>
<li><strong>Inner boundary</strong>: Occurs when the linkage is folded, and the distance from A to C is minimized, subject to valid intersections between the circles at B and D.</li>
</ul>
<p dir="auto" style="white-space: pre-wrap;">We can sample θ1 and θ2 over [-180°, 180°] with a fine grid (e.g., 360 points per angle) to compute all possible C points. The convex hull of these points approximates the outer boundary, while the inner boundary requires identifying configurations where the distance from a reference point (e.g., the origin) is minimized, often when the linkage is folded inward.</p>
<p dir="auto" style="white-space: pre-wrap;">To simplify, we assume the workspace is symmetric around the line connecting A and E (y = 0.15 m) due to the symmetry in L1 = L4 and L2 = L3. We compute the workspace by:</p>
<ol dir="auto">
<li>Sampling θ1 and θ2 in increments (e.g., 5°).</li>
<li>Computing C for each (θ1, θ2) pair using <span>forward_kinematics</span>.</li>
<li>Collecting valid C points (where intersections exist).</li>
<li>Determining the outer and inner boundaries by finding the maximum and minimum radial distances from a reference point (e.g., the origin [0, 0]) for each angular direction.</li>
</ol>
<h4 dir="auto">Step 3: Generating the Workspace Contours</h4>
<p dir="auto" style="white-space: pre-wrap;">To generate the outer and inner contours:</p>
<ul dir="auto">
<li><strong>Outer contour</strong>: For each angle φ around the origin (0, 0), find the C point with the maximum radial distance |C| = sqrt(x² + y²).</li>
<li><strong>Inner contour</strong>: For each angle φ, find the C point with the minimum radial distance, ensuring valid kinematic solutions.</li>
</ul>
<p dir="auto" style="white-space: pre-wrap;">The algorithm to compute the contours is as follows:</p>
<ol dir="auto">
<li>Define a range of angles φ (0 to 360°, e.g., 360 points).</li>
<li>For each φ, iterate over a grid of θ1 and θ2 values (e.g., 72 points each, 5° increments).</li>
<li>Compute C for each (θ1, θ2) using <span>forward_kinematics</span>.</li>
<li>Calculate the radial distance |C| and the angle of C relative to the origin.</li>
<li>Group C points by their angle φ (within a small tolerance, e.g., ±2.5°).</li>
<li>Select the maximum (outer) and minimum (inner) |C| for each φ bin.</li>
<li>Sort the points by φ to create smooth contours.</li>
</ol>
<h4 dir="auto">Step 4: Plotting the Contours in Webots</h4>
<p dir="auto" style="white-space: pre-wrap;">The provided code already includes a mechanism to draw a green line in Webots using an <span>IndexedLineSet</span>. We will modify this to draw two separate contours (outer and inner) in green, ensuring they are closed loops if the workspace is continuous.</p>
<h4 dir="auto">Step 5: Sweeping the Contours with the Plotter</h4>
<p dir="auto" style="white-space: pre-wrap;">To make the plotter trace the outer and inner contours:</p>
<ol dir="auto">
<li>Use the <span>inverse_kinematics</span> function to compute (θ1, θ2) for each point on the outer and inner contours.</li>
<li>Apply the same interpolation and control logic as in the original code to move the plotter along each contour sequentially.</li>
<li>Ensure smooth transitions between points using linear interpolation in joint space, as done in the original code.</li>
</ol>
<h4 dir="auto">Implementation</h4>
<p dir="auto" style="white-space: pre-wrap;">Below is the modified code to compute the workspace boundaries, draw the green contours, and control the plotter to trace both contours. This code extends the original by adding workspace computation and contour tracing.</p>
<h1>Topics</h1>
<p><a href="https://www.engineering.com/what-is-siemens-designcenter/">https://www.engineering.com/what-is-siemens-designcenter/</a> (有關現階段各家 CAD 公司所提供的中階與高階電腦輔助機械設計套件，以及 Siemsns 就未來 CAD 發展方向的描述)</p>
<p>2b:</p>
<p style="padding-left: 30px;">w1: 課程簡介、分組與每三週分組心得簡報規劃</p>
<p>2a:</p>
<p style="padding-left: 30px;">w1:</p>
<p style="padding-left: 30px;">5bar linkage Plotter 設計參考:</p>
<p style="padding-left: 30px;"><a href="https://github.com/mdecycu/Pentagonal_plotting_robot_repo">https://github.com/mdecycu/Pentagonal_plotting_robot_repo</a> </p>
<p style="padding-left: 30px;"><a href="https://github.com/mdecycu/five_bar_linkage">https://github.com/mdecycu/five_bar_linkage</a> </p>
<p style="padding-left: 30px;"><a href="https://github.com/mdecycu/Robot-Sketcher-5-bar-parallel-manipulator-">https://github.com/mdecycu/Robot-Sketcher-5-bar-parallel-manipulator-</a> </p>
<p style="padding-left: 30px;"><a href="https://github.com/mdecycu/Inverse-Kinematics-Five-Bar">https://github.com/mdecycu/Inverse-Kinematics-Five-Bar</a> </p>
<p style="padding-left: 30px;"><a href="/downloads/5-Bar Linkage Kinematic Solver and Simulator.pdf">5-Bar Linkage Kinematic Solver and Simulator.pdf</a></p>
<p style="padding-left: 30px;">提筆設計:</p>
<p style="padding-left: 60px;">整體機構以 Watts linkage 提升及下降</p>
<p style="padding-left: 60px;">整體機構以凸輪機構提升，以彈簧拉回下降</p>
<p style="padding-left: 60px;">筆座採電磁鐵上升，以彈簧拉回下降</p>
<p style="padding-left: 60px;">繪圖機構總成固定，繪圖區域升降</p>
<p style="padding-left: 60px;">採用其他設計，討論各種設計的優缺點</p>
<p>開啟 Webots 時出現以下錯誤:</p>
<p><img alt="" height="112" src="/images/Webots_openssl_error.png" width="300"/></p>
<p>Webots2023b 啟動時需要 openssl_lh_set_thunks 函式，因為這是特別的 OpenSSL 介接，其目的可能是透過此函式與 OpenSSL 整合記憶體分配、除錯、或 OpenSSL 引擎擴充。</p>
<p>目前已知 miniconda 中必須透過 conda install openssl=3.0.16 安裝舊版後的 openssl-3-x64.dll 中才會包含openssl_lh_set_thunks 函式。</p>
<p>因此在命令列執行: <span>conda install openssl=3.0.16 就可以避開上列錯誤。</span></p>
<p><span>另外執行 <a href="https://mde.tw/cad2025/downloads/plotter_project.7z">plotter_project.7z</a> 中 Python 控制程式需要 numpy 套件，可以透過 conda install -c conda-forge numpy 安裝。</span></p>
<p>w2:</p>
<p style="padding-left: 30px;">除了使用 miniconda3 建立可攜 Python 環境外，也可以使用 <a href="http://229.cycu.org/Py310_cmsimde_numpy.7z">Py310_cmsimde_numpy.7z</a>。</p>
<p style="padding-left: 30px;">登入 Onshape 後，連線至 <a href="https://cad.onshape.com/documents/64074dfcfa379b37d8a47762/w/3650ab4221e215a4f65eb7fe/e/0505c262d882183a25049d05">OpenDuck mini v2 官方 Onshape</a> 後，以滑鼠左鍵點選畫面左上方的功能表，點選 Copy workspace 後，選擇 Document name，滑鼠點選 Copy document to 中的 Owned by me，再點選下方的 Open 後，就可以取得 OpenDuck workspace 的副本。</p>
<p style="padding-left: 30px;">CAD 參考資料:</p>
<p style="padding-left: 60px;"><a href="https://cad.onshape.com/help/zh_TW/Content/Primer/onshape_primer.htm">Onshape 入門指南</a></p>
<p style="padding-left: 60px;"><a href="https://github.com/andyeske/How-to-CAD-Onshape">https://github.com/andyeske/How-to-CAD-Onshape</a> </p>
<p style="padding-left: 60px;"><a href="https://ocw.mit.edu/courses/res-16-002-how-to-cad-almost-anything-january-iap-2024/">How to CAD almost anything</a></p>
<p style="padding-left: 60px;"><a href="/downloads/CAD_for_college.pdf">CAD_for_college.pdf</a></p>
<p style="padding-left: 60px;"><a href="https://sites.google.com/jgranger.online/onshape-learning-projects/projects">Onshape learning projects</a></p>
<p style="padding-left: 30px;">相同方式取得 <a href="https://cad.onshape.com/documents/9ebaa0fe12e0330fda26ad1a/w/7f1387b419b76633fa18bb67/e/481736ea99c3f255005c25d1?renderMode=0&amp;uiState=68c82a004a4d6d69ba820d0b">Plotter 馬達與固定盒</a>副本，了解如何使用 Onshape 設計變數(Variable)，如何在 Part Studio 建立 Parts 備用，以及如何從 Part Studio 導入零件進行組立。</p>
<p style="padding-left: 30px;">各組組員請分別練習在 Solvespace、NX2312 與 Openshape 上進行零件繪圖與組立，其中將牽涉使用各不同套件的繪圖與組立指令，並且必須了解如何透過不同零組件檔案格式(<a href="https://www.capvidia.com/blog/best-step-file-to-use-ap203-vs-ap214-vs-ap242">STEP424</a>、<a href="https://en.wikipedia.org/wiki/Parasolid">Parasolid</a>、<a href="https://en.wikipedia.org/wiki/STL_(file_format)">STL</a> 等)進行轉檔。</p>
<p><img caption="false" height="305" src="/images/cad2025_openduck_trunk.png" width="400"/></p>
<p>Openduck mini v2 的 trunk_bottom (下軀幹) 組立，其中包括 roll_motor_bottom x 2 以及 STS3250 次組立 x 2。<a href="/downloads/cad2025_openduck_Mechanical_Parts_2.7z">cad2025_openduck_Mechanical_Parts_2.7z</a></p>
<p>接下來，請各組員設法將下軀幹兩側的 left_roll_to_pitch 以及 right_roll_to_pitch 零件組立後，分工進行 <a href="https://cyberbotics.com/doc/guide/tutorials">Webots Tutorial</a> 後，設法將組立件轉進 Webots，並利用 Python 控制程式讓兩側的 roll_to_pitch 可以由 STS3250 進行驅動。</p>
<p>另外，除了使用 miniconda3 建立 Python env 外，也可以使用 <a href="/downloads/gen_portable_python.py">gen_portable_python.py</a> 建立可攜 Python 環境。</p>
<p>NXOpen Python 範例:</p>
<p style="padding-left: 30px;"><a href="/downloads/nxopen_ex/cd2024_2b_g6_steel_ball_platform_nxopen.7z">cd2024_2b_g6_steel_ball_platform_nxopen.7z</a></p>
<p style="padding-left: 30px;"><a href="/downloads/nxopen_ex/cd2024_platform_nxopen_assembly_ex.7z">cd2024_platform_nxopen_assembly_ex.7z</a></p>
<p style="padding-left: 30px;"><a href="/downloads/nxopen_ex/nxopen_create_a_new_part.py">nxopen_create_a_new_part.py</a></p>
<p style="padding-left: 30px;"><a href="/downloads/nxopen_ex/nxopen_new_part_line_by_line_comment.py">nxopen_new_part_line_by_line_comment.py</a></p>
<p>w3: 各組員分別用甚麼套件進行零組件繪圖? 如何分工協同? 設計流程進行得如何? 設計尺寸該如何訂定?</p>
<p style="padding-left: 30px;"><a href="/downloads/A_Method_for_Optimal_Kinematic_Design_of_Five-bar_Planar_Parallel_Manipulators.pdf">A_Method_for_Optimal_Kinematic_Design_of_Five-bar_Planar_Parallel_Manipulators.pdf</a></p>
<p style="padding-left: 30px;"><a href="/downloads/optimal_synthesis_of_five-bar_linkage_based_on_singularity-free_workspaces_with_predefined_shapes.pdf">optimal_synthesis_of_five-bar_linkage_based_on_singularity-free_workspaces_with_predefined_shapes.pdf</a></p>
<p style="padding-left: 30px;"><a href="/downloads/plotter_ex/prompt_and_result1.py">prompt_and_result1.py</a></p>
<p style="padding-left: 30px;"><a href="/downloads/plotter_ex/prompt_and_result2_14x14.py">prompt_and_result2_14x14.py</a></p>
<p style="padding-left: 30px;"><a href="/downloads/plotter_ex/prompt_and_result2_20x20.py">prompt_and_result2_20x20.py</a></p>
<hr/>
<p>電腦輔助設計室電腦硬體與網路使用介紹</p>
<p style="padding-left: 30px;">C 槽硬碟為 SSD，網路協定可以自行決定使用 IPv4 或 IPv6 (若使用純 IPv6 則必須設定 Proxy 才能連結到 github.com 以及僅支援 IPv4 協定的網站) </p>
<p>Teams 線上教學:</p>
<p style="padding-left: 30px;">以 "學號@nfu.edu.tw" 登入<span> </span><a href="https://login.microsoftonline.com/">https://login.microsoftonline.com/</a><span> </span>Office 365</p>
<p style="padding-left: 30px;">Teams 團隊代碼: wpv2s7j</p>
<p>下載可攜程式套件:</p>
<p style="padding-left: 30px;"><a href="http://229.cycu.org/portable_2026.7z">portable_2026.7z</a> (387MB)</p>
<p style="padding-left: 60px;">解開壓縮後，雙點擊 start_miniconda3.bat 啟動可攜系統，雙點擊 stop.bat 關閉可攜系統。</p>
<p style="padding-left: 60px;">可攜系統啟動後，在命令列執行 conda activate y:\envs\cmsimde 可進入能執行 CMSiMDE 的環境。</p>
<p style="padding-left: 60px;">若希望可攜系統啟動直接進入 cmsimde 環境，可將 start_miniconda3.bat 檔案中第 98 行: call "%CONDA_ROOT%\Scripts\activate.bat" %ENV_NAME% 更換為 call "%CONDA_ROOT%\Scripts\activate.bat" %Disk%:\envs\cmsimde。</p>
<p style="padding-left: 30px;"><a href="http://229.cycu.org/cad_data.7z">cad_data.7z</a> (包括 NX2312、Blender4.2 與 Webots2023b，4.2GB)</p>
<p style="padding-left: 60px;">解開壓縮檔，將 nx、Webots_2023b 與 Blender 4.2 等目錄放入可攜系統的 data 目錄中。</p>
<p style="padding-left: 60px;">在命令列執行 webotsw 可啟動 Webots，設定 NX 使用授權後，執行 ugraf -nx 可啟動 NX2312。</p>
<p style="padding-left: 60px;">Webots2023b 啟動時需要 openssl_lh_set_thunks 函式，因為這是特別的 OpenSSL 介接，其目的可能是透過此函式與 OpenSSL 整合記憶體分配、除錯、或 OpenSSL 引擎擴充。</p>
<p style="padding-left: 60px;">目前已知 miniconda 中必須透過 conda install openssl=3.0.16 安裝舊版後的 openssl-3-x64.dll 中才會包含openssl_lh_set_thunks 函式。</p>
<p style="padding-left: 30px;"><a href="https://learn.microsoft.com/zh-tw/cpp/windows/latest-supported-vc-redist?view=msvc-170">Microsoft Visual C++ 可轉散發套件</a> (<a href="https://drive.google.com/file/d/10dzQbk_OT1Cm354rnk-2_sXwRRUmDrjK/view?usp=drive_link">VC_redist.x64.exe</a>)</p>
<p>1. 複習如何開啟可攜套件、關閉可攜套件</p>
<p style="padding-left: 30px;">尚未有 Github 帳號者，必須自行<a href="https://docs.github.com/zh/get-started/start-your-journey/creating-an-account-on-github">建立 Github 帳號</a></p>
<p style="padding-left: 30px;">利用 Python 執行設計運算、組立件分割、控制機電系統並維護倉儲與網站內容</p>
<p style="padding-left: 60px;"><a href="/downloads/youbot_cart.7z">youbot_cart.7z</a></p>
<p style="padding-left: 90px;">命令列中執行 webotsw 啟動 Webots</p>
<p style="padding-left: 90px;">開啟 worlds 目錄中的 youbot_cart.wbt (執行控制程式後，以方向鍵控制 cart 移動)</p>
<p style="padding-left: 90px;">開啟 worlds 目錄中的 youbot_cart_w_shooter.wbt (按 a 送球，按 m 擊球，按 k 退回)</p>
<p style="padding-left: 30px;">說明如何建立分組倉儲 Template</p>
<p>2. 如何開啟 Solvespace、NX2312、Webots 與 Blender</p>
<p style="padding-left: 30px;">利用 Solvespace、NX2312 或 Onshape 進行零組件繪圖</p>
<p style="padding-left: 60px;"><a href="https://solvespace.com/tutorial.pl">Solvespace Tutorial</a></p>
<p style="padding-left: 90px;"><a href="https://youtu.be/vBNAIMiomls">Learn Solvespace</a></p>
<p style="padding-left: 60px;"><a href="https://www.youtube.com/playlist?list=PLA2s9EGiTDWBuUE55TRoueZdhaFWxWSl4">NX2312 Tutorial</a></p>
<p style="padding-left: 60px;"><a href="https://www.onshape.com/en/education/">Onshape for Education</a></p>
<p style="padding-left: 30px;">利用 Webots 建立機電模擬系統 (<a href="https://cyberbotics.com/doc/guide/index">User Guide</a>)</p>
<p style="padding-left: 60px;"><a href="https://cyberbotics.com/doc/guide/tutorials">Webots Tutorial</a></p>
<p style="padding-left: 30px;">利用 Blender 檢視組立件分割結果</p>
<p style="padding-left: 60px;"><a href="https://youtu.be/4haAdmHqGOw">Blender Tutorial</a></p>
<p>3. Github Classroom 上的分組網站: <a href="https://github.com/mdecad2025">https://github.com/mdecad2025</a> </p>
<p style="padding-left: 30px;">各組組長建立 Github Classroom 分組團隊，取得分組倉儲 </p>
<p>4. 利用 Git 與 Github 進行協同設計</p>
<p style="padding-left: 30px;">各組員維護分組倉儲中的分支，進行協同設計</p>
<p style="padding-left: 30px;">熟悉 Pull Requests 或各組員開發分支與主分支的合併</p>
<p>5. 平面五連桿機構零組件繪圖</p>
<p style="padding-left: 30px;">Solvespace、NX2312 與 Onshape 的操作應用</p>
<p>6. Webots 五連桿機構系統模擬</p>
<p style="padding-left: 30px;">零組件的 STL 與 OBJ 格式轉檔</p>
<p style="padding-left: 30px;">Blender 的零組件檢視應用</p>
<p style="padding-left: 30px;">Robot、Solid、Shape、CadShape、HingeJoint 與 device 節點的應用</p>
<p style="padding-left: 30px;">Python Controller 程式的應用</p>
<p>參考: </p>
<p style="padding-left: 30px;"><a href="http://wcm.cycu.org:88/github/cad2024/content/CAD.html">http://wcm.cycu.org:88/github/cad2024/content/CAD.html</a> </p>
<p style="padding-left: 30px;"><a href="https://github.com/mdecycu/pymadcad">https://github.com/mdecycu/pymadcad</a> </p><h2>Network</h2>
<p>這裡所指的 Network 是 Computer Network，電腦網路可說是目前電腦輔助設計流程的基礎設施，許多輔助設計的軟體透過電腦網路執行認證、協同設計或及時擷取資源。因此進行電腦輔助設計流程之前，必須對所依附使用的電腦網路系統與架構有所了解。</p>
<p>IPv6 網路位址分配:</p>
<p style="padding-left: 30px;"><a href="/downloads/network_setup.7z">network_setup.7z</a></p>
<p style="padding-left: 30px;">2b 分配名單: <a href="/downloads/cad_2b_ipv6_address.txt">cad_2b_ipv6_address.txt</a></p>
<p><a href="https://en.wikipedia.org/wiki/Computer_network">Computer Network</a>:</p>
<p>A<span> </span><b>computer network</b><span> </span>is a collection of communicating<span> </span><a href="https://en.wikipedia.org/wiki/Computer" title="Computer">computers</a><span> </span>and other devices, such as printers and smart phones. In order to communicate, the computers and devices must be connected by wired media like copper cables,<span> </span><a class="mw-redirect" href="https://en.wikipedia.org/wiki/Optical_fibers" title="Optical fibers">optical fibers</a>, or by<span> </span><a class="mw-redirect" href="https://en.wikipedia.org/wiki/Wireless_communication" title="Wireless communication">wireless communication</a>. The devices may be connected in a variety of<span> </span><a class="mw-redirect" href="https://en.wikipedia.org/wiki/Network_topologies" title="Network topologies">network topologies</a>. In order to communicate over the network, computers use agreed-on rules, called<span> </span><a href="https://en.wikipedia.org/wiki/Communication_protocol" title="Communication protocol">communication protocols</a>, over whatever medium is used.</p>
<p>The computer network can include<span> </span><a href="https://en.wikipedia.org/wiki/Personal_computer" title="Personal computer">personal computers</a>,<span> </span><a href="https://en.wikipedia.org/wiki/Server_(computing)" title="Server (computing)">servers</a>,<span> </span><a href="https://en.wikipedia.org/wiki/Networking_hardware" title="Networking hardware">networking hardware</a>, or other specialized or general-purpose<span> </span><a href="https://en.wikipedia.org/wiki/Host_(network)" title="Host (network)">hosts</a>. They are identified by<span> </span><a href="https://en.wikipedia.org/wiki/Network_address" title="">network addresses</a><span> </span>and may have<span> </span><a href="https://en.wikipedia.org/wiki/Hostname" title="Hostname">hostnames</a>. Hostnames serve as memorable labels for the nodes and are rarely changed after initial assignment. Network addresses serve for locating and identifying the nodes by communication protocols such as the<span> </span><a href="https://en.wikipedia.org/wiki/Internet_Protocol" title="Internet Protocol">Internet Protocol</a>.</p><h2>ICMP</h2>
<p>Allow ping ICMPv4 powershell:</p>
<pre class="brush:js;auto-links:false;toolbar:false" contenteditable="false"># Allow inbound ICMPv4 Echo Request (ping)
New-NetFirewallRule -Name "Allow ICMPv4-In" -DisplayName "Allow ICMPv4-In" -Protocol ICMPv4 -IcmpType 8 -Direction Inbound -Action Allow</pre>
<p>ICMPv6:</p>
<pre class="brush:js;auto-links:false;toolbar:false" contenteditable="false"># Allow inbound ICMPv6 Echo Request (ping)
New-NetFirewallRule -Name "Allow ICMPv6-In" -DisplayName "Allow ICMPv6-In" -Protocol ICMPv6 -IcmpType 128 -Direction Inbound -Action Allow</pre>
<p>允許 ICMP/ICMPv6 的安全性考量<br/><br/>ICMP（包括 ICMPv6）不只是用於 ping，它對許多網路功能來說都是必要的，尤其是在 IPv6 環境下。不過，開放 ICMP/ICMPv6 仍然會帶來一些安全性疑慮：<br/><br/>對於 IPv4（ICMP）：<br/><br/>- 攻擊者可以利用 ICMP 進行：<br/>    - 偵查：發現存活主機（ping 掃描）。<br/>    - 淹水攻擊：ICMP flood（阻斷服務攻擊）。<br/>    - 網路映射：例如透過 traceroute 等工具。<br/>- 緩解方式：通常會限制 ICMP 類型（如僅允許 Echo Request/Reply），或限制來源 IP，或進行流量速率限制。<br/><br/>對於 IPv6（ICMPv6）：<br/><br/>- ICMPv6 對於 IPv6 的運作至關重要！<br/>    - 它支援鄰居探索、路徑 MTU 探查，以及位址自動設定。<br/>    - 若封鎖 ICMPv6，可能會導致 IPv6 無法正常運作，因為路由器與主機都仰賴 ICMPv6 完成這些基本功能。<br/>- 安全性疑慮：<br/>    - 偵查：攻擊者仍可發現 IPv6 主機與網段。<br/>    - 潛在濫用：例如 ICMPv6 flood，或偽造鄰居請求（Neighbor Solicitation spoofing）。<br/>- 緩解方式：<br/>    - 不要完全封鎖 ICMPv6，而是只允許必要的訊息類型（如 128/129 為 Echo、133-136 為鄰居探索等）。<br/>    - 考慮使用流量速率限制與監控。<br/>    - 檢查防火牆的預設規則——Windows 及現代防火牆通常對 ICMPv6 已有安全的預設值。</p>
<h2>IPv6</h2>
<p>IPv6 網路協定是用來解決 IPv4 網路不敷使用的問題而產生。但是目前許多伺服器尚未全面支援 IPv6 網路協定，其原因很多，其中包括使用者欠缺對於 IPv6 網路協定的認識，或者因為伺服器上的用戶程式並未做好支援 IPv6 的準備。無論如何當決定在電腦輔助設計流程使用 IPv6 網路協定後，必須設法因應各種問題，讓採純 IPv6 網路協定設計的環境能夠連線至各個伺服器。</p>
<p><a href="https://en.wikipedia.org/wiki/IPv6">IPv6</a>: </p>
<p><b>Internet Protocol version 6</b><span><span> </span>(</span><b>IPv6</b><span>) is the most recent version of the<span> </span></span><a href="https://en.wikipedia.org/wiki/Internet_Protocol" title="Internet Protocol">Internet Protocol</a><span><span> </span>(IP), the<span> </span></span><a href="https://en.wikipedia.org/wiki/Communication_protocol" title="Communication protocol">communications protocol</a><span><span> </span>that provides an identification and location system for computers on networks and routes traffic across the<span> </span></span><a href="https://en.wikipedia.org/wiki/Internet" title="Internet">Internet</a><span>. IPv6 was developed by the<span> </span></span><a href="https://en.wikipedia.org/wiki/Internet_Engineering_Task_Force" title="Internet Engineering Task Force">Internet Engineering Task Force</a><span><span> </span>(IETF) to deal with the long-anticipated problem of<span> </span></span><a href="https://en.wikipedia.org/wiki/IPv4_address_exhaustion" title="IPv4 address exhaustion">IPv4 address exhaustion</a><span>, and was intended to replace<span> </span></span><a href="https://en.wikipedia.org/wiki/IPv4" title="IPv4">IPv4</a><span>.</span><span><span> </span>In December 1998, IPv6 became a Draft Standard for the IETF,</span><span><span> </span>which subsequently ratified it as an<span> </span></span><a href="https://en.wikipedia.org/wiki/Internet_Standard" title="Internet Standard">Internet Standard</a><span><span> </span>on 14 July 2017.</span></p>
<h2>DNS</h2>
<p>DNS 指的是 <a href="https://en.wikipedia.org/wiki/Domain_Name_System">Domain Name System</a>:</p>
<p><span>The </span><b>Domain Name System</b><span><span> </span>(</span><b>DNS</b><span>) is a hierarchical and distributed<span> </span></span><a class="mw-redirect" href="https://en.wikipedia.org/wiki/Name_service" title="Name service">name service</a><span><span> </span>that provides a naming system for<span> </span></span><a href="https://en.wikipedia.org/wiki/Computer" title="Computer">computers</a><span>, services, and other resources on the Internet or other<span> </span></span><a href="https://en.wikipedia.org/wiki/Internet_Protocol" title="Internet Protocol">Internet Protocol</a><span><span> </span>(IP) networks. It associates various information with<span> </span></span><i><a href="https://en.wikipedia.org/wiki/Domain_name" title="">domain names</a></i><span><span> </span>(</span><a href="https://en.wikipedia.org/wiki/Identification_(information)" title="Identification (information)">identification</a><span><span> </span></span><a href="https://en.wikipedia.org/wiki/String_(computer_science)" title="String (computer science)">strings</a><span>) assigned to each of the associated entities. Most prominently, it translates readily memorized domain names to the numerical<span> </span></span><a href="https://en.wikipedia.org/wiki/IP_address" title="IP address">IP addresses</a><span><span> </span>needed for locating and identifying computer services and devices with the underlying<span> </span></span><a class="mw-redirect" href="https://en.wikipedia.org/wiki/Network_protocol" title="Network protocol">network protocols</a><span>.</span><sup class="reference" id="cite_ref-1"><a href="https://en.wikipedia.org/wiki/Domain_Name_System#cite_note-1"><span class="cite-bracket">[</span>1<span class="cite-bracket">]</span></a></sup><span><span> </span>The Domain Name System has been an essential component of the functionality of the Internet since 1985.</span></p>
<h2>Proxy</h2>
<p><a href="https://www.squid-cache.org/">https://www.squid-cache.org/</a> </p>
<p>/etc/squid/squid.con 檔案設定:</p>
<pre class="brush:js;auto-links:false;toolbar:false" contenteditable="false">acl cad_lab src 140.130.XX.0/24
acl cad_lab src 2001:288:6004:XX::/64
 
acl SSL_ports port 5443
acl SSL_ports port 8843

acl SSL_ports port 443
acl Safe_ports port 80 # http
acl Safe_ports port 88
acl Safe_ports port 23020
acl Safe_ports port 1234
acl Safe_ports port 1235
 
#acl Safe_ports port 21 # ftp
acl SSL_ports port 8443
acl Safe_ports port 8443
 
acl SSL_ports port 9443
acl Safe_ports port 9443
 
acl SSL_ports port 22
acl Safe_ports port 22
acl todomainorg dstdomain .domain.org

# add password to access
auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/password
auth_param basic realm proxy
 
acl Safe_ports port 443 # https
acl Safe_ports port 1025-65535 # unregistered ports
acl Safe_ports port 280 # http-mgmt
acl Safe_ports port 488 # gss-http
acl Safe_ports port 591 # filemaker
acl Safe_ports port 777 # multiling http
acl CONNECT method CONNECT

http_access allow cad_lab
# setup acl for authentication
acl squid_user proxy_auth REQUIRED
 
http_access allow todomainorg

# Deny requests to certain unsafe ports
http_access deny !Safe_ports
 
# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports
 
# all connection need authentication
http_access allow squid_user
#http_access deny all

#http_access allow cad_lab
#http_access deny all

# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager
 
#http_access allow localnet
http_access allow localhost
 
# And finally deny all other access to this proxy
http_access deny all
 
# Squid normally listens to port 3128
http_port 3128
 
#cache_dir ufs /var/spool/squid 100 16 256
icp_port 3130
icp_access allow all
 
cache_dir ufs /var/spool/squid 2000 16 256
#cache_peer 140.130.XX.7 sibling 3128 3130
cache_peer 2001:288:6004:XX::4 parent 3128 3130 default
cache_peer 2001:288:6004:XX::42 sibling 3128 3130
cache_peer 2001:288:6004:XX::69 sibling 3128 3130
cache_peer 2001:288:6004:XX::53 sibling 3128 3130
cache_peer 2001:288:6004:XX::3  sibling 3128 3130

 
#
# Add any of your own refresh_pattern entries above these.
#
refresh_pattern ^ftp: 1440 20% 10080
refresh_pattern ^gopher: 1440 0% 1440
refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
refresh_pattern (Release|Packages(.gz)*)$ 0 20% 2880
refresh_pattern . 0 20% 4320
</pre>
<p>Ubuntu 系統更新指令:</p>
<p>ssh <a href="mailto:account@server">account@server</a></p>
<p>sudo apt update</p>
<p>sudo atp upgrade</p>
<p>sudo apt autoremove</p>
<p></p>
<h2>Web</h2>
<p>wcm:88 nginx.conf 設定檔案:</p>
<pre class="brush:js;auto-links:false;toolbar:false" contenteditable="false">#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';

    #access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

    server {
        listen       [::]:80 default ipv6only=on;
        server_name  wcm.domain.org;
        return       301 https://$server_name$request_uri;
        
        allow 140.130.XX.0/24;
        allow 2001:288:6004:XX::0/32;
        deny all;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        #location / {
            #root   html;
            #index  index.html index.htm;
        #}

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        #error_page   500 502 503 504  /50x.html;
        #location = /50x.html {
            #root   html;
        #}

        # proxy the PHP scripts to Apache listening on 127.0.0.1:80
        #
        #location ~ \.php$ {
        #    proxy_pass   http://127.0.0.1;
        #}

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        #location ~ \.php$ {
        #    root           html;
        #    fastcgi_pass   127.0.0.1:9000;
        #    fastcgi_index  index.php;
        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
        #    include        fastcgi_params;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #    deny  all;
        #}
    }
    
       server {
        listen       [::]:88 ipv6only=off;
        listen       88;
        
        allow 140.130.XX.0/24;
        allow 2001:288:6004:XX::0/32;
        deny all;
        
        location / {
            root C:/server/nginx-1.20.2/spring2022;
            charset utf-8;
        }
        
        location /i {
            alias i:/;
        }
        
        autoindex on;
    }


    # another virtual host using mix of IP-, name-, and port-based configuration
    #
    #server {
    #    listen       8000;
    #    listen       somename:8080;
    #    server_name  somename  alias  another.alias;

    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}


    # HTTPS server
    #
    #server {
    #    listen       443 ssl;
    #    server_name  localhost;

    #    ssl_certificate      cert.pem;
    #    ssl_certificate_key  cert.key;

    #    ssl_session_cache    shared:SSL:1m;
    #    ssl_session_timeout  5m;

    #    ssl_ciphers  HIGH:!aNULL:!MD5;
    #    ssl_prefer_server_ciphers  on;

    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}

}
</pre>
<p>229 nginx.conf 設定檔案:</p>
<pre class="brush:js;auto-links:false;toolbar:false" contenteditable="false">#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';

    #access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

    server {
        # allow IPv4 and IPv6 to downloa files with specified URL
        listen        80;
        listen [::]:80;
        server_name  229.domain.org;
        root C:\\Users\\server\\files\\2024_spring;
        
        auth_basic "Restricted Content";
        auth_basic_user_file C:\\Users\\server\\files\\nginx-1.24.0\\conf\\.htpasswd;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
            # if set the root to html, only the index file type can be accessed
            #root   html;
            index  index.html index.htm;
        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

        # proxy the PHP scripts to Apache listening on 127.0.0.1:80
        #
        #location ~ \.php$ {
        #    proxy_pass   http://127.0.0.1;
        #}

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        #location ~ \.php$ {
        #    root           html;
        #    fastcgi_pass   127.0.0.1:9000;
        #    fastcgi_index  index.php;
        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
        #    include        fastcgi_params;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #    deny  all;
        #}
    }


    # another virtual host using mix of IP-, name-, and port-based configuration
    #
    #server {
    #    listen       8000;
    #    listen       somename:8080;
    #    server_name  somename  alias  another.alias;

    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}


    # HTTPS server
    #
    #server {
    #    listen       443 ssl;
    #    server_name  localhost;

    #    ssl_certificate      cert.pem;
    #    ssl_certificate_key  cert.key;

    #    ssl_session_cache    shared:SSL:1m;
    #    ssl_session_timeout  5m;

    #    ssl_ciphers  HIGH:!aNULL:!MD5;
    #    ssl_prefer_server_ciphers  on;

    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}

}
</pre>
<p></p>
<h3>Codespaces</h3>
<p><a href="https://github.com/codespaces">https://github.com/codespaces</a> </p>
<h1>Software</h1>
<p>這裡的 Software 指的是電腦軟體，執行電腦輔助設計時會接觸電腦操作系統、電腦輔助設計套件以及全球資訊網相關的各種應用軟體。</p>
<p><a href="https://en.wikipedia.org/wiki/Software">Software</a>:</p>
<p>The history of software is closely tied to the development of digital computers in the mid-20th century. Early programs were written in the<span> </span><a class="mw-redirect" href="https://en.wikipedia.org/wiki/Machine_language" title="Machine language">machine language</a><span> </span>specific to the hardware. The introduction of<span> </span><a href="https://en.wikipedia.org/wiki/High-level_programming_language" title="">high-level programming languages</a><span> </span>in 1958 allowed for more human-readable instructions, making<span> </span><a href="https://en.wikipedia.org/wiki/Software_development" title="Software development">software development</a><span> </span>easier and more portable across different<span> </span><a href="https://en.wikipedia.org/wiki/Computer_architecture" title="Computer architecture">computer architectures</a>. Software in a programming language is run through a<span> </span><a href="https://en.wikipedia.org/wiki/Compiler" title="Compiler">compiler</a><span> </span>or<span> </span><a href="https://en.wikipedia.org/wiki/Interpreter_(computing)" title="Interpreter (computing)">interpreter</a><span> </span>to<span> </span><a href="https://en.wikipedia.org/wiki/Execution_(computing)" title="Execution (computing)">execute</a><span> </span>on the architecture's hardware. Over time, software has become complex, owing to developments in<span> </span><a href="https://en.wikipedia.org/wiki/Computer_network" title="Computer network">networking</a>,<span> </span><a class="mw-redirect" href="https://en.wikipedia.org/wiki/Operating_systems" title="Operating systems">operating systems</a>, and<span> </span><a class="mw-redirect" href="https://en.wikipedia.org/wiki/Databases" title="Databases">databases</a>.</p>
<p>Software can generally be categorized into two main types:</p>
<ol>
<li><a href="https://en.wikipedia.org/wiki/Operating_system" title="Operating system">operating systems</a>, which manage hardware resources and provide services for applications</li>
<li><a href="https://en.wikipedia.org/wiki/Application_software" title="Application software">application software</a>, which performs specific tasks for users</li>
</ol>
<p>The rise of<span> </span><a href="https://en.wikipedia.org/wiki/Cloud_computing" title="Cloud computing">cloud computing</a><span> </span>has introduced the new software delivery model<span> </span><a class="mw-redirect" href="https://en.wikipedia.org/wiki/Software_as_a_Service" title="Software as a Service">Software as a Service</a><span> </span>(SaaS). In SaaS, applications are hosted by a<span> </span><a href="https://en.wikipedia.org/wiki/Application_service_provider" title="Application service provider">provider</a><span> </span>and<span> </span><a href="https://en.wikipedia.org/wiki/HTTP" title="HTTP">accessed</a><span> </span>over the<span> </span><a href="https://en.wikipedia.org/wiki/Internet" title="Internet">Internet</a>.</p>
<p>The process of developing software involves several stages. The stages include<span> </span><a href="https://en.wikipedia.org/wiki/Software_design" title="Software design">software design</a>,<span> </span><a href="https://en.wikipedia.org/wiki/Computer_programming" title="Computer programming">programming</a>,<span> </span><a href="https://en.wikipedia.org/wiki/Software_testing" title="Software testing">testing</a>,<span> </span><a href="https://en.wikipedia.org/wiki/Software_release_life_cycle" title="Software release life cycle">release</a>, and<span> </span><a href="https://en.wikipedia.org/wiki/Software_maintenance" title="Software maintenance">maintenance</a>.<span> </span><a href="https://en.wikipedia.org/wiki/Software_quality_assurance" title="Software quality assurance">Software quality assurance</a><span> </span>and<span> </span><a href="https://en.wikipedia.org/wiki/Information_security" title="Information security">security</a><span> </span>are critical aspects of software development, as<span> </span><a class="mw-redirect" href="https://en.wikipedia.org/wiki/Computer_bug" title="Computer bug">bugs</a><span> </span>and<span> </span><a class="mw-redirect" href="https://en.wikipedia.org/wiki/Vulnerability_(computing)" title="Vulnerability (computing)">security vulnerabilities</a><span> </span>can lead to system failures and security breaches. Additionally, legal issues such as software licenses and intellectual property rights play a significant role in the distribution of software products.</p>
<p></p>
<h2>Git</h2>
<p>Git and Github</p>
<p>電腦輔助機械設計流程:</p>
<p style="padding-left: 30px;">每六位學員一組，請自選套件協同完成平面<a href="https://en.wikipedia.org/wiki/Four-bar_linkage">四連桿機構</a>的零組件設計繪圖。完成後請詳細說明設計與繪圖過程。</p>
<h2>CMSiMDE</h2>
<p>可攜 Python 程式環境，使用 miniconda3:</p>
<p style="padding-left: 30px;">Miniconda is a free, miniature installation of Anaconda Distribution that includes only conda, Python, the packages they both depend on, and a small number of other useful packages.<br/><br/>If you need more packages, use the conda install command to install from thousands of packages available by default in Anaconda’s public repo, or from other channels, like conda-forge or bioconda.</p>
<p style="padding-left: 30px;">授權方式    BSD 3-Clause License（自由軟體）<br/>是否開源    是（可以查閱與修改原始碼）<br/>是否免費    是（個人與商業皆免費使用）<br/>用途限制    無限制，可用於學術、商業、開發、產品部署等<br/>提供單位    Anaconda, Inc.</p>
<p style="padding-left: 30px;">官方網站: <a href="https://www.anaconda.com/download/success">https://www.anaconda.com/download/success</a> </p>
<p style="padding-left: 30px;"><a href="https://drive.google.com/file/d/1ozhZ2U8Ei1ctKklnC589Xs1ouCHnqgTa/view?usp=drive_link">miniconda3.7z</a></p>
<p style="padding-left: 60px;"><a href="/downloads/start_miniconda3_bat.txt">start_miniconda3_bat.txt</a></p>
<p style="padding-left: 60px;">啟動 miniconda3 虛擬環境後，在命令列中執行下列批次檔案，可以導入 NX2312 與 Webots 所需的 Python 模組目錄設定。</p>
<p style="padding-left: 90px;"><a href="/downloads/add_nx_webots_pythonpath_bat.txt">add_nx_webots_pythonpath_bat.txt</a></p>
<p style="padding-left: 30px;">check python path: python -c "import sys; print(sys.executable)"</p>
<p>啟動後 Python 環境位於 base，利用下列指令建立 cmsimde 虛擬環境:</p>
<p style="padding-left: 30px;">conda create -p ./envs/cmsimde python=3.13</p>
<p style="padding-left: 30px;">conda activate y:\envs\cmsimde</p>
<p style="padding-left: 30px;">conda install -c conda-forge flask flask_cors bs4 lxml pelican markdown gevent</p>
<p style="padding-left: 30px;">之後就可以 cd tmp/your_hw_repository 後，以 cms 啟動網頁編輯。</p>
<h3>Flask</h3>
<h2>Solvespace</h2>
<p>Solvespace: <a href="https://solvespace.com">https://solvespace.com</a></p>
<p><a href="/downloads/Jansen_whitworth_mechanism.7z">Jansen_whitworth_mechanism.7z</a></p>
<p><a href="https://github.com/mdecycu/WalkerBot-MakerKit">https://github.com/mdecycu/WalkerBot-MakerKit</a> </p>
<h3>Compile</h3>
<h2>NX</h2>
<p><span style="background-color: #ccffcc;">目前全球業界對 Siemens NX X(不是 NX，而是 NX 雲端版)接受度如何? 總數大約多少? 優勢與弱點何在? 競爭對手產品有哪些?</span></p>
<p><span style="background-color: #ccffcc;">目前台灣業界對 Siemens NX X(不是 NX，而是 NX 雲端版)接受度如何? 總數大約多少? 優勢與弱點何在? 競爭對手產品有哪些?</span></p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/FmacyIh5JB0?si=DWb-YxduPi35RINO" title="YouTube video player" width="560"></iframe></p>
<p data-pm-slice="0 0 []"><span style="background-color: #ccffcc;">Siemens NX2312 與 NX2506 在 CAD 零組件繪圖部分的功能，最大的差異為何? 為何會有這些改變?</span></p>
<p data-pm-slice="0 0 []"><span style="background-color: #ccffcc;"></span></p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/PZ96M_k4Sg8?si=NgbiAHrClEbr03R_" title="YouTube video player" width="560"></iframe></p>
<p>Siemens NX2506 的變更內容:</p>
<p>零件繪圖:</p>
<p style="padding-left: 30px;">現代化 UI：鉛筆游標、動態手柄、顏色編碼 snapping（紅：無 snapping；黃：點對曲線；綠：重合）。</p>
<p style="padding-left: 30px;">支持多輸入（滑鼠、觸控筆、觸控螢幕），MB1 按壓拖曳創建線/弧。</p>
<p style="padding-left: 30px;">手勢控制：搖晃斷開切線、MB2 方向鎖定、塗鴉手勢修剪/延伸。</p>
<p style="padding-left: 30px;">新工具：鎖定長度/角度/半徑參數、鏈接曲線創建輪廓、從中點創建線、正方形從中心、Tangent Sliding（切線滑動）。</p>
<p style="padding-left: 30px;">生成參考幾何與無限線/線段選項。</p>
<p>建模與組立:</p>
<p style="padding-left: 30px;">Axial Pattern 新增：結合圓柱/線性圖案，支持錐面與軸向交錯（Stagger），整合至 Pattern Feature/Geometry/Face/Reference Pattern。</p>
<p style="padding-left: 30px;">Interpart Navigator with Diagram：視覺化組裝關係（黑線：結構；綠曲線：關係），Pack Nodes 隱藏無連結節點。</p>
<p style="padding-left: 30px;">增強 Boolean（Unite/Subtract/Intersect）：支持空特徵組、非交集處理，排除薄片體。</p>
<p style="padding-left: 30px;">Mirror Body：刪除原體選項、智能收集器自動偵測。</p>
<p style="padding-left: 30px;">Offset Surface：自動偵測自交點並警示，Split Output along Boundary Curves 維持表面連續性。</p>
<p>UI:</p>
<p style="padding-left: 30px;">直觀 UI 與 API 支援，保留舊互動但新增現代方式。</p>
<p style="padding-left: 30px;">更好錯誤處理（如自交點警示）。</p>
<p>這些 NX2506 改變主要源自 Siemens 對客戶反饋的回應，以及產業趨勢需求：</p>
<p>提升生產力與靈活性</p>
<p style="padding-left: 30px;">在 NX 2312 版本之後，Siemens 收集了大量用戶反饋，指出傳統 Sketcher 工具在處理複雜零件繪圖時存在明顯的效率瓶頸，例如需要頻繁切換命令、多次點擊調整 snapping（吸附）點，以及手動處理曲線連續性，導致設計流程緩慢且容易中斷創意流程。</p>
<p style="padding-left: 30px;">這些問題在高密度零件建模中尤為突出，例如涉及多層輪廓或精確尺寸約束的零組件設計。為了應對這些痛點，NX 2506 對 Sketcher 進行了全面重構，引入了更先進的手勢控制、拖曳式互動以及智能 snapping 機制。具體來說，廢除了舊版的獨立 Profile 工具，取而代之以整合的線條和弧線創建模式，使用者可以透過按壓拖曳直接生成輪廓，同時支援動態手柄調整和顏色編碼 snapping（例如紅色表示無吸附、黃色為點對曲線、綠色為完全重合），這大大減少了對話框彈出和步驟切換。Siemens 官方將這些改進形容為「遊戲規則改變者」（game-changer），因為它們能將繪圖時間縮短 20-30%，讓設計師更專注於創意迭代而非繁瑣操作。</p>
<p>適應現代硬體與工作環境</p>
<p style="padding-left: 30px;">NX 2506 的更新特別強調對現代硬體的適應性，主要是為了回應遠距工作、行動設計和混合辦公環境的興起。在 NX 2312 中，互動主要依賴傳統滑鼠和鍵盤，缺乏對觸控設備的優化，這在平板電腦或遠端協作時成為限制。NX 2506 引入了多輸入支援，包括觸控筆、觸控螢幕和手勢操作，讓使用者能在平板或混合裝置上流暢進行零件繪圖，例如透過觸控拖曳直接創建弧線或調整 snapping 點。這不僅滿足了遠距設計需求（如在家或現場使用平板建模），還降低了對專用工作站的依賴，提升了工作靈活性。</p>
<p style="padding-left: 30px;">此外，顏色編碼 snapping 和動態 UI（例如實時手柄和視覺反饋）進一步改善了使用者體驗，這些元素提供即時視覺指引，減少了試錯時間並降低學習曲線。新手設計師能更快上手，而資深用戶則受益於更直觀的互動，例如在複雜零組件繪圖中，動態 UI 能自動突出潛在錯誤（如自交點）。這些改進源自 Siemens 對使用者工作環境的調查，旨在讓 NX 成為更包容的工具，支援從桌面到行動的無縫轉換，從而適應現代工程師的多樣化工作模式。</p>
<p>產業需求驅動</p>
<p style="padding-left: 30px;">汽車和航太產業對高精度組件建模的需求是 NX 2506 更新的一大驅動力，這些領域常涉及複雜的零組件組裝，如引擎部件或飛機結構，需要精確的關係管理和表面連續性。在 NX 2312 中，組裝分析工具較為基礎，容易在下游模擬階段暴露錯誤。NX 2506 引入了增強的 Interpart Navigator，配以圖表式視覺化（Diagram 模式），使用黑線表示結構關係、綠曲線顯示約束連結，並支援 Pack Nodes 隱藏無關節點，這大大提升了組裝效率，讓工程師能快速診斷和解決零組件間的潛在衝突，減少了下游錯誤如碰撞或不匹配。</p>
<p style="padding-left: 30px;">同時，Boolean 操作（Unite/Subtract/Intersect）和 Mirror Body 功能的增強針對高品質表面需求，例如支援排除薄片體、非交集處理，以及智能收集器自動偵測和刪除原體選項，確保表面連續性（G1/G2 連續）。這直接支援下游模擬（如有限元素分析）和 CAM 製造，特別在汽車（精密齒輪組裝）和航太（輕量結構）中，避免了重工並提升產品品質。這些改變源自產業反饋，Siemens 透過客戶調查和合作（如與製造夥伴）確認了這些痛點，目的是讓 NX 更好地服務高精度應用，維持競爭優勢。</p>
<p>技術進展</p>
<p style="padding-left: 30px;">Siemens 一直強調 NX 作為統一平台的定位，將 CAD、CAM 和 CAE 整合成一體化生態，這是 NX 2506 更新背後的核心邏輯。相較 NX 2312 的穩定基礎，NX 2506 引入了與 AI 工具的深度整合，雖然 AI 並非核心 CAD 功能，但它影響整體工作流程，例如透過 AI 驅動的自動特徵辨識、優化建議和數字孿生模擬，輔助零件繪圖和零組件建模。具體來說，NX 2506 與 Teamcenter 2506 聯動，提供 AI-powered 功能如生成式設計輔助和實時決策支援，這讓 CAD 流程更智能，例如在 Sketcher 中 AI 可建議 snapping 優化，或在 Axial Pattern 中自動調整參數以符合製造約束。</p>
<p style="padding-left: 30px;">這些更新旨在提升 NX 的競爭力，面對如 SolidWorks 或其他 CAD 軟體的挑戰，Siemens 透過 AI 和雲端整合（如 API 連接和雲端製造服務）讓 NX 更具前瞻性，支援工業級 AI 應用如 CNC 優化和部件生產效率提升。官方釋出註記強調這些進展是為了增加效率和創新，基於技術趨勢如 AI 與數字孿生的融合，讓 NX 2506 不僅是工具升級，更是平台演進。</p>
<p>Siemens NX 與 NX X 的並存情況</p>
<p style="padding-left: 30px;">根據 Siemens 官方訊息，NX 與 NX X 將一直並存，並非互斥或取代關係。NX 是傳統的 on-premise（本地安裝）版本，提供完整的 CAD/CAM/CAE 功能，適合需要高度自訂化與本地控制的企業；NX X 則是基於雲端的 SaaS（Software as a Service）版本，強調雲端授權、即時更新與協作，針對現代混合工作環境設計。兩者建構於相同的 NX 架構與資料模型之上，確保完全互通性（interoperability），可無縫共享資料與功能，支援從設計到製造的全流程整合。這一並存策略是 Siemens Xcelerator 平台的核心部分，讓用戶根據需求選擇部署方式，而非強制遷移。</p>
<p>關鍵官方依據與細節</p>
<p style="padding-left: 30px;">並存與互通性確認：Siemens 明確表示「All Siemens Xcelerator software, including all NX products, are interoperable and can share data seamlessly」（所有 Siemens Xcelerator 軟體，包括所有 NX 產品，皆可互通並無縫共享資料）。這涵蓋 NX（on-premise）與 NX X（雲端），允許用戶在兩者間自由切換，而無需資料轉換或相容性問題。 例如，NX X 的桌面安裝版使用雲端授權，但可與傳統 NX 整合，支援混合環境。</p>
<p style="padding-left: 30px;">部署選擇的靈活性：官方文件指出，「Whether you want to manage your own IT environment or leverage software as a service, Siemens' NX CAD has licensing options for how you work. You'll have the same core features and release/update cadence no matter how you choose to run NX CAD.」這意味無論選擇 NX 或 NX X，都享有相同核心功能與更新節奏（每 6 個月新增模組），確保並存不會導致功能落差。 NX X 提供四個階層（Essentials、Standard、Advanced、Premium），但不取代 NX，而是作為補充，讓小型團隊或遠距協作更便捷。</p>
<p style="padding-left: 30px;">未來更新與持續支援：在 2025 年夏季更新中，Siemens 同時發布 NX 與 NX X 的新功能，如 AI Copilot（設計輔助）、沉浸式工程（mixed reality 協作）與流體模擬，證明兩者將同步演進。 官方強調 NX X 的雲端管理（自動更新）與 NX 的本地穩定性將長期並行，無終止傳統版本的計畫。這回應產業趨勢，讓企業逐步過渡至雲端，而非強迫。</p>
<p>為何會並存？</p>
<p style="padding-left: 30px;">Siemens 的策略是提供「選擇權」（it's your choice），回應不同用戶需求：大型企業偏好 NX 的自訂化與安全性；新創或分散團隊則青睞 NX X 的低門檻與協作。 這種並存不僅維持市場領導地位（NX 在 CAD 評比中高分），還加速創新，如透過雲端整合 AI 與數字孿生。 若需遷移，Siemens 提供工具與支援，確保平滑轉換。</p><h3>NX2312</h3>
<p>這裡將使用電腦輔助設計室所安裝的 NX2312 套件.</p>
<p>Siemens NX: <a href="https://plm.sw.siemens.com/en-US/nx/">https://plm.sw.siemens.com/en-US/nx/</a></p>
<p style="padding-left: 30px;"><a href="https://docs.sw.siemens.com/en-US/documents/209349590/PL20230425446868577">NX2312 Documentation</a></p>
<p>NXOpen: <a href="https://github.com/mdecycu/nxopen">https://github.com/mdecycu/nxopen</a></p>
<p style="padding-left: 30px;"><a href="https://docs.sw.siemens.com/en-US/doc/209349590/PL20230425446868577.nxopen_prog_guide/xid2250951">Setup NXOpen Python Intellisense</a></p>
<p>在自己的電腦上，以可攜方式執行 NX2312:</p>
<p style="padding-left: 30px;"><a href="http://229.cycu.org/portable_2026.7z">portable_2026.7z</a> (387MB)</p>
<p style="padding-left: 60px;">解開壓縮後，雙點擊 start_miniconda3.bat 啟動可攜系統，雙點擊 stop.bat 關閉可攜系統。</p>
<p style="padding-left: 60px;">可攜系統啟動後，在命令列執行 conda activate y:\envs\cmsimde 可進入能執行 CMSiMDE 的環境。</p>
<p style="padding-left: 60px;">若希望可攜系統啟動直接進入 cmsimde 環境，可將 start_miniconda3.bat 檔案中第 98 行: call "%CONDA_ROOT%\Scripts\activate.bat" %ENV_NAME% 更換為 call "%CONDA_ROOT%\Scripts\activate.bat" %Disk%:\envs\cmsimde。</p>
<p style="padding-left: 30px;"><a href="http://229.cycu.org/cad_data.7z">cad_data.7z</a> (包括 NX2312、Blender4.2 與 Webots2023b，4.2GB)</p>
<p style="padding-left: 60px;">解開壓縮檔，將 nx、Webots_2023b 與 Blender 4.2 等目錄放入可攜系統的 data 目錄中。</p>
<p style="padding-left: 60px;">在命令列執行 webotsw 可啟動 Webots，設定 NX 使用授權後，執行 ugraf -nx 可啟動 NX2312。</p>
<p style="padding-left: 60px;">Webots2023b 啟動時需要 openssl_lh_set_thunks 函式，因為這是特別的 OpenSSL 介接，其目的可能是透過此函式與 OpenSSL 整合記憶體分配、除錯、或 OpenSSL 引擎擴充。</p>
<p style="padding-left: 60px;">目前已知 miniconda 中必須透過 conda install openssl=3.0.16 安裝舊版後的 openssl-3-x64.dll 中才會包含openssl_lh_set_thunks 函式。</p>
<p style="padding-left: 30px;"><a href="https://learn.microsoft.com/zh-tw/cpp/windows/latest-supported-vc-redist?view=msvc-170">Microsoft Visual C++ 可轉散發套件</a> (<a href="https://drive.google.com/file/d/10dzQbk_OT1Cm354rnk-2_sXwRRUmDrjK/view?usp=drive_link">VC_redist.x64.exe</a>)</p>
<p>在電腦輔助設計室中，利用可攜套件設定，執行安裝於 C: 中的 NX2312:</p>
<p style="padding-left: 30px;">修改 start_miniconda3.bat，將可攜套件 NX 路徑換成 C: 中安裝 NX2312 所在路徑後，將批次檔案存為 start_cadlab_nx.bat</p>
<p>NX2312 NXOpen Python 動態連結程式庫版本: Python 3.10.9</p>
<p style="padding-left: 30px;">在可攜程式環境中利用 miniconda3 建立 nxopen 虛擬環境 (注意: 必須使用反斜線分隔目錄名稱):</p>
<p style="padding-left: 60px;"><span style="background-color: #ccffcc;">conda create -p y:\envs\nxopen python=3.10</span> 指定建立 nxopen Python 環境，並使用 3.10 版。</p>
<p style="padding-left: 60px;"><span style="background-color: #ccffcc;">conda activate y:\envs\nxopen</span> 將 Python 環境切換到 nxopen env。</p>
<p style="padding-left: 60px;"><span style="background-color: #ccffcc;">where python</span> 查詢目前 env 所使用的 Python 所在目錄位置。</p>
<p style="padding-left: 60px;"><span style="background-color: #ccffcc;">conda clean --all</span> 刪除安裝 env 時所下載的安裝套件以及暫存檔案。</p>
<p style="padding-left: 60px;">進入 nxopen 虛擬環境後，在命令列執行下列 PYTHONPATH 設定，可以使用 Python </p>
<p style="padding-left: 60px;"><a href="/downloads/add_nx_webots_pythonpath_bat.txt">add_nx_webots_pythonpath_bat.txt</a></p>
<p style="padding-left: 60px;">若要在 SciTE 編輯器中指令使用 nxopen env 中的 Python，可以先在命令列中以 conda activate nxopen 後，接著以 where python 查詢所使用 python.exe 所在目錄後，利用處於同樣目錄的 pythonw.exe 設定 python.properties:</p>
<p style="padding-left: 90px;">if PLAT_WIN<br/>    python.command=y:\envs\nxopen\python.exe</p>
<p style="padding-left: 60px;">完成 python.properties 設定修改後，在命令列中利用 start /MIN y:\wscite\SciTE.exe  開啟編輯器後，以下列程式查詢所使用的 conda env，以及所使用的 Python 版本:</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">import sys
import os

conda_env = os.environ.get("CONDA_DEFAULT_ENV")
print(f"Conda env：{conda_env}")
print(f"Python version: {sys.version}")</pre>
<p style="padding-left: 60px;"></p><h3>License</h3>
<p>在電腦輔助設計過程使用電腦套件時，必須明確了解該套件的使用授權。本課程所使用的 <a href="https://github.com/mdecycu/cmsimde">CMSiME </a>為 <a href="https://github.com/mdecycu/cmsimde/blob/master/LICENSE">GNU Affero General Public License v3.0</a>，而 Siemens NX 除了一般教育單位購買的授權外，也提供<a href="https://plm.sw.siemens.com/en-US/nx/student-software/">學生使用授權</a>。</p>
<p>Siemens NX 使用了很多開源軟體，其使用授權: <a href="https://download.industrysoftware.automation.siemens.com/open-source/">https://download.industrysoftware.automation.siemens.com/open-source/</a> </p>
<p>教育單位使用 Siemens NX 的使用授權: <a href="https://docs.sw.siemens.com/en-US/doc/209349590/PL20230425446868577.xid1851843/topicSet_copyright">NX2312 版權宣告</a></p>
<p>License Server (認證伺服器)</p>
<p><a href="https://support.sdasoftware.com/portal/en/kb/articles/siemens-license-server-installation-and-setup">https://support.sdasoftware.com/portal/en/kb/articles/siemens-license-server-installation-and-setup</a> </p>
<p>NX2212 之後的認證伺服器變更: <a href="https://support.sw.siemens.com/en-US/okba/PL8687318/NX-2212-licensing-changes-Mandatory-use-of-Siemens-License-Server/index.html">https://support.sw.siemens.com/en-US/okba/PL8687318/NX-2212-licensing-changes-Mandatory-use-of-Siemens-License-Server/index.html</a> </p>
<p>一旦全面 SaaS 化之後的 Siemens Nx，客戶端的使用認證將不再依賴近端的認證伺服器。</p>
<p style="padding-left: 30px;">SaaS 之後的 Siemens NX X: <a href="https://resources.sw.siemens.com/en-US/video-introducing-nx-x-nx-as-a-saas-solution/">https://resources.sw.siemens.com/en-US/video-introducing-nx-x-nx-as-a-saas-solution/</a> </p>
<h3>NX2506</h3>
<p><a href="https://docs.sw.siemens.com/en-US/doc/209349590/PL20241101461013487.xid1851843/xid1851946">NX2506 Online Help</a></p>
<p>NX2506 需要:</p>
<p style="padding-left: 30px;"><a href="https://dotnet.microsoft.com/en-us/download/dotnet/8.0">https://dotnet.microsoft.com/en-us/download/dotnet/8.0</a> </p>
<p style="padding-left: 30px;"><a href="https://learn.microsoft.com/en-us/cpp/windows/latest-supported-vc-redist?view=msvc-170">Microsoft Visual C++ Redistributable</a> (2015 - 2022)</p>
<p>NX2506 Python 採用 3.12.9 (NX2412 則採用 Python 3.11.9)</p>
<p>NX2506 完整安裝容量約 38GB (NX2412 完整安裝容量則約 37GB)</p>
<p>NX2506 可攜啟動與 NXOpen 設定:</p>
<pre class="brush:js;auto-links:false;toolbar:false" contenteditable="false">@echo off
set Disk=y
subst %Disk%: "data"

%Disk%:

set HomePath=%Disk%:\home_ipv6
set HomeDrive=%Disk%:\home_ipv6
set Home=%Disk%:\home_ipv6
set USERPROFILE=%Disk%:\home_ipv6

REM 將系統 Python 程式的 io 設為 utf-8
set PYTHONIOENCODING="utf-8"

set PYTHONPATH=%Disk%:\envs\nx2506\DLLs;%Disk%:\envs\nx2506\Lib;%Disk%:\envs\nx2506\Lib\site-packages;%Disk%:\NX2506\NXBIN\python;%Disk%:\Webots_2023b\msys64\mingw64\bin;%Disk%:\Webots_2023b\lib\controller\python;
set PYTHONHOME=%Disk%:\envs\nx2506
REM for Webots
set PYTHON_PATH=%Disk%:\envs\nx2506
set WEBOTS_HOME=%Disk%:\Webots_2023b

REM for putty
set GIT_SSH=%Disk%:\PuTTY\plink.exe

REM 設定跟 Python 有關的命令搜尋路徑
set path_python=%Disk%:\envs\nx2506;%Disk%:\envs\nx2506\Scripts;
REM 設定跟Git 有關的命令搜尋路徑
set path_git=%Disk%:\portablegit\bin;

REM for execute scite directly
set path_scite=%Disk%:\wscite\;

REM for webots
set  path_webots=%Disk%:\Webots_2023b\msys64\mingw64\bin;%Disk%:\Webots_2023b\msys64\usr\bin

REM for blender
set path_blender=%Disk%:\Blender_4.2;

path=%Disk%:;%path_python%;%path_git%%path_scite%;%path_webots%;%path_blender%;%path%;

REM for NX2312, must after path setup 
set UGII_ENV_FILE=%Disk%:\NX2506\UGII\ugii_env_ug.dat
set SPLM_LICENSE_SERVER=29000@your_License_Server
set UGII_LANG=english
set UGS_LICENSE_BUNDLE=ACD11,ACD10
set UGII_BASE_DIR=%Disk%:\NX2506\
set UGII_TMP_DIR=%Disk%:\tmp\nx2506
set UGII_LIB_PATH=%Disk%:\NX2506\NXBIN\python
set ugii=%Disk%:\NX2506\ugii;%Disk%:\NX2506\nxbin;
path = %ugii%;%path%
REM Xcopy %Disk%:\home_ipv6\AppData\Local\Siemens\NX2312 C:\users\%USERNAME%\AppData\Local\Siemens\NX2312 /E /H /C /I /Y

REM start ugraf -nx

REM 切換到 nx2506
call "%CONDA_ROOT%\Scripts\activate.bat" %Disk%:\envs\nx2506

start /MIN cmd.exe
start /MIN cmd.exe
start /MIN cmd.exe
start /MIN cmd.exe

start /MIN %Disk%:\wscite\SciTE.exe
start /MIN %Disk%:\wscite\SciTE.exe

REM start webotsw.exe

Exit</pre><h2>Onshape</h2>
<p>開發歷史: <a href="https://en.wikipedia.org/wiki/Onshape">https://en.wikipedia.org/wiki/Onshape</a> </p>
<p>OnShape: <a href="https://www.onshape.com/en/">https://www.onshape.com/en/</a></p>
<p>教師 Free Onshape 帳號: course At mde dot tw</p>
<p>Education 帳號: 50703199 At mde dot nfu dot edu dot tw</p>
<p><a href="https://github.com/PChild/onshape-to-webots">https://github.com/PChild/onshape-to-webots</a> </p>
<p><a href="https://github.com/mdecycu/onshape-to-robot">https://github.com/mdecycu/onshape-to-robot</a> </p>
<p>Onshape 教育版帳號:</p>
<p style="padding-left: 30px;">請利用學校配發的 Email 申請 <a href="https://www.onshape.com/en/education/">Onshape Education 帳號</a></p>
<p style="padding-left: 30px;">申請過程輸入畢業年份，就可以取得教育版帳號權限</p>
<p style="padding-left: 30px;">教育版帳號新增 Document，會<span style="background-color: #ccffcc;">內建為 private</span>，也可利用 make public 轉為公開</p>
<p style="padding-left: 30px;">教育版帳號與免費帳號都可使用完整的 CAD 工具，</p>
<p style="padding-left: 30px;">免費帳號在<span style="background-color: #ccffcc;">版本控制、組立與模擬</span>功能方面，僅有限支援，而<span style="background-color: #ccffcc;">教育版帳號則與專案版相同</span></p>
<p style="padding-left: 30px;">教育版帳號可以透過 request 取得<span style="background-color: #ccffcc;">技術支援</span></p>
<p><a href="/downloads/CAD_for_college.pdf">CAD_for_college.pdf</a>:</p>
<p style="padding-left: 30px;">Onshape is the first CAD system built for teams. Students can work in groups and edit models together simultaneously. Teachers can distribute assignments, review work and give feedback with ease. Additionally, Onshape keeps a complete history of changes so students will never accidentally lose work or overwrite each other's data.</p>
<p style="padding-left: 30px;">Part Studios allow multiple parts to be created with the same sketches in the part studios.</p>
<p style="padding-left: 60px;">In Onshape, Part Studios are a powerful feature that allows you to design multiple parts together in a single workspace, using shared sketches, features, and geometry. The statement:<br/><br/>"Part Studios allow multiple parts to be created with the same sketches in the part studios."<br/><br/>means:<br/><br/>You can use one sketch to build multiple parts within the same Part Studio.<br/><br/>For example:<br/><br/>You create a single sketch (e.g., a rectangle and a circle side-by-side).<br/><br/>You can extrude the rectangle into one solid body (Part 1).<br/><br/>You can extrude the circle separately into another body (Part 2).<br/><br/>These two are now separate parts (each with its own geometry), but they were both created from the same sketch.<br/><br/>Why use multiple parts in one Part Studio?<br/><br/>Parametric design: If multiple parts are linked (e.g., they share dimensions), editing one sketch can update all the related parts.<br/><br/>Ease of assembly: Designing related parts together ensures perfect fit and alignment.<br/><br/>Simplified references: You can reference other parts’ faces, edges, or geometry without needing to create separate files or worry about inter-document references.<br/><br/>Example Use Case:<br/><br/>Imagine designing a hinge:<br/><br/>You sketch a base plate and a pin hole in a single sketch.<br/><br/>You extrude the base into one part.<br/><br/>You revolve or extrude the pin hole shape into another part (the pin).<br/><br/>Now you have both hinge components created from a single sketch — tightly linked and perfectly aligned.<br/><br/>Key Tips:<br/><br/>You can toggle visibility and isolate parts in the Part Studio.<br/><br/>Use the "Split" tool if needed to separate geometry.<br/><br/>Use "Transform" to move parts around within the Part Studio.<br/><br/>Eventually, you insert these parts into an Assembly to simulate motion or relationships.</p><h2>Webots</h2>
<p><a href="https://cyberbotics.com/">https://cyberbotics.com/</a></p>
<p><a href="https://www.slideshare.net/slideshow/tpwebots7mai2021pdf/259157378">https://www.slideshare.net/slideshow/tpwebots7mai2021pdf/259157378</a> </p>
<p><a href="https://introduction-to-autonomous-robots.github.io/lab-manipulation-introduction.html">https://introduction-to-autonomous-robots.github.io/lab-manipulation-introduction.html</a> </p>
<p><a href="https://www.instructables.com/Vacuum-Cleaner-Robot-in-Webots/">https://www.instructables.com/Vacuum-Cleaner-Robot-in-Webots/</a> </p>
<p><a href="https://www.eecs.ucf.edu/cssd/fall13/ucfsr/files/FinalDoc.pdf">https://www.eecs.ucf.edu/cssd/fall13/ucfsr/files/FinalDoc.pdf</a> </p>
<p>在自己的電腦上，以可攜方式執行 Webots:</p>
<p style="padding-left: 30px;"><a href="http://229.cycu.org/portable_2026.7z">portable_2026.7z</a> (387MB)</p>
<p style="padding-left: 60px;">解開壓縮後，雙點擊 start_miniconda3.bat 啟動可攜系統，雙點擊 stop.bat 關閉可攜系統。</p>
<p style="padding-left: 60px;">可攜系統啟動後，在命令列執行 conda activate y:\envs\cmsimde 可進入能執行 CMSiMDE 的環境。</p>
<p style="padding-left: 60px;">若希望可攜系統啟動直接進入 cmsimde 環境，可將 start_miniconda3.bat 檔案中第 98 行: call "%CONDA_ROOT%\Scripts\activate.bat" %ENV_NAME% 更換為 call "%CONDA_ROOT%\Scripts\activate.bat" %Disk%:\envs\cmsimde。</p>
<p style="padding-left: 30px;"><a href="http://229.cycu.org/cad_data.7z">cad_data.7z</a> (包括 NX2312、Blender4.2 與 Webots2023b，4.2GB)</p>
<p style="padding-left: 60px;">解開壓縮檔，將 nx、Webots_2023b 與 Blender 4.2 等目錄放入可攜系統的 data 目錄中。</p>
<p style="padding-left: 60px;">在命令列執行 webotsw 可啟動 Webots，設定 NX 使用授權後，執行 ugraf --nx 可啟動 NX2312。</p>
<p style="padding-left: 60px;">Webots2023b 啟動時需要 openssl_lh_set_thunks 函式，因為這是特別的 OpenSSL 介接，其目的可能是透過此函式與 OpenSSL 整合記憶體分配、除錯、或 OpenSSL 引擎擴充。</p>
<p style="padding-left: 60px;">目前已知 miniconda 中必須透過 conda install openssl=3.0.16 安裝舊版後的 openssl-3-x64.dll 中才會包含openssl_lh_set_thunks 函式。</p>
<p style="padding-left: 30px;"><a href="https://learn.microsoft.com/zh-tw/cpp/windows/latest-supported-vc-redist?view=msvc-170">Microsoft Visual C++ 可轉散發套件</a> (<a href="https://drive.google.com/file/d/10dzQbk_OT1Cm354rnk-2_sXwRRUmDrjK/view?usp=drive_link">VC_redist.x64.exe</a>)</p>
<p>由於 NX2312 中的 NXOpen Python 必須使用 Python 3.10 版的解譯器，才能與位於 y:\NX\NXBIN\python 目錄中的動態連結程式結合。</p>
<p>而 Webots_2023b 若要採 extern 外部控制器設定，則必須在切換 env 後，額外設定 PYTHONPATH 至 y:\Webots_2023b\msys64\mingw64\bin 以及 y:\Webots_2023b\lib\controller\python，才可連結其內建的 Python 控制器模組，只是 Webots 的控制器模組採 Python 程式碼編寫，因此可以在 Python 3.10 以上的版本中執行，因此只要 PYTHONPATH 納入 Webots 控制器模組後，可以選擇 base、cmsimde 或 nxopen 等 env 中的 Python 進行配置。</p>
<p>若 Webots Python 控制器需要額外安裝 numpy、scipy、opencv-python、matplotlib 或其他模組，也可以獨立配置一個 webots env 提供使用:</p>
<p style="padding-left: 30px;">conda create -p y:\envs\webots python=3.13</p>
<p style="padding-left: 30px;">conda activate y:\envs\webots</p>
<p style="padding-left: 30px;">where python</p>
<p style="padding-left: 30px;">conda clean --all</p>
<p style="padding-left: 30px;">並將 Webots 下拉式功能表中的 Tools - Preferences - Python command 欄位指向 webots env 所對應的 python，或者將控制器設為 extern，然後由 SciTE 選擇使用 Webots 合用的 Python 版本與模組套件。</p>
<p>Webots 啟動:</p>
<p style="padding-left: 30px;">webotsw --mode=pause (啟動時不會自動執行 controller)</p>
<h3>Fourbar</h3>
<p><a href="/downloads/fourbar_box.7z">fourbar_box.7z</a></p>
<p><a href="/downloads/fourbar_slvs.7z">fourbar_slvs.7z</a></p>
<p><object data="/images/fourbar.svg" height="2126" type="image/svg+xml" width="3168"></object></p>
<p><a href="https://mde.tw/mind-map/#/?fileURL=https://mde.tw/cad2025/downloads/fourbar.smm">Edit fourbar.smm</a></p>
<h3>TimeStep</h3>
<p><span node="[object Object]">在 Webots 模擬器中，</span><strong><span node="[object Object]">模擬器的時間步長</span></strong><span node="[object Object]">與</span><strong><span node="[object Object]">世界的時間步長</span></strong><span node="[object Object]">是模擬運行的兩個重要概念，分別表示模擬器和模擬世界在離散物理計算中的時間間隔。以下是詳細說明：</span></p>
<div class="markdown-body MarkdownRenderer-module__container--wIGWk" data-copilot-markdown="true"><hr/><br/><span node="[object Object]">1. </span><strong><span node="[object Object]">模擬器的時間步長（Simulator </span><span node="[object Object]">Time </span><span node="[object Object]">Step）</span></strong>
<ul>
<li><strong><span node="[object Object]">定義</span></strong><span node="[object Object]">：模擬器內部用於計算物理模擬的時間間隔。它決定了模擬器每次更新物理場景時所模擬的時間量。</span></li>
<li><strong><span node="[object Object]">作用</span></strong><span node="[object Object]">：</span>
<ul>
<li><span node="[object Object]">控制系統的精度與性能。</span></li>
<li><span node="[object Object]">計算物理行為（如碰撞、運動等）的關鍵參數。</span></li>
</ul>
</li>
<li><strong><span node="[object Object]">設置方式</span></strong><span node="[object Object]">：模擬器的時間步長通常由模擬控制器中的代碼明確設置。例如，在 Python 控制器中，您可以使用</span><code node="[object Object]"><span node="[object Object]">robot.step(timestep)</span></code><span node="[object Object]">來進行控制。</span></li>
<li><strong><span node="[object Object]">特性</span></strong><span node="[object Object]">：</span>
<ul>
<li><strong><span node="[object Object]">越小</span></strong><span node="[object Object]">：模擬精度越高，但計算負擔增加，模擬速度可能變慢。</span></li>
<li><strong><span node="[object Object]">越大</span></strong><span node="[object Object]">：模擬速度提高，但精度降低，可能導致模擬不穩定。</span></li>
</ul>
</li>
</ul>
<hr/><br/><span node="[object Object]">2. </span><strong><span node="[object Object]">世界的時間步長（World </span><span node="[object Object]">Time </span><span node="[object Object]">Step）</span></strong>
<ul>
<li><strong><span node="[object Object]">定義</span></strong><span node="[object Object]">：模擬世界中用於更新場景的固定時間間隔，主要由 Webots 的場景樹（Scene </span><span node="[object Object]">Tree）中的 </span><code node="[object Object]"><span node="[object Object]">WorldInfo </span><span node="[object Object]">&gt; </span><span node="[object Object]">basicTimeStep</span></code> <span node="[object Object]">參數定義。</span></li>
<li><strong><span node="[object Object]">作用</span></strong><span node="[object Object]">：</span>
<ul>
<li><span node="[object Object]">控制整個模擬場景中物體更新的頻率。</span></li>
<li><span node="[object Object]">決定模擬器每次計算後，虛擬時間向前推進的時間量。</span></li>
</ul>
</li>
<li><strong><span node="[object Object]">設置方式</span></strong><span node="[object Object]">：可以在場景樹的 </span><code node="[object Object]"><span node="[object Object]">WorldInfo </span></code><span node="[object Object]">節點中修改 </span><code node="[object Object]"><span node="[object Object]">basicTimeStep </span></code><span node="[object Object]">參數值。</span></li>
<li><strong><span node="[object Object]">特性</span></strong><span node="[object Object]">：</span>
<ul>
<li><strong><span node="[object Object]">越小</span></strong><span node="[object Object]">：模擬的物理場景更新更加頻繁，但所需計算資源更多。</span></li>
<li><strong><span node="[object Object]">越大</span></strong><span node="[object Object]">：模擬場景更新較少，可能導致物理行為的細節丟失。</span></li>
</ul>
</li>
</ul>
<hr/><br/><span node="[object Object]">3. </span><strong><span node="[object Object]">兩者的關係</span></strong>
<ul>
<li><strong><span node="[object Object]">模擬器的時間步長</span></strong><span node="[object Object]">應該</span><strong><span node="[object Object]">小於或等於</span></strong><span node="[object Object]">世界的時間步長。</span>
<ul>
<li><span node="[object Object]">原因是：模擬器需要在每個世界時間步長內完成多次計算，以確保物理模擬的準確性。</span></li>
<li><span node="[object Object]">如果模擬器的時間步長大於世界的時間步長，可能導致模擬不穩定，甚至出現錯誤。</span></li>
</ul>
</li>
<li><strong><span node="[object Object]">設置建議</span></strong><span node="[object Object]">：</span>
<ul>
<li><span node="[object Object]">一般情況下，模擬器的時間步長可以設置為世界時間步長的一部分（如1/10）。</span></li>
<li><span node="[object Object]">測試不同的時間步長，根據模擬精度與性能需求進行調整。</span></li>
</ul>
</li>
</ul>
<hr/><br/><span node="[object Object]">4. </span><strong><span node="[object Object]">實際應用場景</span></strong>
<ul>
<li><strong><span node="[object Object]">模擬器的時間步長</span></strong><span node="[object Object]">：</span>
<ul>
<li><span node="[object Object]">用於控制機器人的控制器代碼，例如逐步執行機器人的操作或模擬傳感器的更新。</span></li>
</ul>
</li>
<li><strong><span node="[object Object]">世界的時間步長</span></strong><span node="[object Object]">：</span>
<ul>
<li><span node="[object Object]">用於控制整個模擬場景的更新頻率，例如物體的運動、碰撞檢測等。</span></li>
</ul>
</li>
</ul>
<hr/>
<h4>簡單對比</h4>
<table>
<thead>
<tr>
<th><strong><span node="[object Object]">項目</span></strong></th>
<th><strong><span node="[object Object]">模擬器的時間步長</span></strong></th>
<th><strong><span node="[object Object]">世界的時間步長</span></strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><span node="[object Object]">定義</span></strong></td>
<td><span node="[object Object]">模擬器內部計算的時間間隔</span></td>
<td><span node="[object Object]">模擬世界中場景更新的時間間隔</span></td>
</tr>
<tr>
<td><strong><span node="[object Object]">設置位置</span></strong></td>
<td><span node="[object Object]">控制器代碼中</span></td>
<td><span node="[object Object]">場景樹的</span><code node="[object Object]"><span node="[object Object]">WorldInfo</span></code><span node="[object Object]">節點</span></td>
</tr>
<tr>
<td><strong><span node="[object Object]">影響</span></strong></td>
<td><span node="[object Object]">控制模擬計算的精度與性能</span></td>
<td><span node="[object Object]">控制整個場景的更新頻率</span></td>
</tr>
<tr>
<td><strong><span node="[object Object]">大小關係</span></strong></td>
<td><span node="[object Object]">必須小於或等於世界時間步長</span></td>
<td><span node="[object Object]">可設置為模擬所需的任意值</span></td>
</tr>
</tbody>
</table>
<p><span node="[object Object]">透過合理設置這兩個參數，可以在模擬的精度與性能之間達到平衡。</span></p>
<h3>Clouds</h3>
<p><a href="https://cyberbotics.com/doc/guide/web-streaming">https://cyberbotics.com/doc/guide/web-streaming</a></p>
<p>Webots 透過 webotsw --stream 所啟動的串流伺服器, 可以將串流內容導向全球資訊網伺服器, 利用下列超文件透過 Websocket 檢視 Webots 串流場景.</p>
<p><a href="/downloads/index4.html.txt">index4.html</a></p>
<pre class="brush:html;auto-links:false;toolbar:false" contenteditable="false">&lt;!DOCTYPE html&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;

  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;
    &lt;title&gt;Streaming viewer&lt;/title&gt;
    &lt;link rel="icon" type="image/png" href="webots_icon.png"&gt;
    &lt;link type="text/css" rel="stylesheet" href='style.css' /&gt;
    &lt;style&gt;
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        width: 100vw;
        height: 100vh;
        min-height: 100vh;
        min-width: 100vw;
        display: flex;
        flex-direction: column;
        background: #222;
      }
      header {
        flex: 0 0 auto;
        padding: 0;
        margin: 0;
        background: #181818;
        color: #fff;
        text-align: center;
      }
      .title-container {
        margin: 0;
        padding: 0.5em 0;
      }
      .webots-view-container {
        flex: 1 1 0;
        display: flex;
        align-items: stretch;
        justify-content: stretch;
        min-height: 0;
        min-width: 0;
      }
      webots-view {
        width: 100vw;
        height: 100vh;
        flex: 1 1 0;
        display: block;
        min-width: 0;
        min-height: 0;
      }
    &lt;/style&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;div class="webots-view-container"&gt;
      &lt;webots-view&gt;&lt;/webots-view&gt;
    &lt;/div&gt;
    &lt;script type="module" src="http://localhost:8000/wwi/WebotsView.js"&gt;&lt;/script&gt;
    &lt;script&gt;
      // Default WebSocket parameters
      const defaultIp = "ws://localhost:1234";
      const defaultStreamingMode = "x3d";
      const defaultBroadcast = false;
      const mobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      const defaultThumbnail = './../wwi/images/loading/default_thumbnail.png';

      // Optional: load mobile CSS if on mobile device
      if (mobileDevice) {
        let head = document.getElementsByTagName('head')[0];
        let mobileCss = document.createElement('link');
        mobileCss.setAttribute('rel', 'stylesheet');
        mobileCss.setAttribute('type', 'text/css');
        mobileCss.setAttribute('href', './../wwi/css/wwi_mobile.css');
        head.appendChild(mobileCss);
      }

      // Wait for WebotsView.js to load and custom element to be defined
      window.addEventListener('DOMContentLoaded', () =&gt; {
        customElements.whenDefined('webots-view').then(() =&gt; {
          const webotsView = document.querySelector('webots-view');
          webotsView.onready = () =&gt; {
            console.log("Connected to Webots streaming server!");
          };
          webotsView.ondisconnect = () =&gt; {
            console.log("Disconnected from Webots streaming server!");
          };
          webotsView.connect(defaultIp, defaultStreamingMode, defaultBroadcast, mobileDevice, -1, defaultThumbnail);
        });
      });
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>下列 Python 程式執行時則可動態建立近端伺服器, 並直接利用 Edge 開啟 index4.html 中的 Webots 場景.</p>
<p>python_www_server.py</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">import http.server
import socketserver
import threading
import webbrowser
import time
import os
import sys
import subprocess

PORT = 8000
DIRECTORY = os.path.dirname(os.path.abspath(__file__))

class Handler(http.server.SimpleHTTPRequestHandler):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, directory=DIRECTORY, **kwargs)

def open_edge(url):
    # Try common Edge paths on Windows
    edge_paths = [
        r"C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe",
        r"C:\Program Files\Microsoft\Edge\Application\msedge.exe"
    ]
    for path in edge_paths:
        if os.path.exists(path):
            subprocess.Popen([path, url])
            return True
    # Fallback: try using webbrowser module (may open in default browser)
    try:
        webbrowser.get('windows-default').open(url)
    except:
        webbrowser.open(url)
    return False

def run_server():
    with socketserver.TCPServer(("", PORT), Handler) as httpd:
        print(f"Serving at http://localhost:{PORT}")
        httpd.serve_forever()

if __name__ == "__main__":
    # Start server in a thread
    server_thread = threading.Thread(target=run_server, daemon=True)
    server_thread.start()

    # Wait a moment for the server to start
    time.sleep(1)

    # Open Edge to the local index.html
    url = f"http://localhost:{PORT}/streaming_viewer/index4.html"
    print(f"Opening {url} in Edge...")
    open_edge(url)

    # Keep main thread alive to keep server running
    try:
        while True:
            time.sleep(10)
    except KeyboardInterrupt:
        print("Shutting down.")
        sys.exit(0)</pre>
<p><a href="/downloads/webots_stream.7z">webots_stream.7z</a></p>
<p>在雲端提供多 Webots 場景串流的方法是, 每一個場景採</p>
<pre class="brush:js;auto-links:false;toolbar:false" contenteditable="false">webotsw my_world.wbt --stream --port 8888</pre>
<p>在 8888 埠號串流 my_world.wbt 場景, 並在 WWW 伺服器中指定要開啟的 port 就能利用一台雲端主機檢視多個由使用者上傳的場景. 再加上 https 設定, 建立類似 <a href="https://webots.cloud/">https://webots.cloud/</a> 的服務.</p>
<p>cloud (<a href="https://github.com/cyberbotics/webots-cloud">https://github.com/cyberbotics/webots-cloud</a>) 中的 html 如下:</p>
<pre class="brush:html;auto-links:false;toolbar:false" contenteditable="false">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"&gt;
  &lt;title id="title"&gt;webots.cloud&lt;/title&gt;
  &lt;meta name="description" content="Run Webots simulations in the cloud"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
  &lt;meta name="og:locale" content="en"&gt;
  &lt;meta name="og:type" content="website"&gt;
  &lt;meta name="og:title" content="webots.cloud"&gt;
  &lt;meta name="og:description" content="The place to share Webots simulations."&gt;
  &lt;meta name="og:updated_time" content="1587637793"&gt;
  &lt;link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" /&gt;
  &lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css"&gt;
  &lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.css"&gt;
  &lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/default.min.css"/&gt;
  &lt;link rel="stylesheet" href="/css/webots-cloud.css"&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class="scrollable-body" id="scrollable-body"&gt;&lt;/div&gt;
  &lt;script src="/js/webots-cloud.js" type="module"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/highlight.min.js"&gt;&lt;/script&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.3.0/showdown.min.js"&gt;&lt;/script&gt;
&lt;script src="https://cyberbotics.com/showdown/1.3.0/showdown-youtube.min.js"&gt;&lt;/script&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/7.0.0/mermaidAPI.min.js"&gt;&lt;/script&gt;
&lt;script src="https://cdn.jsdelivr.net/gh/cyberbotics/webots@released/docs/js/showdown-extensions.js"&gt;&lt;/script&gt;
&lt;/html&gt;
</pre>
<p>在 w_dot_mde 設定:</p>
<p>nginx.conf (主要讓 wss:// 透過 https 反向代理.</p>
<pre class="brush:js;auto-links:false;toolbar:false" contenteditable="false">#user  nobody;
worker_processes  1;
 
#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;
 
#pid        logs/nginx.pid;
 
events {
    worker_connections  1024;
}
 
http {
    include       mime.types;
    default_type  application/octet-stream;
 
    sendfile        on;
    keepalive_timeout  65;
 
    # Redirect HTTP to HTTPS
    server {
        listen [2001:288:6004:17::XX]:80;
        server_name  XX.nfu.edu.tw;
 
        return 301 https://$host$request_uri;
    }
 
    # HTTPS server
    server {
        listen [2001:288:6004:17::XX]:443 ssl;
        server_name XX..nfu.edu.tw;
 
        ssl_certificate      C:/Certbot/live/w.mde.nfu.edu.tw/fullchain.pem;
        ssl_certificate_key  C:/Certbot/live/w.mde.nfu.edu.tw/privkey.pem;
 
        ssl_protocols        TLSv1.2 TLSv1.3;
        ssl_ciphers          HIGH:!aNULL:!MD5;
 
        location / {
            #root   html;
            root html/webots_resources_web/;
            index  index.html index.htm;
        }
        
        # Webots streaming server 的 WebSocket 反向代理
        location /webots_ws/ {
            proxy_pass http://localhost:1234/;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        location /auto_shoot/ {
            proxy_pass http://localhost:1235/;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
 
        error_page 404 /404.html;
        location = /40x.html {
        }
 
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
        }
    }
}</pre>
<p>此時的 index.html 設為:</p>
<pre class="brush:html;auto-links:false;toolbar:false" contenteditable="false">&lt;!DOCTYPE html&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;
    &lt;title&gt;Streaming viewer&lt;/title&gt;
    &lt;link rel="icon" type="image/png" href="webots_icon.png"&gt;
    &lt;link type="text/css" rel="stylesheet" href='style.css' /&gt;
    &lt;style&gt;
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        width: 100vw;
        height: 100vh;
        min-height: 100vh;
        min-width: 100vw;
        display: flex;
        flex-direction: column;
        background: #222;
      }
      header {
        flex: 0 0 auto;
        padding: 0;
        margin: 0;
        background: #181818;
        color: #fff;
        text-align: center;
      }
      .title-container {
        margin: 0;
        padding: 0.5em 0;
      }
      .webots-view-container {
        flex: 1 1 0;
        display: flex;
        align-items: stretch;
        justify-content: stretch;
        min-height: 0;
        min-width: 0;
      }
      webots-view {
        width: 100vw;
        height: 100vh;
        flex: 1 1 0;
        display: block;
        min-width: 0;
        min-height: 0;
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class="webots-view-container"&gt;
      &lt;webots-view&gt;&lt;/webots-view&gt;
    &lt;/div&gt;
    &lt;script type="module" src="./../wwi/WebotsView.js"&gt;&lt;/script&gt;
    &lt;script&gt;
      // 根據當前協定與主機自動組成 wss/ws 路徑
      const wsProtocol = (window.location.protocol === "https:") ? "wss:" : "ws:";
      const wsHost = window.location.host;
      // 注意：此處路徑要跟 nginx location /webots_ws/ 一致
      const defaultIp = wsProtocol + "//" + wsHost + "/webots_ws/";
      const defaultStreamingMode = "x3d";
      const defaultBroadcast = false;
      const mobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      const defaultThumbnail = './../wwi/images/loading/default_thumbnail.png';

      // Optional: load mobile CSS if on mobile device
      if (mobileDevice) {
        let head = document.getElementsByTagName('head')[0];
        let mobileCss = document.createElement('link');
        mobileCss.setAttribute('rel', 'stylesheet');
        mobileCss.setAttribute('type', 'text/css');
        mobileCss.setAttribute('href', './../wwi/css/wwi_mobile.css');
        head.appendChild(mobileCss);
      }

      // Wait for WebotsView.js to load and custom element to be defined
      window.addEventListener('DOMContentLoaded', () =&gt; {
        customElements.whenDefined('webots-view').then(() =&gt; {
          const webotsView = document.querySelector('webots-view');
          webotsView.onready = () =&gt; {
            console.log("Connected to Webots streaming server!");
          };
          webotsView.ondisconnect = () =&gt; {
            console.log("Disconnected from Webots streaming server!");
          };
          webotsView.connect(defaultIp, defaultStreamingMode, defaultBroadcast, mobileDevice, -1, defaultThumbnail);
        });
      });
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
<p><a href="/downloads/auto_shoot.html.txt">auto_shoot.html</a></p>
<p>Webots headless command:</p>
<p>webots --no-rendering --stream --batch --port=1234  C:\portable_wcm2025_big\data\Webots_2023b\projects\vehicles\worlds\city.wbt</p>
<p><span>Since Webots runs in headless mode, the </span><code>--stdout</code><span><span> </span>and<span> </span></span><code>--stderr</code><span><span> </span>arguments are used to redirect these streams from the Webots console to the console in which Webots was started, the<span> </span></span><code>--batch</code><span><span> </span>argument disables any blocking pop-up window and the<span> </span></span><code>--mode=realtime</code><span><span> </span>makes sure that the simulation is not started in pause mode (you may replace<span> </span></span><code>realtime</code><span><span> </span>by<span> </span></span><code>fast</code><span>), finally don't forget to specify which simulation you want to run.</span></p>
<p><span><a href="https://www.cyberbotics.com/doc/guide/installation-procedure?version=develop#installing-the-docker-image">https://www.cyberbotics.com/doc/guide/installation-procedure?version=develop#installing-the-docker-image</a> </span></p>
<p><span><a href="https://gist.github.com/cyberang3l/422a77a47bdc15a0824d5cca47e64ba2">https://gist.github.com/cyberang3l/422a77a47bdc15a0824d5cca47e64ba2</a> </span></p>
<p>與可攜系統同時啟動:</p>
<pre class="brush:js;auto-links:false;toolbar:false" contenteditable="false">@echo off
set Disk=y
subst %Disk%: "data"

%Disk%:

set HomePath=%Disk%:\home_ipv6
set HomeDrive=%Disk%:\home_ipv6
set Home=%Disk%:\home_ipv6
set USERPROFILE=%Disk%:\home_ipv6

REM 將系統 Python 程式的 io 設為 utf-8
set PYTHONIOENCODING="utf-8"

set PYTHONPATH=%Disk%:\Python313\DLLs;%Disk%:\Python313\Lib;%Disk%:\Python313\Lib\site-packages;%Disk%:\NX\NXBIN\python;%Disk%:\Webots_2023b\msys64\mingw64\bin;%Disk%:\Webots_2023b\lib\controller\python;
set PYTHONHOME=%Disk%:\Python313
REM for Webots
set PYTHON_PATH=%Disk%:\Python313
set WEBOTS_HOME=%Disk%:\Webots_2023b

REM for putty
set GIT_SSH=%Disk%:\PuTTY\plink.exe

REM for Java and Android SDK
set java_home=%Disk%:\java\jdk8u222-b10
set ANDROID_SDK_home=%Disk%:\home_ipv6
set GRADLE_USER_home=%Disk%:\home_ipv6
set ANDROID_SDK_ROOT=%Disk%:\android\sdk
set ANDROID_Home=%Disk%:\android\sdk
set REPO_OS_OVERRIDE=windows

REM 設定跟 Python 有關的命令搜尋路徑
set path_python=%Disk%:\Python313;%Disk%:\Python313\Scripts;
REM 設定跟Git 有關的命令搜尋路徑
set path_git=%Disk%:\portablegit\bin;
REM 設定 msys2 64 位元的執行路徑
REM %Disk%:\msys64\mingw64\bin is for GD library
set path_msys2=%Disk%:\msys64\ucrt64\bin;%Disk%:\msys64\mingw64\bin;
REM set for LaTeX
set path_miketex=%Disk%:\miktex-portable\texmfs\install\miktex\bin\x64;
REM Flutter path
set path_flutter=%Disk%:\flutter\bin;%java_home%\bin;%Disk%:\Android\sdk;%Disk%:\Android\sdk\tools;%Disk%:\Android\sdk\tools\bin;%Disk%:\Android\sdk\emulator;%Disk%:\Android\sdk\platform-tools;%Disk%:\flutter\bin\cache\dart-sdk\bin;%Disk%:\vscode;
set path_node=%Disk%:\node-v14.15.4-win-x64;

set path_postgresql=%Disk%:\postgresql13\bin;
set path_range=%Disk%:\Range3_official\bin;
rem set path_range=%Disk%:\range-3.2.5_kmol\bin;
set path_lua=%Disk%:\lua-5.3.5\;
set path_core=%Disk%:\coreutils-5.3.0\bin;
REM for gogs
set path_putty=%Disk%:\PuTTY;
set path_vscode=%Disk%:\vscode;

REM for Rust
set MINGW_PATH=%path_msys2%;
set GIT_PATH=%path_git%;
set VSCODE_PATH=%path_vscode%
set RUSTUP_HOME=%Disk%:\Rust\rust
set CARGO_HOME=%Disk%:\Rust\cargo
set RUST_PATH=%CARGO_HOME%\bin

REM for Erlang and Elixir
set path_erlang=%Disk%:\elixir\erl10.7\bin\;%Disk%:\elixir\erl10.7\erts-10.7\bin;%Disk%:\elixir\elixir\bin;
set ERTSPATH=%Disk%:\elixir\erl10.7\erts-10.7\bin
set ERLINI=%Disk%:\elixir\erl10.7\erts-10.7\bin\erl.ini

REM for Haskell
set path_haskell=%Disk%:\ghc-9.0.1-x86_64-unknown-mingw32\bin;
REM for node.js
set path_nodejs=%Disk%:\node-v14.17.2-x64\nodejs;%Disk%:\node-v14.17.2-x64\nodejs\node_modules\npm;

REM 加入 PostgreSQL 所需的環境變數設定

@SET PGDATA=%Disk%:\postgresql13\data
@SET PGDATABASE=postgres
@SET PGUSER=postgres
@SET PGPORT=5432
@SET PGLOCALEDIR=%Disk%:\postgresql13\share\locale

REM for Range3
REM REG IMPORT %Disk%:\range3.reg

REM proxy needed for heroku login
REM proxy can not use with fossil scm
REM proxy can not use with Rust installation
REM needed for node.js
REM set HTTP_PROXY=http://[2001:288:6004:xx::42]:3128
REM set HTTPS_PROXY=http://[2001:288:6004:xx::42]:3128

REM for PyRep
set VREP_PATH=%Disk%:\CoppeliaSim

REM BOOST_ROOT for compiling coppeliasim but maybe not for linking
REM set BOOST_ROOT=%Disk%:\boost_1_76_0\;
set path_copsim=%Disk%:\boost_1_76_0\;%Disk%:\Strawberry\perl\bin;%Disk%:\cmake-3.21.0-windows-x86_64\bin;%Disk%:\diffutils-2.8.7-1\bin;%Disk%:\patch-2.5.9-7\bin;%D%:\jom_1_1_2;%Disk%:\LLVM\bin;%Disk%:\QtCreator\bin;%Disk%:\CoppeliaSimEdu;%Disk%:\Python313\tcl\tcl8.6;

REM for CMake
set CMAKE_C_COMPILER=%Disk%:\msys64\ucrt64\bin\gcc;
set CMAKE_CXX_COMPILER=%Disk%:\msys64\ucrt64\bin\g++;

REM set QT_QPA_PLATFORM_PLUGIN_PATH=Y:\msys64_20240507\mingw64\share\qt5\plugins\platforms
REM set QT_PLUGIN_PATH=Y:\msys64_20240507\mingw64\share\qt5\plugins

REM for execute scite directly
set path_scite=%Disk%:\wscite\;

REM for simExtZMQ
set path_xsltproc=%Disk%:\xsltproc;

REM for OpenSSL
Set OPENSSL_CONF=%Disk%:\OpenSSL-Win64\SSL\openssl.cnf
set path_openssl=%Disk%:\OpenSSL-Win64\bin;

REM for textract
set path_poppler=%Disk%:\poppler-24.07.0\Library\bin;

REM for tiny C compiler
set path_tcc=%Disk%:\tcc;

REM for webots
set  path_webots=%Disk%:\Webots_2023b\msys64\mingw64\bin;%Disk%:\Webots_2023b\msys64\usr\bin

REM for blender
set path_blender=%Disk%:\Blender 4.2;

path=%Disk%:;%path_python%;%path_git%;%path_copsim%;%path_msys2%;%path_miketex%;%path_flutter%;%path_node%;%path_tcc%;%path_postgresql%;%path_range%;%path_lua%;%path_core%;%path_putty%;%path_vscode%;%RUST_PATH%;%path_erlang%;%path_nodejs%;%path_haskell%;%path_scite%;%path_xsltproc%;%path_gnuplot%;%path_openssl%;%path_poppler%;%path_webots%;%path_blender%;%path%;

REM for NX2312, must after path setup 
set SPLM_LICENSE_SERVER=29000@your_server
set UGII_LANG=english
set UGS_LICENSE_BUNDLE=ACD11,ACD10
set UGII_BASE_DIR=%Disk%:\NX\
set UGII_TMP_DIR=%Disk%:\NX\temp
set UGII_LIB_PATH=%Disk%:\NX\NXBIN\python
set ugii=%Disk%:\NX\ugii;%Disk%:\NX\nxbin;
path = %ugii%;%path%
REM Xcopy %Disk%:\home_ipv6\AppData\Local\Siemens\NX2312 C:\users\%USERNAME%\AppData\Local\Siemens\NX2312 /E /H /C /I /Y

REM start ugraf -nx

REM python %Disk%:\tmp\nx_ex\new_part.py

start /MIN cmd.exe
start /MIN cmd.exe
start /MIN cmd.exe
start /MIN cmd.exe

start /MIN %Disk%:\wscite\SciTE.exe
start /MIN %Disk%:\wscite\SciTE.exe

REM start webotsw.exe

start webots.exe --no-rendering --minimize --stream --stdout --stderr --batch --mode=realtime --port=1234  C:\portable_wcm2025_big\data\Webots_2023b\projects\vehicles\worlds\city.wbt
start webots.exe --no-rendering --minimize --stream --stdout --stderr --batch --mode=realtime --port=1235  C:\Webots_server\webots_projects\cd2025_final_project_w17\worlds\w17_auto_loop.wbt


Exit
</pre>
<h3>Talks</h3>
<p><a href="https://www.theconstruct.ai/webots-robot-simulator-ros-olivier-michel/">https://www.theconstruct.ai/webots-robot-simulator-ros-olivier-michel/</a> </p>
<h3>Blender</h3>
<p>Blender: <a href="https://www.blender.org/">https://www.blender.org/</a></p>
<p><a href="https://github.com/cyberbotics/blender-webots-exporter">https://github.com/cyberbotics/blender-webots-exporter</a> </p>
<h3>Ardupilot</h3>
<p><a href="https://ardupilot.org/dev/docs/sitl-with-webots-cpp.html">https://ardupilot.org/dev/docs/sitl-with-webots-cpp.html</a> </p>
<p><a href="https://ardupilot.org/rover/index.html">https://ardupilot.org/rover/index.html</a> </p>
<h1>Tutorial</h1>
<p>Webots 執行環境硬體需求:</p>
<p style="padding-left: 30px;">2GHz 4 核心以上 CPU, NVIDIA 或 AMD 支援 OpenGL 3.3 版, 帶有 512 MB 記憶體以上獨立顯示卡</p>
<p>操作系統:</p>
<p style="padding-left: 30px;">Windows 10 或 11 64 位元操作系統</p>
<p style="padding-left: 30px;">Ubuntu 24.04 以上版本</p>
<p style="padding-left: 30px;">macOS 12 以上版本操作系統</p>
<p>使用介面:</p>
<p style="padding-left: 30px;">Webots 可以透過 Tools - Preferences - Language 中選擇使用 English 或簡體中文介面 (目前無繁體中文介面, 介面語系翻譯請參考 <a href="https://github.com/cyberbotics/webots/tree/released/resources/translations">translations 頁面</a>說明), 在此強烈建議使用 English 界面即可.</p>
<hr/>
<p>Webots 原始碼使用授權:<br/><br/>採 <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license agreement</a>. Apache 2.0 是一種開放且對企業友善的授權條款, 允許任何人免費使用、修改和分享軟體的原始程式碼, 包括商業用途使用.</p>
<p>自行編譯 Webots 請參考 <a href="https://cyberbotics.com/doc/guide/building-webots">building Webots 頁面</a>說明.</p>
<p>Webots 套件中的大部分範例模擬檔案都使用 Apache 2.0 許可釋出, 但有部分機器人和物件模型（proto 檔案）則是根據 <a href="https://cyberbotics.com/webots_assets_license">Webots 資產的開放原始碼許可協議</a>發佈, 另外有些範例則是由用戶根據不同的開源許可證所提供, 這些檔案都會明確標示其許可證內容.</p>
<hr/>
<p>Webots 介紹: (查英英字典: <a href="https://www.merriam-webster.com/dictionary/">https://www.merriam-webster.com/dictionary/</a>)</p>
<p style="padding-left: 30px;"><a href="https://cyberbotics.com/doc/guide/introduction-to-webots#what-is-webots">What is Webots?</a></p>
<p style="padding-left: 30px;"><a href="https://cyberbotics.com/doc/guide/introduction-to-webots#what-can-i-do-with-webots">What can I do with Webots?</a></p>
<p style="padding-left: 30px;"><a href="https://cyberbotics.com/doc/guide/introduction-to-webots#webots-simulation">Webots simulation</a></p>
<p style="padding-left: 30px;"><a href="https://cyberbotics.com/doc/guide/introduction-to-webots#what-is-a-world">What is a world?</a></p>
<p style="padding-left: 30px;"><a href="https://cyberbotics.com/doc/guide/introduction-to-webots#what-is-a-controller">What is a controller?</a></p>
<p style="padding-left: 30px;"><a href="https://cyberbotics.com/doc/guide/introduction-to-webots#what-is-a-supervisor-controller">What is a supervisor controller?</a></p>
<p><a href="https://www.youtube.com/playlist?list=PLt69C9MnPchkLuNNc4q9SeMFA96_v4THJ">Webots Crash Course</a> (速成班教學影片)</p>
<p><a href="https://github.com/felipenmartins/Robotics-Simulation-Labs">https://github.com/felipenmartins/Robotics-Simulation-Labs</a> </p>
<hr/>
<p>第一個 Webots 導引: <a href="https://cyberbotics.com/doc/guide/tutorial-1-your-first-simulation-in-webots">https://cyberbotics.com/doc/guide/tutorial-1-your-first-simulation-in-webots</a></p>
<p>登入 Github, 在 <a href="https://github.com/copilot">https://github.com/copilot</a> 的協助下執行此一教學練習.</p>
<p>導引目的: You will create your first simulation containing a simple environment: an arena with floor and walls, a few boxes, an e-puck robot and a controller program that will make the robot move.</p>
<p>建立一個簡單的模擬環境, 意即一個競技場中, 包括一個帶有地板、圍牆、幾個盒子、一個 e-puck 機器人, 以及能讓機器人移動的控制程式.</p>
<p><img alt="" height="310" src="/images/tutorial_e-puck.thumbnail.jpg" width="400"/></p>
<p>開啟 Webots 前, 請下載 <a href="http://229.cycu.org/cad_data.7z">cad_data.7z</a> (包括 NX2312、Blender4.2 與 Webots2023b，4.2GB).</p>
<p>有關 Webots 在 Windows 操作系統啟動, 請參考<a href="https://cyberbotics.com/doc/guide/starting-webots#windows">說明</a>. 有關 Web streaming 也請參考<a href="https://cyberbotics.com/doc/guide/web-streaming">說明</a>.</p>
<p>Webots 的可執行檔案位於 Y:\Webots_2023b\msys64\mingw64\bin\Webotsw.exe, 配置時, 若希望在不上網的情況下執行官方範例, 則必須再預先下載 <a href="https://github.com/cyberbotics/webots/releases/tag/R2023b">https://github.com/cyberbotics/webots/releases/tag/R2023b</a> 中的 <a href="https://github.com/cyberbotics/webots/releases/download/R2023b/assets-R2023b.zip">assets-R2023b.zip</a>, 存入 Y:\home_ipv6\AppData\Local\Cyberbotics\Webots\cache\assets 目錄, 否則啟動官方範例時, 必須從官方網站下載各範例中所導入的原型節點資料.</p>
<p>若 Webotsw.exe 並非是在可攜程式的環境中啟動, 則 Webots 啟動後所下載的原型節點資料, 將會存入操作系統中的 C:\Users\%USERNAME%\AppData\Local\Cyberbotics\Webots\cache\assets 目錄中.</p>
<p>在可攜程式環境中啟動 Webots 的設定:</p>
<p style="padding-left: 30px;">start_ipv6.bat 中納入:</p>
<p style="padding-left: 30px;">REM for webots<br/>set  path_webots=%Disk%:\Webots_2023b\msys64\mingw64\bin;%Disk%:\Webots_2023b\msys64\usr\bin</p>
<p style="padding-left: 30px;">並將 %path_webots% 放入 PATH 環境變數設定中.</p>
<p style="padding-left: 30px;">若希望在執行 start_ipv6.bat 時開啟 Webots, 可以在啟動可攜程式的批次檔案中加入 start webotsw.exe</p>
<p>在可攜程式環境中 (USB 固態硬碟、一般隨身碟、筆電或個人電腦) 啟動 Webots 後, 開始建立模擬世界(即場景), 而在 Webots 中所謂場景:</p>
<p>A <strong>World</strong> is a file containing information like where the objects are, what they look like, how they interact with each other, what is the color of the sky, and the definitions of gravity, friction, masses of the objects, etc. It defines the initial state of a simulation. The different objects are called <strong>Nodes</strong> and are organized hierarchically in a <strong>Scene Tree</strong>. Therefore, a node may contain sub-nodes. A world is stored in a file having the <code>.wbt</code> extension. The file format is derived from the <a href="/downloads/vrml97specification.pdf">VRML97</a> language, and is human readable. The world files must be stored directly in a directory called <code>worlds</code>.</p>
<p>Webots 場景中包含以下定義:</p>
<ol>
<li>物件所在位置</li>
<li>物件的外形</li>
<li>物件如何互動</li>
<li>天空的顏色</li>
<li>地心引力的定義</li>
<li>摩擦力</li>
<li>物件的質量</li>
<li>模擬的起始條件</li>
<li>其他有關模擬的設定等</li>
</ol>
<p>場景中的物件稱為節點, 各節點配置於場景樹中, 各節點可以再包含子節點, 場景的檔案格式源自 VRML97 程式語法 (<a href="/downloads/vrmlman.pdf">VRML Primer and Tutorial</a>), 場景的檔案副檔名為 .wbt, 且一定要存入名稱為 worlds 的目錄中.</p>
<p>Webots 模擬選單功能說明: <a href="https://cyberbotics.com/doc/guide/the-user-interface#simulation-menu">https://cyberbotics.com/doc/guide/the-user-interface#simulation-menu</a> 其中著色選單可以關閉場景中的畫面, 主要配合基因演算、視覺辨識或機器學習流程中的快速模擬流程.</p>
<h2>Stage1</h2>
<p>學習利用 Webots 建立模擬場景的第一階段工作, 是認識其套件功能表與場景所需的目錄及檔案架構. 並且學習如何利用控制器程式操縱場景中的物件. 這也是 <a href="https://mde.tw/cad2025/content/Tutorial1.html">Tutorial1</a> 操作的主要目的.</p>
<p style="padding-left: 30px;">worlds 儲存 .wbt 場景檔案</p>
<p style="padding-left: 30px;">protos 儲存 .proto 原形節點檔案</p>
<p style="padding-left: 30px;">controllers 儲存控制器程式檔案</p>
<p style="padding-left: 30px;">plugins 儲存用來延伸 Webots 物理特性的 C 或 C++ 程式檔案, 例如: <a href="https://raw.githubusercontent.com/cyberbotics/webots/refs/heads/released/resources/projects/plugins/physics/physics.c">physics.c</a></p>
<p style="padding-left: 30px;">libraries 儲存場景中與 controllers 或 plugins 目錄中相關程式的共用程式庫檔案</p>
<p><a href="https://mde.tw/cad2025/content/Tutorial2.html">Tutorial2</a> 則說明如何使用 Webots 內建的基本幾何物件, 其中的物件幾何外形除了用於動力系統的運動方程式, 還可用於物體移動時的碰撞檢測. 建立物件時必須遵照 Solid - Shape - geometry 的樹狀結構規劃, 按照順序配置物件.</p>
<p>其中 Solid - Shape - geometry Box 可以直接使用內建的幾何節點定義零件外形, 而 Solid - Shape - geometry Mesh 則可以導入自行繪製的 STL 或 OBJ 零件檔案, 而 Solid - CadShape 也可以導入 OBJ 零件檔案, 與 geometry Mesh 的差別為 Solid - Shape - geometry Mesh 可以直接在 Webots 中設定零件顏色, 而 Solid - CadShape 則由 OBJ 伴隨的 .mtl 決定其顏色與材質.</p>
<h3>Tutorial1</h3>
<p>導引課程<br/><br/>本章的目的是解說 Webots 的基本概念，這些概念是自行創建模擬場景 (.wbt) 時必須用到的。學習重點在於熟悉機器人及其環境的模型建構流程，以及機器人控制器 (controllers) 的程式設計。進而學習如何尋找額外的教學資料。<br/><br/>本章適合 Webots 的初學者。不過，仍然需要有程式設計 (Programming) 的背景。範例是用 Python 語言編寫的。如果您不熟悉 Python 語言，透過基本說明應該還是能夠理解本章的控制器寫法，因為下面的 Python 程式非常簡單。除了程式設計，您不需要任何特定的知識即可完成本章中的教程。然而，基本的機器人學 (Robotcs)、數學 (Mathematics)、模型建構 (Modeling) 和樹狀表示法 (Tree representation) 的背景知識可能會有所幫助。有經驗的 Webots 使用者可以跳過最初的教程。不過，我們建議至少能花點時間閱讀這些教程的介紹和結論。<br/><br/>本章的每個部分（除了第一和最後一部分）都是一個導引課程。每個導引課程都有一個明確的教育目標，並在第一段中進行解釋。獲得的概念隨後會在結論子部分中總結。每一個導引課程都被設計成一系列互動操作步驟。要繼續進行下一個教程，通常需要掌握前一個教學中獲得的知識。因此，我們強烈建議按照導引所安排的順序進行。此外，我們建議在繼續進一步之前，確保已經理解了導引課程中的所有概念。<br/><br/>最後一部分將提供一些解決本章未涉及問題的提示。<br/><br/>導引課程的解決方案位於 Webots 安裝目錄的 "WEBOTS_HOME/projects/samples/tutorials" 子目錄中。</p>
<p>導引課程 1：在 Webots 中進行首次模擬<br/><br/>目標<br/><br/>本導引課程的目標是讓您熟悉用戶界面和 Webots 的基本概念。您將創建一個包含簡單環境的首次模擬：一個帶有地板和牆壁的競技場、幾個箱子、一個 e-puck 機器人和一個使機器人移動的控制程式。<br/><br/>步驟<br/><br/>1. 啟動 Webots：在您的電腦上打開 Webots (假如使用協同產品設計課程的可攜套件，啟動後在命令列中輸入 webotsw 即可開啟 Webots, 若要同時啟動串流伺服器，則可輸入 webotsw --stream，之後可利用瀏覽器在伺服器的 IP 位址上以串流內建埠號 1234 連接觀看場警)。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #1：通過雙點擊 Webots 圖標（或在終端中從命令行調用）來啟動 Webots。如果您是第一次在此電腦上運行 Webots，可能會提示您選擇圖形主題。您也可能被邀請參加 Webots 指導遊覽，請關閉指導遊覽。</span></p>
<p>2. 創建新世界：<br/>    - 先以 File -&gt; New Project Directory， 選擇專案存檔目錄後，轉到 File -&gt; New World。<br/>    - 使用適當的名稱保存新世界文件，例如 my_first_simulation.wbt。</p>
<p>3. 添加競技場：<br/>    - 在場景樹中，右鍵點擊 root 並選擇 Add New -&gt; Solid。<br/>    - 將新固體重命名為 arena 並為其添加 Shape。<br/>    - 將其幾何形狀設置為 Box，並設置適當的尺寸（例如，1m x 1m x 0.01m）來表示地板。<br/>    - 為形狀添加 Material 並設置其顏色。</p>
<hr/>
<p>備註:</p>
<p style="padding-left: 30px;">Solid -&gt; Shape -&gt; Box 或其他基本幾何物件</p>
<p style="padding-left: 30px;">Solid -&gt; Shape -&gt; Mesh 則可以導入 STL 或 OBJ 檔案</p>
<p style="padding-left: 30px;">CadShape 也可以導入 STL 或 OBJ 檔案</p>
<hr/>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #2：通過點擊 3D 視圖的暫停按鈕來暫停當前模擬（請參閱用戶界面描述以找到按鈕）。如果主工具欄上的虛擬時間計數器停止，則模擬被暫停。從 File / New / New Project Directory... 菜單項創建一個新項目並按照說明進行：</span><br/><br/><span style="background-color: #ccffcc;">1. 將項目目錄命名為 my_first_simulation，而不是建議的 my_project。</span><br/><span style="background-color: #ccffcc;">2. 將世界文件命名為 my_first_simulation.wbt，而不是建議的 empty.wbt。</span><br/><span style="background-color: #ccffcc;">3. 點擊所有選框，包括默認未選中的 "Add a rectangle arena"。</span></p>
<p>4. 添加牆壁：<br/>    - 重複該過程以在競技場周圍添加四面牆壁。<br/>    - 調整它們的位置和尺寸以適合地板周圍。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #3：在場景樹中雙擊 RectangleArena 節點。這應該會打開該節點並顯示其字段。</span><br/><br/><span style="background-color: #ccffcc;">1. 選擇 floorTileSize 字段並將其值設置為 0.25 0.25 而不是 0.5 0.5。您應該立即在 3D 視圖中看到效果。</span><br/><span style="background-color: #ccffcc;">2. 選擇 wallHeight 字段並將其值更改為 0.05 而不是 0.1。競技場的牆壁現在應該變得更低。</span></p>
<p>5. 添加箱子：<br/>    - 在競技場內添加幾個箱子作為障礙物。<br/>    - 根據您的喜好設置它們的位置和尺寸。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #4：在場景樹中雙擊 RectangleArena 以將其關閉並選中它。點擊場景樹頂部的添加按鈕。在打開的對話框中，選擇 PROTO nodes (Webots Projects) / objects / factory / containers / WoodenBox (Solid)。一個大箱子應該會出現在競技場的中央。在場景樹中雙擊它以打開其字段。</span><br/><br/><span style="background-color: #ccffcc;">1. 將其尺寸更改為 0.1 0.1 0.1 而不是 0.6 0.6 0.6。</span><br/><span style="background-color: #ccffcc;">2. 將其平移更改為 0 0 0.05 而不是 0 0 0.3。或者，您可以使用 3D 視圖中出現的藍色箭頭來調整其 translation.z 字段。</span><br/><span style="background-color: #ccffcc;">3. 現在按住 Shift 鍵並在 3D 視圖中拖動箱子，將其移動到競技場的某個角落。</span><br/><span style="background-color: #ccffcc;">4. 選擇箱子並按 ctrl-C，ctrl-V（Windows，Linux）或 ⌘ command-C，⌘ command-V（macOS）來複製和粘貼它。按住 Shift 鍵並拖動新箱子將其移動到某個不同的位置。以這種方式創建第三個箱子。</span><br/><span style="background-color: #ccffcc;">5. 移動箱子，使競技場中央沒有箱子。您也可以使用藍色旋轉箭頭沿垂直軸旋轉箱子。這也可以通過按住 Shift 鍵並用右鍵拖動來完成。或者，您可以更改場景樹中 WoodenBox 節點的旋轉字段的角度。</span><br/><span style="background-color: #ccffcc;">6. 一旦您對結果滿意，請使用保存按鈕保存世界。</span></p>
<p>6. 添加 e-puck 機器人：<br/>    - 在場景樹中，右鍵點擊 root 並選擇 Add New -&gt; Robot。<br/>    - 從可用機器人列表中選擇 e-puck 機器人。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #5：選擇場景樹視圖中的最後一個節點 WoodenBox。點擊場景樹視圖頂部的添加按鈕。在對話框中，選擇 PROTO nodes (Webots Projects) / robots / gctronic / e-puck / E-puck (Robot)。一個 e-puck 機器人應該會出現在競技場的中央。像移動和旋轉箱子一樣移動和旋轉這個機器人。保存模擬並按下實時運行按鈕。</span></p>
<p>7. 創建控制程式：<br/>    - 在場景樹中右鍵點擊 e-puck 並選擇 Add New -&gt; Controller。<br/>    - 選擇以 Python 程式語法創建一個新的控制器文件（例如，epuck_controller.py）並編寫一個簡單的程式來使機器人移動。例如：</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">from controller import Robot, Motor  # 從 controller 模組導入 Robot 和 Motor 類別

TIME_STEP = 64  # 設置時間步長為 64 毫秒

# 創建 Robot 實例
robot = Robot()

# 擷取電機設備
leftMotor = robot.getDevice('left wheel motor')  # 獲取左側輪子電機設備
rightMotor = robot.getDevice('right wheel motor')  # 獲取右側輪子電機設備

# 設置電機的目標位置
leftMotor.setPosition(10.0)  # 設置左側輪子電機的目標位置為 10.0
rightMotor.setPosition(10.0)  # 設置右側輪子電機的目標位置為 10.0

while robot.step(TIME_STEP) != -1:  # 當機器人步進時間步長不等於 -1 時（模擬仍在運行）
    pass  # 什麼也不做，保持循環運行</pre>
<p>8. 保存並運行模擬：<br/>    - 保存您的世界文件。<br/>    - 點擊 Play 按鈕運行模擬並觀察機器人移動。<br/><br/>結論<br/><br/>在本導引課程中，您已經學習了如何在 Webots 中創建一個簡單的模擬，包括添加競技場、牆壁、障礙物和 e-puck 機器人。您還創建了一個基本的控制程式來使機器人移動。本導引課程已經為您探索 Webots 更進階功能提供了充實的基礎。</p><h3>Tutorial2</h3>
<p>導引課程 2：修改環境<br/><br/>在本導引課程中，我們將教您如何在環境中創建簡單的物件。第一步將是創建一個與環境互動的球。我們將處理與節點相關的幾個概念：它們的含義是什麼，如何創建它們，它們如何必須隸屬等等。此外，我們還將看到如何設置物理效果。<br/><br/>將介紹幾種節點類型。它們的詳細定義可以在<a href="https://cyberbotics.com/doc/reference/nodes-and-api-functions">參考手冊</a>中找到。將<a href="https://cyberbotics.com/doc/reference/node-chart">節點圖表</a>放在您面前，將有助於理解節點的繼承關係。</p>
<p>一個新的模擬<br/><br/>首先，我們基於教程 1 中創建的模擬來創建一個新的模擬。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #1：確保 my_first_simulation.wbt 世界文件已打開，並且模擬已暫停且虛擬時間為 0。使用 File / Save World As... 菜單將模擬保存為 obstacles.wbt。</span></p>
<p>修改地板<br/><br/>內定的 RectangleArena PROTO 定義了一個簡單的地板，固定在靜態環境中，沒有物理節點，四周則被牆壁包圍。Webots 物件庫中還有其他預製的地板。我們現在將刪除 RectangleArena 節點，並添加一個簡單的地板，稍後在本教程中我們將手動用牆壁圍繞它。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #2：要刪除 RectangleArena，請在 3D 視圖或場景樹視圖中選中它，然後按鍵盤上的 del 鍵。或者，您可以在 3D 視圖中右鍵單擊它，然後在上下文菜單中選擇 Delete（您也可以直接在場景樹視圖中使用上下文表單）。選擇 TexturedBackgroundLight 節點並點擊添加按鈕。在打開的對話框中，選擇 PROTO nodes (Webots Projects) / objects / floors / Floor (Solid)。</span></p>
<p>新添加的 Floor PROTO 默認大小為 10 米 x 10 米，但可以通過更改相應的欄位 (field) 來調整其大小、位置和紋理。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #3：在場景樹視圖中選擇並展開 Floor。修改 size 欄位並將其設置為 {1, 1} 以將其調整為 1 米 x 1 米。</span></p>
<p><a href="https://cyberbotics.com/doc/reference/solid">Solid</a> 節點<br/><br/>本小節介紹了 Webots 中最重要的基礎節點：<a href="https://cyberbotics.com/doc/reference/solid">Solid</a> 節點，許多其他節點都從它衍生而來。<br/><br/><span style="background-color: #ffff99;"><a href="https://cyberbotics.com/doc/reference/solid" style="background-color: #ffff99;">Solid</a> 節點代表剛體</span>，即可以忽略變形的物體。剛體中任意兩點之間的距離無論外力如何作用，都保持恆定。例如桌子、機器人手指骨節或輪子都是剛體。軟體和關節物體不是剛體。例如繩子、輪胎、海綿或關節機器人手臂都不是剛體。然而，一個關節實體可以被分解成若干剛體。<br/><br/>Webots 的物理引擎設計用於模擬剛體。設計模擬時，一個重要的步驟是將各種實體分解為單獨的剛體。<br/><br/>要定義剛體，您需要創建一個 <a href="https://cyberbotics.com/doc/reference/solid">Solid</a> 節點。在此節點內，您將設置對應於剛體特性的不同子節點。下圖描述了一個剛體及其子節點。<a href="https://cyberbotics.com/doc/reference/solid">Solid</a> 節點的圖形表示由填充其子級列表的形狀節點定義。碰撞範圍在其 boundingObject 欄位中定義。圖形表示和碰撞形狀通常但不必然相同。最後，<span style="background-color: #ffff99;">physics 欄位定義物體屬於動態環境還是靜態環境</span>。所有這些子節點都是可選的，但 physics 欄位設定時，需要同時定義 boundingObject。</p>
<p><img caption="false" height="248" src="/images/simplest_rigit_body_object.png" width="300"/></p>
<p>在 Webots 中，最簡單的剛體模型具有<span style="background-color: #ffff99;">幾何外形圖示</span> (以 Shape 中的 Geometry 標示其<span style="background-color: #ccffcc;">視覺外形</span>)、<span style="background-color: #ffff99;">物理邊界形體</span> (以 boundingObject 中的 Geometry 標示其<span style="background-color: #ccffcc;">碰撞檢測外形</span>) 並處於<span style="background-color: #ffff99;">動態環境</span> (以 physics 中的 Physics 標示其<span style="background-color: #ccffcc;">物理特性參數</span>) 中。<br/><br/>圖中的幾何框代表任何類型的幾何原始體。事實上，它可以被替換為球體、盒子、圓柱體等。</p>
<p>創建一個球<br/><br/>我們現在將在模擬中添加一個球。該球將被建模為剛體，如下圖所示。我們將使用 <a href="https://cyberbotics.com/doc/reference/sphere">Sphere</a> 節點來定義我們球的幾何形狀。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #4：在場景樹視圖中，選擇最後一個節點並按「Add」按鈕。在對話框中，打開「Bases nodes」部分並選擇「<a href="https://cyberbotics.com/doc/reference/solid">Solid</a>」節點。在場景樹視圖中，展開「<a href="https://cyberbotics.com/doc/reference/solid">Solid</a>」節點並選擇其「children」欄位。使用「Add」按鈕向其添加一個「<a href="https://cyberbotics.com/doc/reference/shape">Shape</a>」節點。選擇「<a href="https://cyberbotics.com/doc/reference/shape">Shape</a>」節點的「appearance」欄位，並使用「Add」按鈕添加一個「PBRAppearance」節點。</span><br/><br/><span style="background-color: #ccffcc;">    添加一個「Sphere」節點作為新創建的「<a href="https://cyberbotics.com/doc/reference/shape">Shape</a>」節點的幾何欄位。</span><br/><span style="background-color: #ccffcc;">    展開「PBRAppearance」節點，將其「metalness」欄位更改為 0，並將其「roughness」欄位更改為 1。</span><br/><span style="background-color: #ccffcc;">    向「<a href="https://cyberbotics.com/doc/reference/solid">Solid</a>」的「boundingObject」欄位添加另一個「<a href="https://cyberbotics.com/doc/reference/sphere">Sphere</a>」節點。</span><br/><span style="background-color: #ccffcc;">    最後，向「<a href="https://cyberbotics.com/doc/reference/solid">Solid</a>」的「physics」欄位添加一個「Physics」節點。</span><br/><span style="background-color: #ccffcc;">    通過修改「<a href="https://cyberbotics.com/doc/reference/solid">Solid</a>」節點的「translation」欄位，將球放置在機器人前面（例如在 {0.2, 0, 0.2}）。</span><br/><span style="background-color: #ccffcc;">    保存模擬。</span><br/><span style="background-color: #ccffcc;">    結果如下圖所示。</span></p>
<p><img alt="" height="157" src="/images/tutorial_ball.thumbnail.jpg" width="300"/></p>
<p>你的第一個 Webots 剛體<br/><br/>當模擬開始時，球會撞擊地板。您可以通過對球施加力來移動它（ctrl + alt + 左鍵單擊並拖動）。通過啟用 View / Optional Rendering / Show Contact Points 表單項，可以顯示球與地板之間的接觸點作為青色線條。</p>
<p>幾何體<br/><br/>為了定義球，我們在兩個不同的上下文中使用了 Sphere 節點：圖形表示 (graphical representation)（children）和定義物理邊界 (physical bounds)（boundingObject）。所有幾何節點（例如 Sphere 節點）都可以在圖形標示中使用。但是，只有其中的一部分可以在物理標示中使用。<a href="https://cyberbotics.com/doc/reference/node-chart">節點圖表</a>中則明確指出哪些節點可以用在何種標示。(這裡需要進一步說明各節點的適用情境)<br/><br/>我們現在將縮小球體的尺寸，並通過增加用於表示它的三角形數量來提高其圖形質量。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #5：對於定義球的每個 Sphere 節點，將其 radius 欄位設置為 0.05，將其 subdivision 欄位設置為 2。請參考 <a href="https://cyberbotics.com/doc/reference/sphere">sphere 手冊</a>了解 subdivision 欄位的含義。</span></p>
<p>DEF-USE 機制<br/><br/>DEF-USE 機制允許在一個地方定義一個節點，並在場景樹的其他地方重用該定義。這對於避免在世界文件中重複相同的節點非常有用。此外，它還允許用戶同時修改多個對象。其工作原理如下：首先使用 DEF 字符串標記一個節點。然後可以使用 USE 關鍵字在其他地方重用該節點的副本。只有 DEF 節點的欄位可以編輯，USE 節點的欄位繼承自 DEF 節點，無法更改。此機制依賴於世界文件中節點的順序。DEF 節點應在任何相應的 USE 節點之前定義。<br/><br/>我們之前用來定義球的兩個 Sphere 定義是冗餘的。我們現在將使用 DEF-USE 機制將這兩個 Sphere 合併為一個。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #6：在場景樹視圖中選擇第一個 Sphere 節點（Shape 的子節點）。場景樹視圖的欄位編輯器允許您輸入 DEF 字符串。</span><br/><br/><span style="background-color: #ccffcc;">    在此欄位中輸入 BALL_GEOMETRY。</span><br/><span style="background-color: #ccffcc;">    選擇 boundingObject 欄位（包含第二個 Sphere 節點），通過右鍵單擊該欄位並選擇彈出上下文菜單中的「Delete」條目來清空它。</span><br/><span style="background-color: #ccffcc;">    然後，選擇 boundingObject 欄位並單擊「Add」按鈕，在對話框中選擇 USE / BALL_GEOMETRY。</span><br/><span style="background-color: #ccffcc;">    結果如圖所示。</span></p>
<p>現在，更改第一個 Sphere 節點的 radius 欄位也會修改其 boundingObject。<br/><br/>為了方便起見，boundingObject 欄位也接受 <a href="https://cyberbotics.com/doc/reference/shape">Shape</a> 節點（而不是直接接受 Sphere 節點）。同樣可以在 <a href="https://cyberbotics.com/doc/reference/shape">Shape</a> 層級使用相同的 DEF-USE 機制，如下圖所示。目前最大的好處是能夠直接將此 <a href="https://cyberbotics.com/doc/reference/shape">Shape</a> 用於圖形目的。稍後此機制對於某些傳感器將非常有用。</p>
<p><img alt="" height="157" src="/images/tutorial_def_use.thumbnail.jpg" width="300"/></p>
<p>在名為 BALL_GEOMETRY 的 Sphere 節點上使用 DEF-USE 機制。</p>
<p><img alt="" height="200" src="/images/tutorial2_DEF_USE.png" width="300"/></p>
<p>在 Solid 的<span style="background-color: #ffff00;">幾何體的 Sphere 節點上應用 DEF-USE 機制</span>。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #7：創建第二個球，使用相同的參數，但使用 <a href="https://cyberbotics.com/doc/reference/shape">Shape</a> 節點（而不是直接使用 Sphere 節點）來實現 DEF-USE 機制。</span></p>
<p>添加牆壁<br/><br/>為了驗證您的進展，請自行實現四面牆來圍繞環境。這些牆必須靜態地定義到環境中。為了理解靜態和動態之間的區別，讓我們取一個地面上的定義物體（球）。如果 Physics 節點為 NULL，它將在模擬期間保持靜止在空中（靜態情況）。如果 physics 欄位包含 Physics 節點，它將在重力作用下掉落（動態情況）。<br/><br/>儘量在<a href="https://cyberbotics.com/doc/reference/shape">Shape</a> 層級使用 DEF-USE 機制，而不是在 Geometry 層級。確實，將中間 Shape 節點添加到 Solid 節點的 boundingObject 欄位中更方便。實現牆壁的最佳幾何原語是 <a href="https://cyberbotics.com/doc/reference/box">Box</a> 節點。所有牆壁只需定義一個 <a href="https://cyberbotics.com/doc/reference/shape">Shape</a>。預期結果如圖所示。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #8：添加四面牆，無需物理效果，並且只使用一個 Shape 節點的定義。</span></p>
<p>解決方案：世界文件<br/><br/>要將您的世界與解決方案進行比較，請進入您的文件並找到在<a href="https://mde.tw/cd2025/content/Tutorial1.html">導引課程1</a>中創建的名為 "my_first_simulation" 的文件夾，然後進入 "worlds" 文件夾並用文本編輯器打開相應的世界文件。此解決方案與其他解決方案位於 solution 目錄中。</p>
<p><img alt="" height="157" src="/images/tutorial_walls.thumbnail.jpg" width="300"/></p>
<p>在本教程結束時的模擬狀態。</p>
<p>效率<br/><br/>剛體的模擬計算代價高昂。通過最小化邊界對象的數量、最小化它們之間的約束（有關約束的更多信息在後續教程中），以及最大化 WorldInfo.basicTimeStep 欄位，可以提高模擬速度。在每次模擬中，必須在模擬速度和現實感之間找到權衡。</p>
<p>結論<br/><br/>在本教程結束時，您將能夠基於剛體創建簡單的環境。您能夠從場景樹視圖中添加節點並修改其欄位。您已經熟悉了 <a href="https://cyberbotics.com/doc/reference/solid">Solid</a>、Physics、<a href="https://cyberbotics.com/doc/reference/shape">Shape</a>、Sphere 和 <a href="https://cyberbotics.com/doc/reference/box">Box</a> 節點。您還看到了 DEF-USE 機制，該機制允許減少場景樹的節點冗餘。</p>
<h2>Stage2</h2>
<p>Webots 進入第二階段，包含零件的外觀 (<a href="https://mde.tw/cad2025/content/Tutorial3.html">Tutorial3</a>)，控制與感測 (<a href="https://mde.tw/cad2025/content/Tutorial4.html">Tutorial4</a>)，以及複合外形零件的建構 (<a href="https://mde.tw/cad2025/content/Tutorial5.html">Tutorial5</a>) 等議題.</p>
<p>利用 <a href="https://mde.tw/cd2025/content/Tutorial5.html">Tutorial5</a> 中的 Group 節點，可配合 CAD 套件轉出的零組件，整合出更複雜外形的模擬場景。</p>
<p>使用 CAD 套件繪製機構所需零件，因為在組立時各零件已經完成定位，因此使用上，只要透過 Solid - <a href="https://cyberbotics.com/doc/reference/cadshape">CadShape</a> 導入 obj 格式的零件檔案，或使用 Solid - Shape - Mesh (導向 obj 或 stl 格式檔案) 即可在模擬場景中套用，至於各連桿 <a href="https://cyberbotics.com/doc/reference/solid">Solid</a> 節點中的 boundingObject 欄位, 只要利用 <a href="https://cyberbotics.com/doc/reference/mesh?version=R2025a">Mesh</a> 節點中的 url 指向物件 obj 或 stl 檔案即可.</p>
<p>另外 <a href="https://cyberbotics.com/doc/reference/hingejoint">hingeJoint</a> 中的 <a href="https://cyberbotics.com/doc/reference/hingejointparameters">HingeJointParameters</a> 則宣告該轉軸所在位置 (anchor) 以及旋轉軸向量 (axis) 即可.</p>
<p>Plotter 中驅動馬達的模擬，則必須使用 <a href="https://mde.tw/cad2025/content/Tutorial4.html">Tutorial4</a> 中的控制與感測技術.</p>
<h3>Tutorial3</h3>
<p>導引課程 3：外觀<br/><br/>本導引課程的目的是讓你熟悉一些與圖形著色 (rendering) 相關的節點。當這些節點被適當使用時，可以很快創建出外觀良好的模擬。良好的圖形質量不僅能提升用戶體驗，對於機器人感知其環境的模擬（如攝像頭圖像處理、循線等）也是至關重要的。<br/><br/>本教學結束時的效果如下圖所示。</p>
<p><img alt="" height="158" src="/images/tutorial_appearance.thumbnail.jpg" width="300"/></p>
<p>新模擬</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #1：創建新模擬</span><br/><br/><span style="background-color: #ccffcc;">從上一個教程的結果中，通過使用檔案 / 另存世界... 菜單創建一個名為 "appearance.wbt" 的新模擬。</span></p>
<p>燈光<br/><br/>世界的燈光由燈光節點 (<a href="https://cyberbotics.com/doc/reference/light">Light</a>) 和背景 (<a href="https://cyberbotics.com/doc/reference/background">Background</a>) 決定。燈光節點有三種類型：方向燈 (<a href="https://cyberbotics.com/doc/reference/directionallight">DirectionalLight</a>)、單點燈 (<a href="https://cyberbotics.com/doc/reference/pointlight">PointLight</a>) 和聚光燈 (<a href="https://cyberbotics.com/doc/reference/spotlight">SpotLight</a>)。方向燈模擬無限遠的光源（例如：太陽），點燈模擬從單一點發出的光（例如：燈泡），而聚光燈模擬錐形光（例如：手電筒）。下面這張圖展示了它們之間的比較。每種類型的燈光節點都可以投射陰影。你可以在<a href="https://cyberbotics.com/doc/reference/nodes-and-api-functions">參考手冊</a>中找到它們的完整文檔。</p>
<p><img alt="" height="68" src="/images/tutorial_light_comparison.thumbnail.jpg" width="300"/></p>
<p>三種在 Webots 中可能的燈光比較。左邊是方向燈 (DirectionalLight)，中間是聚光燈 (SpotLight)，右邊是點燈 (PointLight)。</p>
<p>在模擬中設置燈光就性能上需要耗費運算資源，會降低模擬速度（尤其是在投射陰影時）。最小化燈光數量可以提高渲染速度。單點燈 (PointLight) 比聚光燈 (SpotLight) 更高效，但比方向燈 (DirectionalLight) 效率低。<br/><br/>在本次模擬中，燈光節點在場景樹中不可見，因為它包含在<a href="https://webots.cloud/run?url=https://github.com/cyberbotics/webots/blob/released/projects/objects/backgrounds/protos/TexturedBackgroundLight.proto"> TexturedBackgroundLight</a> PROTO 節點中。它由一個方向燈 (DirectionalLight) 組成，其強度和方向根據場景背景自動計算。<br/><br/>修改牆壁的外觀<br/><br/>本小節的目標是將牆壁顏色改為藍色。<br/><br/>形狀節點 (<a href="https://cyberbotics.com/doc/reference/shape">Shape</a>) 的外觀 (<a href="https://cyberbotics.com/doc/reference/appearance">Appearance</a>) 和 PBR 外觀 (<a href="https://cyberbotics.com/doc/reference/pbrappearance">PBRAppearance</a>) 節點決定了物件的圖形外觀。在其他方面，這些節點負責物件的顏色和紋理。<br/><br/>如以下比較所示，建議使用 PBR 外觀以獲得更好的渲染效果。</p>
<p><img alt="" height="92" src="/images/tutorial_appearance_comparison.thumbnail.jpg" width="300"/></p>
<p>外觀節點 (Appearance) 和 PBR 外觀節點 (PBRAppearance) 的比較。左邊是外觀節點 (Appearance)，右邊是 PBR 外觀節點 (PBRAppearance)。</p>
<p>PBRAppearance 節點指定了一個節點的基於物理的視覺外觀。縮寫 "PBR" 指的是 "Physically-Based Rendering"（基於物理的渲染），這個術語用來表示一類基於物體物理特性的著色模型，而不是像在 Appearance 節點中使用的 Blinn-Phong BRDF 這樣的更古老的模型。</p>
<p><a href="https://en.wikipedia.org/wiki/Blinn%E2%80%93Phong_reflection_model">Blinn–Phong</a> 反射模型，也稱為修改的 Phong 反射模型，是由 <a href="https://en.wikipedia.org/wiki/Jim_Blinn">Jim Blinn</a> 開發的 <a href="https://en.wikipedia.org/wiki/Phong_reflection_model">Phong 反射模型</a>的修改版本。<br/><br/>Blinn–Phong 是一種在 OpenGL 和 Direct3D 的固定功能管線（在 Direct3D 10 和 OpenGL 3.1 之前）中使用的著色模型，並在每個頂點上進行處理，當它通過圖形管線時；頂點之間的像素值默認由 <a href="https://en.wikipedia.org/wiki/Gouraud_shading">Gouraud</a> 著色插值，而不是計算成本更高的 <a href="https://en.wikipedia.org/wiki/Phong_shading">Phong</a> 著色。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #2：在圖形表示第一面牆的形狀節點 (Shape) 中，將 PBRAppearance 節點添加到外觀 (Appearance) 欄位。</span><br/><br/><span style="background-color: #ccffcc;">- 使用顏色選擇器將其 baseColor 欄位設置為藍色。</span><br/><span style="background-color: #ccffcc;">- 使用欄位編輯器將其 metalness 欄位設置為 0。</span><br/><span style="background-color: #ccffcc;">- 最後，使用欄位編輯器將其 roughness 欄位設置為 0.5。</span><br/><span style="background-color: #ccffcc;">- 如果上一個教程中的 DEF-USE 機制正確實施，所有牆壁應該都會變成藍色。</span></p>
<p>添加現有的外觀到球體<br/><br/>Webots 發行版中提供了許多預定義的 PBRAppearance。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #3：添加預定義的 PBRAppearance</span><br/><br/><span style="background-color: #ccffcc;">    選擇外觀 (appearance) 欄位並刪除之前添加的節點。要刪除此節點，可以按鍵盤上的 "delete" 鍵，或右鍵點擊該欄位並從菜單中選擇 "delete"。此欄位現在應顯示為 "appearance NULL" 而不是 "appearance PBRAppearance"。</span><br/><span style="background-color: #ccffcc;">    再次雙擊該欄位，然後導航到 PROTO 節點 (Webots Projects)，再導航到 appearances，並選擇 OldSteel (PBRAppearance)。</span></p>
<p>添加硬碟中儲存的紋理<br/><br/>本小節的目標是將本地可用的紋理應用到球上。在滾動的物體加上紋理可更容易檢視其運動情況。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #4：將本地可用的紋理添加到球體。</span><br/><br/><span style="background-color: #ccffcc;">1. 下載<a href="https://raw.githubusercontent.com/cyberbotics/webots/released/projects/default/worlds/textures/red_brick_wall.jpg" style="background-color: #ccffcc;">這裡</a>所提供的紋理並將其儲存到硬碟中。</span><br/><span style="background-color: #ccffcc;">2. 從外觀 (appearance) 欄位中刪除先前添加的節點，並改為添加一個 PBRAppearance 節點。</span><br/><span style="background-color: #ccffcc;">3. 向 PBRAppearance 節點的 baseColorMap 欄位添加一個 ImageTexture 節點。</span><br/><span style="background-color: #ccffcc;">4. 使用 "Add" 按鈕向 ImageTexture 的 url 欄位添加一個項目。</span><br/><span style="background-color: #ccffcc;">5. 然後使用 "Select" 按鈕設置新添加的 url 項目的值。</span><br/><span style="background-color: #ccffcc;">6. 跟隨路徑到您保存紋理的位置並選擇它。</span></p>
<p>紋理 URL 必須定義為相對於專案目錄的 worlds 目錄或相對於預設專案目錄 WEBOTS_HOME/projects/default/worlds。<br/><br/>在圖像查看器中打開 red_brick_wall.jpg 紋理，同時觀察它如何映射到 Webots 中的 Sphere 節點上。<br/><br/>紋理根據參考手冊中描述的預定義 UV 映射函數映射到幾何節點上。UV 映射函數將 2D 圖像表示映射到 3D 模型。</p>
<p><img alt="" height="158" src="/images/tutorial_appearance.thumbnail.jpg" width="300"/></p>
<p>在設置好 Light 和 PBRAppearance 節點後的模擬。</p>
<p>渲染選項<br/><br/>Webots 在視圖菜單中提供了幾種渲染模式。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #5：使用"視圖 / 線框渲染" (View / Wireframe Rendering) 表單項以線框模式查看模擬。然後還原為普通渲染模式："視圖 / 普通渲染" (View / Plain Rendering)。</span></p>
<p>其他渲染功能也很有幫助：<br/><br/>    查看座標系統： View / Optional Rendering / Show Coordinates System 或使用 ctrl-F1<br/>    查看距離傳感器光線： View / Optional Rendering / Show DistanceSensor Rays 或使用 ctrl-F10</p>
<p>解決方案：世界文件<br/><br/>要將您的世界與解決方案進行比較，請轉到您的文件並找到在 <a href="https://mde.tw/cd2025/content/Tutorial1.html">Tutorial1</a>中創建的名為 my_first_simulation 的文件夾，然後轉到 worlds 文件夾並使用文本編輯器打開正確的世界文件。<a href="https://github.com/cyberbotics/webots/tree/released/projects/samples/tutorials/worlds/appearance.wbt">此解決方案</a>和其他解決方案位於<a href="https://github.com/cyberbotics/webots/tree/released/projects/samples/tutorials/worlds/">解決方案目錄</a>中。<br/><br/>結論<br/><br/>在本導引課程中，您學習了如何使用 <a href="https://cyberbotics.com/doc/reference/pbrappearance">PBRAppearance</a> 節點和光源節點設置一個美觀的環境。<br/><br/>您可以通過閱讀參考手冊中這些節點的詳細描述來進一步了解此主題。此<a href="https://github.com/cyberbotics/webots/discussions/5411">常見問題</a>解答將為您提供有效設置這些節點的方法。</p>
<h3>Distancesensor</h3>
<p><a href="https://cyberbotics.com/doc/reference/distancesensor">https://cyberbotics.com/doc/reference/distancesensor</a></p>
<p>Derived from <a class="dynamicLoad" href="https://cyberbotics.com/doc/reference/device">Device</a> and <a class="dynamicLoad" href="https://cyberbotics.com/doc/reference/solid">Solid</a>.</p>
<pre class="brush:js;auto-links:false;toolbar:false" contenteditable="false">DistanceSensor {
  MFVec3f  lookupTable              [ 0 0 0, 0.1 1000 0 ] # lookup table
  SFString type                     "generic"             # {"generic", "infra-red", "sonar", "laser"}
  SFInt32  numberOfRays             1                     # [1, inf)
  SFFloat  aperture                 1.5708                # [0, 2*pi]
  SFFloat  gaussianWidth            1                     # [0, inf)
  SFFloat  resolution               -1                    # {-1, [0, inf)}
  SFFloat  redColorSensitivity      1                     # [0, inf)
}</pre>
<p>在 Webots 的 DistanceSensor 設為紅外線（Infra-red, IR）模式時，lookupTable 欄位用於將感測器的原始輸出值（通常是類比值，例如AD值或電壓）對應到實際的距離（通常以米為單位）。這個對應關係並非線性，且會根據不同的紅外線感測器型號而有所不同，因此需要用 lookupTable 明確設定。</p>
<p>lookupTable 的格式說明<br/><br/>lookupTable 是一串三元組（triplet）組成的陣列，每個三元組代表：</p>
<p>[distance, value, standardDeviation]</p>
<p>distance：真實世界對應的距離（單位：公尺）。<br/>value：感測器輸出的原始值（通常為電壓或AD值）。<br/>standardDeviation：該點測量的誤差標準差（單位：公尺，非必需，可設為0）。</p>
<p><br/>第一欄：輸入的距離（distance，單位：公尺）<br/>第二欄：對應的感測器反應值（response value，通常是電壓或 AD 值）<br/>第三欄：對應的標準差（standard deviation）</p>
<p>例如:</p>
<p>lookupTable [<br/>  0.05 100 0.01<br/>  0.20 400 0.01<br/>  0.80 800 0.01<br/>]</p>
<p>這代表：<br/><br/>當輸出值為 100 時，對應距離為 0.05 公尺。<br/>當輸出值為 400 時，對應距離為 0.20 公尺。<br/>... 以此類推。<br/><br/>Webots 會用這些點做線性內插，將感測器讀數（例如 350）對應到距離。</p>
<p> 設定 lookupTable 的方法<br/><br/>查閱感測器手冊：取得原廠提供的「輸出值 vs 距離」對照表。<br/>選擇幾個代表性數值：通常選 3~5 組即可覆蓋感測範圍。<br/>將其填入 lookupTable：</p>
<p>使用 lookupTable 設定的意義<br/><br/>lookupTable 告訴 Webots「當感測器輸出某值時，應該對應到什麼距離」。<br/>因為紅外線測距不是線性的，所以線性內插比直接計算更準確。<br/>這讓模擬更貼近真實感測器行為。</p>
<h3>Tutorial4</h3>
<p>導引課程 4：更多關於控制器的內容<br/><br/>現在我們開始討論與編程機器人控制器相關的主題。我們將設計一個簡單的控制器來避開在前面的教程中創建的障礙物。<br/><br/>本教程將介紹 Webots 中機器人編程的基礎。在本章結束時，您應該了解場景樹節點與控制器 API 之間的關聯，如何初始化和清理機器人控制器，如何初始化機器人設備，如何獲取傳感器值，如何指令執行器，以及如何編程一個簡單的反饋迴路。<br/><br/>本教程僅涉及 Webots 功能的正確使用。機器人算法的研究超出了本教程的目標，因此不會在此處討論。掌握一些基本的編程知識是解決本章問題的必要條件（任何 C 教程應該都是足夠的入門介紹）。在本章的末尾，提供了進一步的機器人算法的鏈接。</p>
<p>新的模擬場景與控制器</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作 #1：將之前的世界保存為 collision_avoidance.wbt。從文件/新建/新建機器人控制器菜單項中創建一個新的 C（或任何其他語言）控制器，命名為 epuck_avoid_collision（對於 C++ 和 Java，命名為 EPuckAvoidCollision）。修改 E-puck 節點的控制器欄位以將其與新控制器關聯。</span></p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">Hands on #1: Save the previous world as collision_avoidance.wbt. Create a new C (or any other language) controller called epuck_avoid_collision (for C++ and Java call it EPuckAvoidCollision instead) from the File / New / New Robot Controller... menu item. Modify the controller field of the E-puck node in order to associate it to the new controller.</span></p>
<p>Reminder: How to create a new controller?<br/>Select the File / New / New Robot Controller... menu item and choose your programming language and the file name.</p>
<p>了解 e-puck 模型<br/><br/>控制器編程需要一些與 e-puck 模型相關的信息。為了創建碰撞檢測算法，我們需要讀取其炮塔周圍的 8 個紅外距離傳感器的值，並且我們需要驅動其兩個輪子。下圖展示了距離傳感器在炮塔周圍的分佈情況以及 e-puck 的方向。<br/><br/>距離傳感器在機器人層次結構中由 8 個 <a href="https://cyberbotics.com/doc/reference/distancesensor">DistanceSensor</a> 節點建模。這些節點通過它們的名稱欄位進行引用（從 ps0 到 ps7）。我們將在稍後解釋這些節點是如何定義的。目前，只需注意可以通過 Webots API 的相關模塊訪問 DistanceSensor 節點（通過 webots/distance_sensor.h 標頭文件）。距離傳感器返回的值在 0 到 4096 之間縮放（線性分段到距離）。4096 表示測量到大量光（障礙物很近），而 0 表示沒有測量到光（沒有障礙物）。<br/><br/>控制器 API 是一個編程接口，它使您能夠訪問機器人的模擬傳感器和執行器。例如，包含 webots/distance_sensor.h 文件允許使用 wb_distance_sensor_* 函數，通過這些函數可以查詢 DistanceSensor 節點的值。API 函數的文檔可以在<a href="https://cyberbotics.com/doc/reference/nodes-and-api-functions">參考手冊</a>中找到，並附有每個節點的描述。</p>
<p><img alt="" height="281" src="/images/tutorial_e-puck_top_view.thumbnail.jpg" width="300"/></p>
<p>e-puck 模型的上視圖。綠色箭頭表示機器人的前方。紅色線條代表紅外距離傳感器的方向。字符串標籤對應於距離傳感器的名稱。</p>
<p><img alt="" height="181" src="/images/UML state machine of a simple feedback loop.png" width="600"/></p>
<p>簡單回饋迴路的 UML 狀態機</p>
<p>編寫控制器程序<br/><br/>我們想要編程一個非常簡單的碰撞避免行為。您將編程使機器人向前行駛，直到前方距離傳感器檢測到障礙物，然後轉向無障礙物的方向。為了做到這一點，我們將使用在圖中的 UML 狀態機中所示的簡單反饋迴路。<br/><br/>此控制器的完整代碼在下一小節中給出。</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">動手操作 #2：在控制器文件的開頭，添加對應於 Robot、DistanceSensor 和 Motor 節點的導入指令，以便能夠使用相應的 API：</span><br/><br/><span style="background-color: #ccffcc;">from controller import Robot, DistanceSensor, Motor</span><br/><br/><span style="background-color: #ccffcc;">在導入語句之後，定義一個變量，用於定義每個物理步長的持續時間。這個宏將用作 Robot::step 函數的參數，它也將用於啟用設備。這個持續時間以毫秒為單位，必須是 WorldInfo 節點的 basicTimeStep 欄位值的倍數。</span><br/><br/><span style="background-color: #ccffcc;">TIME_STEP = 64</span></p>
<p>主函數是控制器程序開始執行的地方。傳遞給主函數的參數由 Robot 節點的 controllerArgs 欄位給出。必須使用 wb_robot_init 函數初始化 Webots API，並使用 wb_robot_cleanup 函數清理它。</p>
<p>動手操作 #3：在 Python 中沒有主函數，程序從文件的開始處開始執行：</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false"># create the Robot instance.
robot = Robot()
# initialize devices
# feedback loop: step simulation until receiving an exit event
while robot.step(TIME_STEP) != -1:
    # read sensors outputs
    # process behavior
    # write actuators inputs</pre>
<p>機器人設備由 WbDeviceTag 引用。WbDeviceTag 由 wb_robot_get_device 函數檢索。然後，它在每個涉及此設備的函數調用中用作第一個參數。像 DistanceSensor 這樣的傳感器在使用前必須啟用。enable 函數的第二個參數定義了傳感器的刷新率。</p>
<p>動手操作 #4：在註釋 // initialize devices 之後，獲取並啟用距離傳感器，如下所示：</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false"># initialize devices
ps = []
psNames = [
    'ps0', 'ps1', 'ps2', 'ps3',
    'ps4', 'ps5', 'ps6', 'ps7'
]

for i in range(8):
    ps.append(robot.getDevice(psNames[i]))
    ps[i].enable(TIME_STEP)</pre>
<p>初始化設備後，初始化馬達：</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">leftMotor = robot.getDevice('left wheel motor')
rightMotor = robot.getDevice('right wheel motor')
leftMotor.setPosition(float('inf'))
rightMotor.setPosition(float('inf'))
leftMotor.setVelocity(0.0)
rightMotor.setVelocity(0.0)</pre>
<p>在主循環中，在註釋 # read sensors outputs 之後，按如下方式讀取距離傳感器的值：</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false"># read sensors outputs
psValues = []
for i in range(8):
    psValues.append(ps[i].getValue())</pre>
<p>在主循環中，在註釋 # process behavior 之後，檢測是否發生碰撞（即距離傳感器返回的值大於閾值），如下所示：</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false"># detect obstacles
right_obstacle = psValues[0] &gt; 80.0 or psValues[1] &gt; 80.0 or psValues[2] &gt; 80.0
left_obstacle = psValues[5] &gt; 80.0 or psValues[6] &gt; 80.0 or psValues[7] &gt; 80.0</pre>
<p>最後，使用有關障礙物的信息來驅動車輪，如下所示：</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">MAX_SPEED = 6.28
...
# initialize motor speeds at 50% of MAX_SPEED.
leftSpeed  = 0.5 * MAX_SPEED
rightSpeed = 0.5 * MAX_SPEED
# modify speeds according to obstacles
if left_obstacle:
    # turn right
    leftSpeed  = 0.5 * MAX_SPEED
    rightSpeed = -0.5 * MAX_SPEED
elif right_obstacle:
    # turn left
    leftSpeed  = -0.5 * MAX_SPEED
    rightSpeed = 0.5 * MAX_SPEED
# write actuators inputs
leftMotor.setVelocity(leftSpeed)
rightMotor.setVelocity(rightSpeed)</pre>
<p>Save your code by selecting the File / Save Text File menu item. Reload the world.</p>
<p>控制器代碼<br/><br/>以下是前一小節中詳細介紹的控制器完整代碼。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">from controller import Robot, DistanceSensor, Motor

# time in [ms] of a simulation step
TIME_STEP = 64

MAX_SPEED = 6.28

# create the Robot instance.
robot = Robot()

# initialize devices
ps = []
psNames = [
    'ps0', 'ps1', 'ps2', 'ps3',
    'ps4', 'ps5', 'ps6', 'ps7'
]

for i in range(8):
    ps.append(robot.getDevice(psNames[i]))
    ps[i].enable(TIME_STEP)

leftMotor = robot.getDevice('left wheel motor')
rightMotor = robot.getDevice('right wheel motor')
leftMotor.setPosition(float('inf'))
rightMotor.setPosition(float('inf'))
leftMotor.setVelocity(0.0)
rightMotor.setVelocity(0.0)

# feedback loop: step simulation until receiving an exit event
while robot.step(TIME_STEP) != -1:
    # read sensors outputs
    psValues = []
    for i in range(8):
        psValues.append(ps[i].getValue())

    # detect obstacles
    right_obstacle = psValues[0] &gt; 80.0 or psValues[1] &gt; 80.0 or psValues[2] &gt; 80.0
    left_obstacle = psValues[5] &gt; 80.0 or psValues[6] &gt; 80.0 or psValues[7] &gt; 80.0

    # initialize motor speeds at 50% of MAX_SPEED.
    leftSpeed  = 0.5 * MAX_SPEED
    rightSpeed = 0.5 * MAX_SPEED
    # modify speeds according to obstacles
    if left_obstacle:
        # turn right
        leftSpeed  = 0.5 * MAX_SPEED
        rightSpeed = -0.5 * MAX_SPEED
    elif right_obstacle:
        # turn left
        leftSpeed  = -0.5 * MAX_SPEED
        rightSpeed = 0.5 * MAX_SPEED
    # write actuators inputs
    leftMotor.setVelocity(leftSpeed)
    rightMotor.setVelocity(rightSpeed)</pre>
<p>解決方案：世界文件<br/><br/>要將您的世界與解決方案進行比較，請轉到您的文件並找到在 <a href="https://mde.tw/cd2025/content/Tutorial1.html">Tutorial1</a> 中創建的名為 my_first_simulation 的文件夾，然後轉到 worlds 文件夾並使用文本編輯器打開正確的世界。此解決方案與其他解決方案位於解決方案目錄中。<br/><br/>結論<br/><br/>以下是您剛剛學到的關鍵點的快速摘要：<br/><br/>- 控制器入口點是主函數，就像任何標準的 C 程序一樣。<br/>- 在調用 wb_robot_init 函數之前，不應調用任何 Webots API 函數。<br/>- 離開主函數之前要調用的最後一個函數是 wb_robot_cleanup 函數。<br/>- 設備由其設備節點的名稱欄位引用。可以通過 wb_robot_get_device 函數檢索節點的引用。<br/>- 每個控制器程序都作為 Webots 進程的子進程執行。控制器進程不與 Webots 共享任何內存（除了相機的圖像），並且它可以在與 Webots 不同的 CPU（或 CPU 核心）上運行。<br/>- 控制器代碼鏈接到 libController 動態庫。該庫處理控制器與 Webots 之間的通信。<br/><br/>本節更詳細地解釋了控制器編程。您應該仔細閱讀以進一步了解在 Webots 中的機器人編程。</p>
<h3>Tutorial5</h3>
<p>導引課程 5：複合固體和物理屬性</p>
<p>本導引課程的目的是通過創建一個具有多個邊界對象的固體來更詳細地探索物理模擬：一個由兩個球體和一個圓柱體組成的啞鈴。預期結果如圖所示。</p>
<p><img alt="" height="157" src="/images/tutorial_dumbbell.thumbnail.jpg" width="300"/></p>
<p>預期結果在教程結束時，您將能夠創建一個由兩個球體和一個圓柱體組成的啞鈴，如圖所示。</p>
<p>新的模擬</p>
<p style="padding-left: 30px;"><span style="background-color: #ccffcc;">實作練習 #1：從上一個教程的結果開始，並通過使用表單 File / Save World As.... 創建一個名為 compound_solid.wbt 的新模擬。</span></p>
<h4 class="anchor-header" id="compoundsolid" name="compound-solid">Compound Solid</h4>
<p>It is possible to build <a href="https://cyberbotics.com/doc/reference/solid">Solid</a> nodes more complex than what we have seen before by aggregating <a href="https://cyberbotics.com/doc/reference/shape">Shape</a> nodes. In fact, both the physical and the graphical properties of a <a href="https://cyberbotics.com/doc/reference/solid">Solid</a> can be made of several <a href="https://cyberbotics.com/doc/reference/shape">Shape</a> nodes. Moreover each <a href="https://cyberbotics.com/doc/reference/shape">Shape</a> node can be placed in a <a href="https://cyberbotics.com/doc/reference/pose">Pose</a> node in order to change its relative position and orientation. <a href="https://cyberbotics.com/doc/reference/group">Group</a> nodes can also be used to group several sub-nodes.</p>
<p>We want to implement a dumbbell made of a handle (<a href="https://cyberbotics.com/doc/reference/cylinder">Cylinder</a>) and of two weights (<a href="https://cyberbotics.com/doc/reference/sphere">Sphere</a>) located at each end of the handle. This <a class="dynamicAnchor" href="https://cyberbotics.com/doc/guide/tutorial-5-compound-solid-and-physics-attributes#representation-of-the-subnodes-of-a-compound-solid-made-of-several-transformed-geometries">figure</a> depicts the <a href="https://cyberbotics.com/doc/reference/solid">Solid</a> nodes and its sub-nodes required to implement the dumbbell.</p>
<p style="padding-left: 30px;">Hands on #2: Create the dumbbell by following the figure. Create the handle first without placing it in a Pose node (so the handle axis will have the same direction as the z-axis of the solid). The handle should have a length of 0.1 m and a radius of 0.01 m. The weights should have a radius of 0.03 m and a subdivision of 2. The weights can be moved at the handle extremities thanks to the translation field of their Pose nodes.</p>
<p><img alt="" height="513" src="/images/compound_solid.png" width="300"/></p>
<p>representation of the subnodes of a compound solid made of several transformed geometries.</p>
<h4 class="anchor-header" id="physicsattributes" name="physics-attributes">Physics Attributes</h4>
<p>The aim of this subsection is to learn how to set some simple physics properties for a <a href="https://cyberbotics.com/doc/reference/solid">Solid</a> node. The <a href="https://cyberbotics.com/doc/reference/physics">Physics</a> node contains fields related to the physics of the current rigid body (<a href="https://cyberbotics.com/doc/reference/solid">Solid</a>).</p>
<p>The <strong>mass</strong> of a <a href="https://cyberbotics.com/doc/reference/solid">Solid</a> node is given by its <code>density</code> or <code>mass</code> field. Only one of these two fields can be specified at a time (the other should be set to <em>-1</em>). When the <code>mass</code> is specified, it defines the total mass of the solid (in [kg]). When the <code>density</code> is specified, its value (in [kg/m3]) is multiplied by the volume of the bounding objects, and the product gives the total mass of the solid. A density of 1000 [kg/m³] corresponds to the density of water (default value).</p>
<p style="padding-left: 30px;">Hands on #3: Set the mass of the dumbbell to 2 [kg]. The density is not used and should be set to -1.</p>
<p>By default, the <strong>center of mass</strong> of a <a href="https://cyberbotics.com/doc/reference/solid">Solid</a> node is set at its origin (defined by the translation field of the solid). The center of mass can be modified using the <code>centerOfMass</code> field of the <a href="https://cyberbotics.com/doc/reference/physics">Physics</a> node. The center of mass is specified relatively to the origin of the <a href="https://cyberbotics.com/doc/reference/solid">Solid</a>.</p>
<p style="padding-left: 30px;">Hands on #4: Let's say that one of the weights is heavier than the other one. Move the center of mass of the dumbbell of 0.01 [m] along the z-axis.</p>
<p>Note that when the solid is selected, the center of mass is represented in the 3D view by a coordinate system which is darker than the coordinate system representing the solid center.</p>
<h4 class="anchor-header" id="therotationfield" name="the-rotation-field"><a class="anchor-link" href="https://cyberbotics.com/doc/guide/tutorial-5-compound-solid-and-physics-attributes#the-rotation-field"><span class="anchor-link-image"></span></a>The Rotation Field</h4>
<p>The <code>rotation</code> field of the <a href="https://cyberbotics.com/doc/reference/pose">Pose</a> node determines the rotation of this node (and of its children) using the <a href="https://en.wikipedia.org/wiki/Axis%E2%80%93angle_representation" target="_blank">Euler axis and angle</a> representation. A <strong>Euler axis and angle</strong> rotation is defined by four components. The first three components are a unit vector that defines the rotation axis. The fourth component defines the rotation angle about the axis (in [rad]).</p>
<p>The rotation occurs in the sense prescribed by the right-hand rule.</p>
<p style="padding-left: 30px;">Hands on #5: Modify the rotation of the Solid node of the dumbbell in order to move the handle's axis (z-axis) parallel to the ground. A unit axis (0, 1, 0) and an angle of π/2 (~ 1.5708) is a possible solution.</p>
<h4 class="anchor-header" id="howtochooseboundingobjects" name="how-to-choose-bounding-objects">How to Choose Bounding Objects?</h4>
<p>As said before, minimizing the number of bounding objects increases the simulation speed. However, choosing the bounding objects primitives carefully is also crucial to increase the simulation speed.</p>
<p>Using a combination of <a href="https://cyberbotics.com/doc/reference/sphere">Sphere</a>, <a href="https://cyberbotics.com/doc/reference/box">Box</a>, <a href="https://cyberbotics.com/doc/reference/capsule">Capsule</a> and <a href="https://cyberbotics.com/doc/reference/cylinder">Cylinder</a> nodes for defining objects is very efficient. Generally speaking, the efficiency of these primitives can be sorted like this: <a href="https://cyberbotics.com/doc/reference/sphere">Sphere</a> &gt; <a href="https://cyberbotics.com/doc/reference/box">Box</a> &gt; <a href="https://cyberbotics.com/doc/reference/capsule">Capsule</a> &gt; <a href="https://cyberbotics.com/doc/reference/cylinder">Cylinder</a>, where the <a href="https://cyberbotics.com/doc/reference/sphere">Sphere</a> is the most efficient. But this can be neglected under common usage.</p>
<p>The <a href="https://cyberbotics.com/doc/reference/indexedfaceset">IndexedFaceSet</a> geometry primitive can also be used in a bounding object. But this primitive is less efficient than the other primitives listed above. Moreover its behavior is sometimes buggy. For this reasons, we don't recommend using the <a href="https://cyberbotics.com/doc/reference/indexedfaceset">IndexedFaceSet</a> when another solution using a combination of the other primitives is possible.</p>
<p>Grounds can be defined using the <a href="https://cyberbotics.com/doc/reference/plane">Plane</a> or the <a href="https://cyberbotics.com/doc/reference/elevationgrid">ElevationGrid</a> primitives. The <a href="https://cyberbotics.com/doc/reference/plane">Plane</a> node is much more efficient than the <a href="https://cyberbotics.com/doc/reference/elevationgrid">ElevationGrid</a> node, but it can only be used to model a flat terrain while the <a href="https://cyberbotics.com/doc/reference/elevationgrid">ElevationGrid</a> can be used to model an uneven terrain.</p>
<h4 class="anchor-header" id="contacts" name="contacts">Contacts</h4>
<p>When two solids collide, <strong>contacts</strong> are created at the collision points. <a href="https://cyberbotics.com/doc/reference/contactproperties">ContactProperties</a> nodes can be used to specify the desired behavior of the contacts (e.g. the friction between the two solids).</p>
<p>Each solid belongs to a material category referenced by their <code>contactMaterial</code> field (<code>default</code> by default). The <a href="https://cyberbotics.com/doc/reference/worldinfo">WorldInfo</a> node has a <code>contactProperties</code> field that stores a list of <a href="https://cyberbotics.com/doc/reference/contactproperties">ContactProperties</a> nodes. These nodes allow to define the contact properties between two categories of <a href="https://cyberbotics.com/doc/reference/solid">Solids</a>.</p>
<p>We want now to modify the friction model between the dumbbell and the other solids of the environment.</p>
<p style="padding-left: 30px;">Hands on #6: Set the contactMaterial field of the dumbbell to "dumbbell". In the WorldInfo node, add a ContactProperties node between the default and dumbbell categories. Try to set the coulombFriction field to 0 and remark that the dumbbell slides (instead of rotating) on the floor because no more friction is applied.</p>
<h4 class="anchor-header" id="basictimesteperpandcfm" name="basictimestep-erp-and-cfm"><code>basicTimeStep</code>, <code>ERP</code> and <code>CFM</code></h4>
<p>The most critical parameters for a physics simulation are stored in the <code>basicTimeStep</code>, <code>ERP</code> and <code>CFM</code> fields of the <a href="https://cyberbotics.com/doc/reference/worldinfo">WorldInfo</a> node.</p>
<p>The <code>basicTimeStep</code> field determines the duration (in [ms]) of a physics step. The bigger this value is, the quicker the simulation is, the less precise the simulation is. We recommend values between <em>8</em> and <em>16</em> for regular use of Webots.</p>
<p>It's more difficult to explain the behavior of the <code>ERP</code> and <code>CFM</code> fields. These values are directly used by the physics engine to determine how the constraints are solved. The default values are well defined for regular use of Webots. We recommend to read the <a href="https://cyberbotics.com/doc/reference/worldinfo">Reference Manual</a> and the documentation of <a href="http://ode.org/wiki/index.php?title=Manual" target="_blank">ODE</a> (physics engine used in Webots) to understand completely their purpose.</p>
<h4 class="anchor-header" id="minorphysicsparameters" name="minor-physics-parameters"><a class="anchor-link" href="https://cyberbotics.com/doc/guide/tutorial-5-compound-solid-and-physics-attributes#minor-physics-parameters"><span class="anchor-link-image"></span></a>Minor Physics Parameters</h4>
<p>There are also other physics parameters which are less useful in a regular use of Webots, for example some of the fields of the <a href="https://cyberbotics.com/doc/reference/physics">Physics</a>, <a href="https://cyberbotics.com/doc/reference/worldinfo">WorldInfo</a> and <a href="https://cyberbotics.com/doc/reference/contactproperties">ContactProperties</a> nodes.</p>
<p style="padding-left: 30px;">Hands on #7: Search how to add a linear damping on all the objects, how to use the inertia matrix and how to use the physicsDisableTime property.</p>
<h4 class="anchor-header" id="solutionworldfile" name="solution-world-file">Solution: World File</h4>
<p>To compare your world with the solution, go to your files and find the folder named "my_first_simulation" created in <a class="dynamicLoad" href="https://cyberbotics.com/doc/guide/tutorial-1-your-first-simulation-in-webots">Tutorial 1</a>, then go to the "worlds" folder and open with a text editor the right world. <a href="https://github.com/cyberbotics/webots/tree/released/projects/samples/tutorials/worlds/compound_solid.wbt" target="_blank">This solution</a> as the others is located in the <a href="https://github.com/cyberbotics/webots/tree/released/projects/samples/tutorials/worlds/" target="_blank">solution directory</a>.</p>
<h4 class="anchor-header" id="conclusion" name="conclusion"><a class="anchor-link" href="https://cyberbotics.com/doc/guide/tutorial-5-compound-solid-and-physics-attributes#conclusion"><span class="anchor-link-image"></span></a>Conclusion</h4>
<p>You are now able to build a wide range of solids including those being composed of several rigid bodies. You know that a Geometry node can be moved and rotated if it is included in a <a href="https://cyberbotics.com/doc/reference/pose">Pose</a> node. You are aware about all the physics parameters allowing you to design robust simulations. The next step will be to create your own robot.</p>
<p>You can test your skills by creating common objects such as a table.</p>
<h2>Stage3</h2>
<p><a href="https://mde.tw/cad2025/content/Tutorial6.html">Tutorial6</a> 是學習如何建立及控制行動機器人.</p>
<p><a href="https://mde.tw/cad2025/content/Tutorial7.html">Tutorial7</a> 說明如何自行建立原型物件 (PROTO).</p>
<p><a href="https://mde.tw/cad2025/content/Tutorial8.html">Tutorial8</a> 就自行開發投籃機模擬場景而言, 可在虛擬的模擬場景中, 利用 supervisor 模式配置非可實際達成的程式控制加速虛實產品的開發流程.</p>
<h3>Tutorial6</h3>
<h4 class="anchor-header" id="tutorial64wheeledrobot60minutes" name="tutorial-6-4-wheeled-robot-60-minutes">Tutorial 6: 4-Wheeled Robot</h4>
<p>This tutorial aims at creating your first robot from scratch. The robot will consist of a body, four wheels, and two distance sensors. The result is depicted on <a class="dynamicAnchor" href="https://cyberbotics.com/doc/guide/tutorial-6-4-wheels-robot#3d-view-of-the-4-wheels-robot-note-that-the-coordinate-system-representations-of-the-robot-body-and-of-its-wheels-are-oriented-the-same-way-their-px-vector-in-red-defines-the-left-of-the-robot-their-py-vector-in-green-defines-the-top-of-the-robot-and-their-pz-vector-in-blue-defines-the-front-of-the-robot-the-distance-sensors-are-oriented-in-a-different-way-their-px-vector-indicates-the-direction-of-the-sensor">this figure</a>. The <a class="dynamicAnchor" href="https://cyberbotics.com/doc/guide/tutorial-6-4-wheels-robot#top-view-of-the-4-wheeled-robot-the-grid-behind-the-robot-has-a-dimension-of-0-2-x-0-3-meters-the-text-labels-correspond-to-the-name-of-the-device">next figure</a> shows the robot from a top view.</p>
<p><img alt="" height="209" src="/images/tutorial_4_wheels_robot.thumbnail.jpg" width="300"/></p>
<p>3D view of the 4 wheels robot. Note that the coordinate system representations of the robot body and of its wheels are oriented the same way. Their +x-vector (in red) defines the left of the robot, their +y-vector (in green) defines the top of the robot, and their +z-vector (in blue) defines the front of the robot. The distance sensors are oriented in a different way, their +x-vector indicates the direction of the sensor.</p>
<p><img alt="" height="193" src="/images/tutorial_4_wheels_top_schema.thumbnail.jpg" width="300"/></p>
<p>Top view of the 4 wheeled robot. The grid behind the robot has a dimension of 0.2 x 0.3 meters. The text labels correspond to the name of the device.</p>
<h4 class="anchor-header" id="newsimulation" name="new-simulation">New Simulation</h4>
<blockquote>
<p><strong>Hands on #1</strong>: Save the world of the previous tutorial as<span> </span><code>4_wheeled_robot.wbt</code>. Remove the nodes defining the e-puck, the ball, the dumbbell and the contact properties. The ground, the walls and the lighting are kept.</p>
</blockquote>
<h4 class="anchor-header" id="separatingtherobotinsolidnodes" name="separating-the-robot-in-solid-nodes"><a class="anchor-link" href="https://cyberbotics.com/doc/guide/tutorial-6-4-wheels-robot#separating-the-robot-in-solid-nodes"><span class="anchor-link-image"></span></a>Separating the Robot in Solid Nodes</h4>
<p>Some definitions and rules to create the robot model:</p>
<ul>
<li>
<p>The set containing the<span> </span><a href="https://cyberbotics.com/doc/reference/solid">Solid</a><span> </span>node and all its derived nodes are called the<span> </span><em>solid nodes</em>.</p>
</li>
<li>
<p>A similar definition is applied for the<span> </span><a href="https://cyberbotics.com/doc/reference/device">Device</a>,<span> </span><a href="https://cyberbotics.com/doc/reference/robot">Robot</a>,<span> </span><a href="https://cyberbotics.com/doc/reference/joint">Joint</a><span> </span>and<span> </span><a href="https://cyberbotics.com/doc/reference/motor">Motor</a><span> </span>nodes. You can get more information about the node hierarchy in the<span> </span><a href="https://cyberbotics.com/doc/reference/node-chart">nodes chart diagram</a>.</p>
</li>
<li>
<p>Most sensors and actuators are both<span> </span><a href="https://cyberbotics.com/doc/reference/solid">Solid</a><span> </span>and<span> </span><a href="https://cyberbotics.com/doc/reference/device">Device</a><span> </span>nodes at the same time.</p>
</li>
<li>
<p>The main structure of a<span> </span><a href="https://cyberbotics.com/doc/reference/robot">Robot</a><span> </span>model is a tree of<span> </span><a href="https://cyberbotics.com/doc/reference/solid">Solid</a><span> </span>nodes linked together. The root node of this tree should be a<span> </span><a href="https://cyberbotics.com/doc/reference/robot">Robot</a><span> </span>node.</p>
</li>
<li>
<p>The solids are linked together by<span> </span><a href="https://cyberbotics.com/doc/reference/joint">Joint</a><span> </span>nodes. A<span> </span><a href="https://cyberbotics.com/doc/reference/device">Device</a><span> </span>node should be the direct child of either a<span> </span><a href="https://cyberbotics.com/doc/reference/robot">Robot</a><span> </span>node, a<span> </span><a href="https://cyberbotics.com/doc/reference/solid">Solid</a><span> </span>node or a<span> </span><a href="https://cyberbotics.com/doc/reference/joint">Joint</a><span> </span>node.</p>
</li>
<li>
<p>A<span> </span><a href="https://cyberbotics.com/doc/reference/joint">Joint</a><span> </span>node is used to add one (or two) degree(s) of freedom (DOF), between its parent and its child. The direct parent and child of a<span> </span><a href="https://cyberbotics.com/doc/reference/joint">Joint</a><span> </span>node are both<span> </span><a href="https://cyberbotics.com/doc/reference/solid">Solid</a><span> </span>nodes.</p>
</li>
<li>
<p>The nodes derived from<span> </span><a href="https://cyberbotics.com/doc/reference/joint">Joint</a><span> </span>allow creating different kinds of constraints between the linked<span> </span><a href="https://cyberbotics.com/doc/reference/solid">Solid</a><span> </span>nodes. The most used one in robotics, is the<span> </span><a href="https://cyberbotics.com/doc/reference/hingejoint">HingeJoint</a><span> </span>allowing to model amongst others rotational motors including wheels.</p>
</li>
<li>
<p>A<span> </span><a href="https://cyberbotics.com/doc/reference/joint">Joint</a><span> </span>node can be monitored or actuated by adding a<span> </span><a href="https://cyberbotics.com/doc/reference/positionsensor">PositionSensor</a><span> </span>node, or a motor node to its<span> </span><code>device</code><span> </span>field respectively.</p>
</li>
</ul>
<p>Having these rules in mind, we can start designing the node hierarchy used to model the robot. The first step is to determine which part of the robot should be modeled as a<span> </span><a href="https://cyberbotics.com/doc/reference/solid">Solid</a><span> </span>node.</p>
<p>In our example, this operation is quite obvious. The robot has 4 DOF corresponding to the wheel motors. It can be divided in five solid nodes: the body and the four wheels.</p>
<p>Depending on the expected application of the robot model, reducing the DOF while modelling might be necessary to get an efficient simulation. For example, when modeling a caster wheel, a realistic approach implies to model 2 DOF. But if this degree of precision is useless for the simulation, a more efficient approach can be found. For example, to model the caster wheel as a<span> </span><a href="https://cyberbotics.com/doc/reference/sphere">Sphere</a><span> </span>having a null friction coefficient with the ground.</p>
<p>The second step is to determine which<span> </span><a href="https://cyberbotics.com/doc/reference/solid">Solid</a><span> </span>node is the<span> </span><a href="https://cyberbotics.com/doc/reference/robot">Robot</a><span> </span>node (the root node). This choice is arbitrary, but a solution is often much easier to implement. For example, in the case of a humanoid robot, the robot node would be typically the robot chest, because the robot symmetry facilitates the computation of the joint parameters.</p>
<p>In our case, the body box is obviously the better choice. The<span> </span><a class="dynamicAnchor" href="https://cyberbotics.com/doc/guide/tutorial-6-4-wheels-robot#high-level-representation-of-the-4-wheeled-robot">figure</a><span> </span>depicts the solid nodes hierarchy of the robot.</p>
<blockquote>
<p><strong>Hands on #2</strong>: At the end of the scene tree, add a<span> </span><a href="https://cyberbotics.com/doc/reference/robot">Robot</a><span> </span>node having four<span> </span><a href="https://cyberbotics.com/doc/reference/hingejoint">HingeJoint</a><span> </span>nodes having a<span> </span><a href="https://cyberbotics.com/doc/reference/solid">Solid</a><span> </span>node as<span> </span><code>endPoint</code>. Please refer to<span> </span><a class="dynamicAnchor" href="https://cyberbotics.com/doc/guide/tutorial-6-4-wheels-robot#high-level-representation-of-the-4-wheeled-robot">this figure</a>. Add a<span> </span><a href="https://cyberbotics.com/doc/reference/shape">Shape</a><span> </span>node containing a Box geometry to the<span> </span><a href="https://cyberbotics.com/doc/reference/robot">Robot</a><span> </span>node. Set the color of the<span> </span><a href="https://cyberbotics.com/doc/reference/shape">Shape</a><span> </span>to red. Use the<span> </span><a href="https://cyberbotics.com/doc/reference/shape">Shape</a><span> </span>to define the<span> </span><code>boundingObject</code><span> </span>field of the<span> </span><a href="https://cyberbotics.com/doc/reference/robot">Robot</a><span> </span>node. The dimension of the box is<span> </span><code>(0.2, 0.1, 0.05)</code>. Add a<span> </span><a href="https://cyberbotics.com/doc/reference/physics">Physics</a><span> </span>node to the<span> </span><a href="https://cyberbotics.com/doc/reference/robot">Robot</a>. The<span> </span><a class="dynamicAnchor" href="https://cyberbotics.com/doc/guide/tutorial-6-4-wheels-robot#high-level-representation-of-the-4-wheeled-robot">figure</a><span> </span>represents all the nodes defining the robot. So far, only the direct children nodes of the root<span> </span><a href="https://cyberbotics.com/doc/reference/robot">Robot</a><span> </span>node has been implemented.</p>
</blockquote>
<p><img alt="" height="283" src="/images/tutorial6_high_level_representation_wheeled_robot.png" width="300"/></p>
<p>High level representation of the 4 wheeled robot</p>
<h4 class="anchor-header" id="hingejoint" name="hingejoint"><code>HingeJoint</code></h4>
<p>The initial position of the wheel is defined by the translation and the rotation fields of the<span> </span><a href="https://cyberbotics.com/doc/reference/solid">Solid</a><span> </span>node.</p>
<p>The rotation origin (anchor) and the rotation axis (axis) are defined by the optional<span> </span><a href="https://cyberbotics.com/doc/reference/hingejointparameters">HingeJointParameters</a><span> </span>child of the<span> </span><a href="https://cyberbotics.com/doc/reference/hingejoint">HingeJoint</a><span> </span>node.</p>
<p><img alt="" height="155" src="/images/hinge_joint.png" width="300"/></p>
<p>Representation of a hinge joint</p>
<p>The radius of the wheel is 0.04 and its thickness (height of the cylinder) is 0.02. For the first wheel, the<span> </span><a href="https://cyberbotics.com/doc/reference/solid">Solid</a><span> </span>translation should be defined to<span> </span><code>(0.05, 0.06, 0)</code><span> </span>in order to define the relative gap between the body and the wheel, and the rotation to<span> </span><code>(1 0 0 1.5708)</code><span> </span>for the wheel cylinder to be correctly oriented. The<span> </span><a href="https://cyberbotics.com/doc/reference/hingejointparameters">HingeJointParameters</a><span> </span>anchor should also be defined to<span> </span><code>(0.05, 0.06, 0)</code><span> </span>to define the rotation origin (relatively to the body). Finally, the<span> </span><a href="https://cyberbotics.com/doc/reference/hingejointparameters">HingeJointParameters</a><span> </span>axis should define the rotation axis. In our case it's along the y-axis (so<span> </span><code>(0, 1, 0)</code>).</p>
<blockquote>
<p><strong>Hands on #3</strong>: Add a<span> </span><a href="https://cyberbotics.com/doc/reference/hingejointparameters">HingeJointParameters</a><span> </span>node, and enter the field values as described above. Some signs obviously have to be updated for other wheels.</p>
</blockquote>
<p>Now, let's implement the cylinder shape of the wheels.</p>
<p>For each<span> </span><a href="https://cyberbotics.com/doc/reference/hingejoint">HingeJoint</a>, there are three fields in which nodes need to be added.</p>
<ul>
<li><strong>jointParameters</strong>: Add a<span> </span><a href="https://cyberbotics.com/doc/reference/hingejointparameters">HingeJointParameters</a><span> </span>and configure the anchor (0.05 -0.06 0) and axis (0 1 0) fields. These values have to be modified according to the location of the wheel.</li>
<li><strong>device</strong>: Add a<span> </span><a href="https://cyberbotics.com/doc/reference/rotationalmotor">RotationalMotor</a><span> </span>in order to be able to actuate the wheels. Change their<span> </span><code>name</code><span> </span>fields from<span> </span><code>wheel1</code><span> </span>to<span> </span><code>wheel4</code><span> </span>according to<span> </span><a class="dynamicAnchor" href="https://cyberbotics.com/doc/guide/tutorial-6-4-wheels-robot#top-view-of-the-4-wheeled-robot-the-grid-behind-the-robot-has-a-dimension-of-0-2-x-0-3-meters-the-text-labels-correspond-to-the-name-of-the-device">this figure</a>. These labels will be used to reference the wheels from the controller.</li>
<li><strong>endPoint</strong>: Add a<span> </span><a href="https://cyberbotics.com/doc/reference/solid">Solid</a><span> </span>node, then a<span> </span><a href="https://cyberbotics.com/doc/reference/shape">Shape</a><span> </span>node in the<span> </span><code>children</code><span> </span>field of the<span> </span><a href="https://cyberbotics.com/doc/reference/solid">Solid</a>, and finally, add a<span> </span><a href="https://cyberbotics.com/doc/reference/cylinder">Cylinder</a><span> </span>in the<span> </span><code>geometry</code><span> </span>field of the<span> </span><a href="https://cyberbotics.com/doc/reference/shape">Shape</a><span> </span>node. The<span> </span><a href="https://cyberbotics.com/doc/reference/cylinder">Cylinder</a><span> </span>should have a<span> </span><code>radius</code><span> </span>of<span> </span><code>0.04</code><span> </span>and a<span> </span><code>height</code><span> </span>of<span> </span><code>0.02</code>. Set the color of the wheels to green.</li>
</ul>
<blockquote>
<p><strong>Hands on #4</strong>: Complete the missing nodes to get the same structure as the</p>
<p>one depicted in<span> </span><a class="dynamicAnchor" href="https://cyberbotics.com/doc/guide/tutorial-6-4-wheels-robot#low-level-representation-of-the-4-wheeled-robot">this figure</a>. Don't forget the<span> </span><a href="https://cyberbotics.com/doc/reference/physics">Physics</a><span> </span>nodes.</p>
</blockquote>
<p><img alt="" height="355" src="/images/tutorial6_low_level_rep_wheeled_robot.png" width="800"/></p>
<p>Low level representation of the 4 wheeled robot</p>
<h4 class="anchor-header" id="sensors" name="sensors">Sensors</h4>
<p>The sensors used on the e-puck of<span> </span><a class="dynamicLoad" href="https://cyberbotics.com/doc/guide/tutorial-4-more-about-controllers">Tutorial 4</a><span> </span>are not the same as the ones used in this section. Pay attention to their measuring interval which is between<span> </span><code>0 cm = 0</code><span> </span>and<span> </span><code>10 cm = 1000</code>. Find more information about the<span> </span><code>lookupTable</code><span> </span>field<span> </span><a href="https://cyberbotics.com/doc/reference/distancesensor#lookup-table">here</a>.</p>
<p>The last part of the robot modeling is to add the two distance sensors to the robot. This can be done by adding two<span> </span><a href="https://cyberbotics.com/doc/reference/distancesensor">DistanceSensor</a><span> </span>nodes as direct children of the<span> </span><a href="https://cyberbotics.com/doc/reference/robot">Robot</a><span> </span>node. Note that the distance sensor acquires its data along the positive x-axis. So, it is necessary to rotate the distance sensor to point their x-axis outside the robot (see the<span> </span><a class="dynamicAnchor" href="https://cyberbotics.com/doc/guide/tutorial-6-4-wheels-robot#top-view-of-the-4-wheeled-robot-the-grid-behind-the-robot-has-a-dimension-of-0-2-x-0-3-meters-the-text-labels-correspond-to-the-name-of-the-device">figure</a>).</p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<details open=""><summary><strong>Reminder</strong>: How to know the orientation of the distance sensor?</summary>As already says in<span> </span><a class="dynamicLoad" href="https://cyberbotics.com/doc/guide/tutorial-3-appearance">Tutorial 3</a>, the distance sensor rays can be viewed using the shortcut<span> </span><kbd>ctrl</kbd>-<kbd>F10</kbd><span> </span>or<span> </span><code>View / Optional Rendering / Show DistanceSensor Rays</code>.
<blockquote>
<p><strong>Hands on #5</strong>: Add the two distance sensors as explained above. The distance sensors are at an angle to 0.3 [rad] with the front vector of the robot. Set the graphical and physical shape to a cube (not transformed) having a edge of<span> </span><code>0.01</code><span> </span>[m]. Set the color to blue. Set the<span> </span><code>name</code><span> </span>field according to the labels of<span> </span><a class="dynamicAnchor" href="https://cyberbotics.com/doc/guide/tutorial-6-4-wheels-robot#top-view-of-the-4-wheeled-robot-the-grid-behind-the-robot-has-a-dimension-of-0-2-x-0-3-meters-the-text-labels-correspond-to-the-name-of-the-device">this figure</a>.</p>
</blockquote>
<details open=""><summary><strong>Tips</strong>: How to precisely orient distance sensors?</summary>In the<span> </span><a href="https://cyberbotics.com/doc/reference/distancesensor">DistanceSensor</a><span> </span>node, the rotation field has 4 parameters. If you set the angle parameter to 0, then you can use the mouse wheel to increment/decrement by steps of 0.1309 rad (= 7.5 degree).
<h4 class="anchor-header" id="controller" name="controller"><a class="anchor-link" href="https://cyberbotics.com/doc/guide/tutorial-6-4-wheels-robot#controller"><span class="anchor-link-image"></span></a>Controller</h4>
<p>In the previous tutorials, you have learnt how to setup a feedback loop and how to read the distance sensor values. However, actuating a<span> </span><a href="https://cyberbotics.com/doc/reference/rotationalmotor">RotationalMotor</a><span> </span>node is something new. To program the rotational motors, the first step is to include the API module corresponding to the<span> </span><a href="https://cyberbotics.com/doc/reference/rotationalmotor">RotationalMotor</a><span> </span>node:</p>
<div class="tab-content" name="python" tabid="3">
<pre><code class="python language-python hljs"><span class="hljs-keyword">from</span> controller <span class="hljs-keyword">import</span> Motor
</code></pre>
</div>
<p>Then to get the references of the<span> </span><a href="https://cyberbotics.com/doc/reference/rotationalmotor?tab-language=python">RotationalMotor</a><span> </span>nodes:</p>
<div class="tab-content" name="python" tabid="4">
<pre><code class="python language-python hljs"><span class="hljs-comment"># initialize motors</span>
wheels = []
wheelsNames = [<span class="hljs-string">'wheel1'</span>, <span class="hljs-string">'wheel2'</span>, <span class="hljs-string">'wheel3'</span>, <span class="hljs-string">'wheel4'</span>]
<span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> wheelsNames:
    wheels.append(robot.getDevice(name))
</code></pre>
</div>
<p>A<span> </span><a href="https://cyberbotics.com/doc/reference/motor?tab-language=python">Motor</a><span> </span>can be actuated by setting its position, its velocity, its acceleration or its force. Here we are interested in setting its velocity. This can be achieved by setting its position to infinity, and by bounding its velocity:</p>
<div class="tab-content" name="python" tabid="5">
<pre><code class="python language-python hljs">speed = <span class="hljs-number">-1.5</span>  <span class="hljs-comment"># [rad/s]</span>
wheels[<span class="hljs-number">0</span>].setPosition(float(<span class="hljs-string">'inf'</span>))
wheels[<span class="hljs-number">0</span>].setVelocity(speed)
</code></pre>
</div>
<blockquote>
<p><strong>Hands on #6</strong>: Implement a controller called<span> </span><code>four_wheeled_collision_avoidance</code><span> </span>moving the robot and avoiding obstacles by detecting them by the distance sensors.</p>
</blockquote>
<p>Note that the<span> </span><code>lookupTable</code><span> </span>field of the<span> </span><a href="https://cyberbotics.com/doc/reference/distancesensor?tab-language=python">DistanceSensor</a><span> </span>nodes indicates the values returned by the sensor. To help in the debugging with the sensors, it is possible to see the value of the sensors in the real-time in the<span> </span><a class="dynamicLoad" href="https://cyberbotics.com/doc/guide/controller-plugin#robot-window?tab-language=python">robot-window</a>. To open the<span> </span><a class="dynamicLoad" href="https://cyberbotics.com/doc/guide/controller-plugin#robot-window?tab-language=python">robot-window</a>, double-click on the robot body and it will bring up a menu on the left with the<span> </span><a href="https://cyberbotics.com/doc/reference/distancesensor?tab-language=python">DistanceSensor</a><span> </span>and<span> </span><a href="https://cyberbotics.com/doc/reference/rotationalmotor?tab-language=python">RotationalMotor</a><span> </span>graph. Run the simulation to see the evolution.</p>
<p>Don't forget to set the<span> </span><code>controller</code><span> </span>field of the<span> </span><a href="https://cyberbotics.com/doc/reference/robot?tab-language=python">Robot</a><span> </span>node to indicate your new controller.</p>
<p>As usual a possible solution of this exercise is located in the tutorials directory.</p>
<h4 class="anchor-header" id="thecontrollercode" name="the-controller-code"><a class="anchor-link" href="https://cyberbotics.com/doc/guide/tutorial-6-4-wheels-robot?tab-language=python#the-controller-code"><span class="anchor-link-image"></span></a>The Controller Code</h4>
<p>Here is the complete code of the controller developed in the previous subsection.</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">from controller import Robot

TIME_STEP = 64
robot = Robot()
ds = []
dsNames = ['ds_right', 'ds_left']
for i in range(2):
    ds.append(robot.getDevice(dsNames[i]))
    ds[i].enable(TIME_STEP)
wheels = []
wheelsNames = ['wheel1', 'wheel2', 'wheel3', 'wheel4']
for i in range(4):
    wheels.append(robot.getDevice(wheelsNames[i]))
    wheels[i].setPosition(float('inf'))
    wheels[i].setVelocity(0.0)
avoidObstacleCounter = 0
while robot.step(TIME_STEP) != -1:
    leftSpeed = 1.0
    rightSpeed = 1.0
    if avoidObstacleCounter &gt; 0:
        avoidObstacleCounter -= 1
        leftSpeed = 1.0
        rightSpeed = -1.0
    else:  # read sensors
        for i in range(2):
            if ds[i].getValue() &lt; 950.0:
                avoidObstacleCounter = 100
    wheels[0].setVelocity(leftSpeed)
    wheels[1].setVelocity(rightSpeed)
    wheels[2].setVelocity(leftSpeed)
    wheels[3].setVelocity(rightSpeed)</pre>
<h4 class="anchor-header" id="solutionworldfile" name="solution-world-file">Solution: World File</h4>
<p>To compare your world with the solution, go to your files and find the folder named "my_first_simulation" created in<span> </span><a class="dynamicLoad" href="https://cyberbotics.com/doc/guide/tutorial-1-your-first-simulation-in-webots?tab-language=python">Tutorial 1</a>, then go to the "worlds" folder and open with a text editor the right world.<span> </span><a href="https://github.com/cyberbotics/webots/tree/released/projects/samples/tutorials/worlds/4_wheels_robot.wbt?tab-language=python" target="_blank">This solution</a><span> </span>as the others is located in the<span> </span><a href="https://github.com/cyberbotics/webots/tree/released/projects/samples/tutorials/worlds/?tab-language=python" target="_blank">solution directory</a>.</p>
<h4 class="anchor-header" id="conclusion" name="conclusion"><a class="anchor-link" href="https://cyberbotics.com/doc/guide/tutorial-6-4-wheels-robot?tab-language=python#conclusion"><span class="anchor-link-image"></span></a>Conclusion</h4>
<p>You are now able to design simple robot models, to implement them and to create their controllers.</p>
<p>More specifically, you learnt all the different nodes involved in the design of a robot model, methods to translate and rotate a solid relative to another and the way that a rotational motor is actuated by the controller.</p>
<h3>Tutorial7</h3>
<h4 class="anchor-header" id="tutorial7yourfirstproto20minutes" name="tutorial-7-your-first-proto-20-minutes">Tutorial 7: Your First PROTO</h4>
<p>The aim of this tutorial is to create a PROTO file corresponding to the four wheels robot from the previous tutorial.</p>
<h4 class="anchor-header" id="copytherobotdefinition" name="copy-the-robot-definition">Copy the Robot Definition</h4>
<p>For now, the definition of the robot is completely contained in the world file. Moving this definition in a PROTO file will allow you to use this robot without the need to completely copy and paste its definition (either several times in the same world or in different worlds).</p>
<blockquote>
<p><strong>Hands-on #1</strong>: Open the world<span> </span><code>4_wheels_robot.wbt</code><span> </span>created in the previous tutorial in your favorite text editor. Create a new empty text file in the<span> </span><code>protos</code><span> </span>folder of your project called<span> </span><code>FourWheelsRobot.proto</code><span> </span>and open this file in the text editor too, this file will contain the definition of your robot.</p>
</blockquote>
<p>Any PROTO file should at least respect the following structure:</p>
<pre class="brush:js;auto-links:false;toolbar:false" contenteditable="false">#VRML_SIM R2025a utf8
PROTO protoName [
  protoFields
]
{
  protoBody
}</pre>
<p>The<span> </span><code>protoName</code><span> </span>should be the name of the PROTO file (i.e.<span> </span><code>FourWheelsRobot</code><span> </span>in this case),<span> </span><code>protoFields</code><span> </span>defines the modifiable fields of the PROTO node (this part should be empty for now) and the<span> </span><code>protoBody</code><span> </span>is the definition of the root node (i.e. the<span> </span><a href="https://cyberbotics.com/doc/reference/robot?tab-language=python">Robot</a><span> </span>node in this case).</p>
<blockquote>
<p><strong>Hands-on #2</strong>: Write this default structure in your PROTO file with the correct<span> </span><code>protoName</code>. From the<span> </span><code>4_wheels_robot.wbt</code><span> </span>world file copy the robot node (starting with<span> </span><code>Robot {</code><span> </span>and ending with the final<span> </span><code>}</code>) and paste it in your PROTO file instead of the<span> </span><code>protoBody</code>. Finally, save the PROTO file.</p>
</blockquote>
<p><strong>Solution</strong>: You should have something like this:</p>
<pre class="brush:js;auto-links:false;toolbar:false" contenteditable="false">#VRML_SIM R2025a utf8
  PROTO FourWheelsRobot [

  ]
  {
    Robot {
      # list of fields
    }
  }</pre>
<h4>Use the PROTO Node.</h4>
<p>This new PROTO node is now available for each world in your current project.</p>
<p><img alt="" height="157" src="/images/tutorial7_proto.thumbnail.jpg" width="300"/></p>
<blockquote>
<p><strong>Hands-on #3</strong>: Open the<span> </span><code>4_wheels_robot.wbt</code><span> </span>world in Webots and add the<span> </span><code>FourWheelsRobot</code><span> </span>node (that you just defined). The node is located in<span> </span><code>PROTO nodes (Current Project) / FourWheelsRobot (Robot)</code>.</p>
</blockquote>
<p>A second 4 wheels robot should have been added at the exact same location as the already existing one.</p>
<h4 class="anchor-header" id="addingfields" name="adding-fields"><a class="anchor-link" href="https://cyberbotics.com/doc/guide/tutorial-7-your-first-proto?tab-language=python#adding-fields"><span class="anchor-link-image"></span></a>Adding Fields</h4>
<p>As you probably noticed, this new PROTO node doesn't have any open field, it is therefore impossible to translate, rotate or change the controller for example. It is very easy to add new fields to a PROTO node and to link them with internal fields. This should be done in the PROTO interface part (part between the<span> </span><code>[</code><span> </span>and the<span> </span><code>]</code>).</p>
<blockquote>
<p><strong>Hands-on #4</strong>: Edit your PROTO file in your text editor and add the definition of the<span> </span><code>translation</code>,<span> </span><code>rotation</code><span> </span>and<span> </span><code>bodyMass</code><span> </span>field in the PROTO interface part:</p>
</blockquote>
<pre><code>  field SFVec3f    translation  0 0 0
  field SFRotation rotation     0 0 1 0
  field SFFloat    bodyMass     1
</code></pre>
<p>Your PROTO node has now two open fields but they are not linked to any internal field. To link the fields you should use the IS keyword, simply replace the<span> </span><code>translation x y z</code><span> </span>and<span> </span><code>rotation x y z angle</code><span> </span>fields of the<span> </span><a href="https://cyberbotics.com/doc/reference/robot?tab-language=python">Robot</a><span> </span>node by:</p>
<pre><code>  translation IS translation
  rotation IS rotation
</code></pre>
<p>And the<span> </span><code>mass</code><span> </span>field of the<span> </span><a href="https://cyberbotics.com/doc/reference/physics?tab-language=python">Physics</a><span> </span>node of the<span> </span><a href="https://cyberbotics.com/doc/reference/robot?tab-language=python">Robot</a><span> </span>node by:</p>
<pre><code>  mass IS bodyMass
</code></pre>
<p>Save your PROTO file, it should now look like this:</p>
<pre class="brush:js;auto-links:false;toolbar:false" contenteditable="false">#VRML_SIM R2025a utf8
PROTO FourWheelsRobot [
  field SFVec3f    translation  0 0 0
  field SFRotation rotation     0 0 1 0
  field SFFloat    bodyMass     1
]
{
  Robot {
    translation IS translation
    rotation IS rotation
    children [
      # list of children nodes
    ]
    boundingObject USE BODY
    physics Physics {
      density -1
      mass IS bodyMass
    }
    controller "four_wheels_collision_avoidance"
  }
}</pre>
<p>You can now save your simulation in Webots and revert it. The<span> </span><code>translation</code>,<span> </span><code>rotation</code><span> </span>and<span> </span><code>bodyMass</code><span> </span>of the<span> </span><code>FourWheelsRobot</code><span> </span>node can now be changed (either in the<span> </span><a class="dynamicLoad" href="https://cyberbotics.com/doc/guide/the-scene-tree?tab-language=python">scene tree</a><span> </span>or using the handles in the<span> </span><a class="dynamicLoad" href="https://cyberbotics.com/doc/guide/the-3d-window?tab-language=python">3D view</a>).</p>
<p>The same mechanism could also be used to expose the<span> </span><code>controller</code><span> </span>field of the<span> </span><a href="https://cyberbotics.com/doc/reference/robot?tab-language=python">Robot</a><span> </span>node.</p>
<h4 class="anchor-header" id="solutionprotofile" name="solution-proto-file"><a class="anchor-link" href="https://cyberbotics.com/doc/guide/tutorial-7-your-first-proto?tab-language=python#solution-proto-file"><span class="anchor-link-image"></span></a>Solution: PROTO File</h4>
<p>To compare your PROTO file with<span> </span><a href="https://github.com/cyberbotics/webots/tree/released/projects/samples/tutorials/protos/FourWheelsRobot.proto" target="_blank">the solution</a>, go to your files and find the folder named "my_first_simulation" created in<span> </span><a class="dynamicLoad" href="https://cyberbotics.com/doc/guide/tutorial-1-your-first-simulation-in-webots?tab-language=python">Tutorial 1</a>, then go to the "protos" folder and open with a text editor the right PROTO.</p>
<h4 class="anchor-header" id="conclusion" name="conclusion"><a class="anchor-link" href="https://cyberbotics.com/doc/guide/tutorial-7-your-first-proto?tab-language=python#conclusion"><span class="anchor-link-image"></span></a>Conclusion</h4>
<p>You are now able to create PROTO nodes from any nodes you created in Webots.</p>
<p>More specifically, you learnt how to copy the node definition in the PROTO file and how to open and link PROTO fields to internal node fields.</p>
<p>To go further, the<span> </span><a href="https://cyberbotics.com/doc/reference/proto?tab-language=python">PROTO chapter</a><span> </span>of the reference manual explains in detail all the possibilities of the PROTO mechanism.</p>
<h3>Stream</h3>
<p><a href="https://cyberbotics.com/doc/guide/web-streaming">https://cyberbotics.com/doc/guide/web-streaming</a></p>
<p>Webots 透過 webotsw --stream 所啟動的串流伺服器, 僅允許連接 streaming_viewer 目錄中的 index.html, 若希望直接透過 index.html 啟動 WebSocket 連線, 就必須自行建立 WWW server.</p>
<p>以下利用 Python 程式在 port 8000 建立 WWW server, 並且執行時自動利用 Edge 連線至 index4.html 超文件.</p>
<p><a href="/downloads/python_www_server.py.txt">python_www_server.py</a></p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">import http.server
import socketserver
import threading
import webbrowser
import time
import os
import sys
import subprocess

PORT = 8000
DIRECTORY = os.path.dirname(os.path.abspath(__file__))

class Handler(http.server.SimpleHTTPRequestHandler):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, directory=DIRECTORY, **kwargs)

def open_edge(url):
    # Try common Edge paths on Windows
    edge_paths = [
        r"C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe",
        r"C:\Program Files\Microsoft\Edge\Application\msedge.exe"
    ]
    for path in edge_paths:
        if os.path.exists(path):
            subprocess.Popen([path, url])
            return True
    # Fallback: try using webbrowser module (may open in default browser)
    try:
        webbrowser.get('windows-default').open(url)
    except:
        webbrowser.open(url)
    return False

def run_server():
    with socketserver.TCPServer(("", PORT), Handler) as httpd:
        print(f"Serving at http://localhost:{PORT}")
        httpd.serve_forever()

if __name__ == "__main__":
    # Start server in a thread
    server_thread = threading.Thread(target=run_server, daemon=True)
    server_thread.start()

    # Wait a moment for the server to start
    time.sleep(1)

    # Open Edge to the local index.html
    url = f"http://localhost:{PORT}/streaming_viewer/index4.html"
    print(f"Opening {url} in Edge...")
    open_edge(url)

    # Keep main thread alive to keep server running
    try:
        while True:
            time.sleep(10)
    except KeyboardInterrupt:
        print("Shutting down.")
        sys.exit(0)</pre>
<p><a href="/downloads/index4.html.txt">index4.html</a></p>
<pre class="brush:html;auto-links:false;toolbar:false" contenteditable="false">&lt;!DOCTYPE html&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;

  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;
    &lt;title&gt;Streaming viewer&lt;/title&gt;
    &lt;link rel="icon" type="image/png" href="webots_icon.png"&gt;
    &lt;link type="text/css" rel="stylesheet" href='style.css' /&gt;
    &lt;style&gt;
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        width: 100vw;
        height: 100vh;
        min-height: 100vh;
        min-width: 100vw;
        display: flex;
        flex-direction: column;
        background: #222;
      }
      header {
        flex: 0 0 auto;
        padding: 0;
        margin: 0;
        background: #181818;
        color: #fff;
        text-align: center;
      }
      .title-container {
        margin: 0;
        padding: 0.5em 0;
      }
      .webots-view-container {
        flex: 1 1 0;
        display: flex;
        align-items: stretch;
        justify-content: stretch;
        min-height: 0;
        min-width: 0;
      }
      webots-view {
        width: 100vw;
        height: 100vh;
        flex: 1 1 0;
        display: block;
        min-width: 0;
        min-height: 0;
      }
    &lt;/style&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;div class="webots-view-container"&gt;
      &lt;webots-view&gt;&lt;/webots-view&gt;
    &lt;/div&gt;
    &lt;script type="module" src="http://localhost:8000/wwi/WebotsView.js"&gt;&lt;/script&gt;
    &lt;script&gt;
      // Default WebSocket parameters
      const defaultIp = "ws://localhost:1234";
      const defaultStreamingMode = "x3d";
      const defaultBroadcast = false;
      const mobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      const defaultThumbnail = 'https://cyberbotics.com/wwi/R2023b/images/loading/default_thumbnail.png';

      // Optional: load mobile CSS if on mobile device
      if (mobileDevice) {
        let head = document.getElementsByTagName('head')[0];
        let mobileCss = document.createElement('link');
        mobileCss.setAttribute('rel', 'stylesheet');
        mobileCss.setAttribute('type', 'text/css');
        mobileCss.setAttribute('href', 'https://www.cyberbotics.com/wwi/R2023b/css/wwi_mobile.css');
        head.appendChild(mobileCss);
      }

      // Wait for WebotsView.js to load and custom element to be defined
      window.addEventListener('DOMContentLoaded', () =&gt; {
        customElements.whenDefined('webots-view').then(() =&gt; {
          const webotsView = document.querySelector('webots-view');
          webotsView.onready = () =&gt; {
            console.log("Connected to Webots streaming server!");
          };
          webotsView.ondisconnect = () =&gt; {
            console.log("Disconnected from Webots streaming server!");
          };
          webotsView.connect(defaultIp, defaultStreamingMode, defaultBroadcast, mobileDevice, -1, defaultThumbnail);
        });
      });
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
<h3>Webots Server</h3>
<p>Webots Server:</p>
<p style="padding-left: 30px;"><a href="https://github.com/mdecycu/webots-server">https://github.com/mdecycu/webots-server</a></p>
<p>Webots Cloud:</p>
<p style="padding-left: 30px;"><a href="https://github.com/cyberbotics/webots-cloud">https://github.com/cyberbotics/webots-cloud</a></p>
<p style="padding-left: 30px;"><a href="https://cyberbotics.com/doc/guide/web-server">https://cyberbotics.com/doc/guide/web-server</a></p>
<h2>Nx2Webots</h2>
<p><a href="https://wiki.ros.org/urdf/Tutorials">https://wiki.ros.org/urdf/Tutorials</a> </p>
<p><a href="https://github.com/cyberbotics/urdf2webots">https://github.com/cyberbotics/urdf2webots</a> </p>
<p>It's feasible to create a custom tool using <strong>NXOpen Python API</strong> to export a Siemens NX assembly into a Webots-compatible format, including joint information from assembly constraints (mates). However, there is <strong>no built-in or official exporter</strong> for this, so the tool would be fully custom-written. The most practical approach is to generate an intermediate <strong>URDF</strong> file (which includes meshes, hierarchy, and joints), then use Cyberbotics' open-source <strong>urdf2webots</strong> converter to produce a Webots <strong>PROTO</strong> file (recommended for reusable robot models) or directly a Robot node string for a .wbt world.</p>
<h4 id="step-by-step-approach-to-build-the-tool">Step-by-Step Approach to Build the Tool</h4>
<ol>
<li>
<p><strong>Set Up NXOpen Python Environment</strong>:</p>
<ul>
<li>Run scripts inside NX (via File &gt; Execute &gt; NX Open Python) or as journals.</li>
<li>Import modules: <code>import NXOpen</code>, <code>import NXOpen.Assemblies</code>, <code>import NXOpen.Positioning</code>, <code>import NXOpen.UF</code>, etc.</li>
<li>Access the displayed assembly: <code>theSession = NXOpen.Session.GetSession()</code>; <code>displayPart = theSession.Parts.Display</code>; <code>componentAssembly = displayPart.ComponentAssembly</code>.</li>
</ul>
</li>
<li>
<p><strong>Traverse the Assembly Hierarchy</strong>:</p>
<ul>
<li>Use a recursive function to walk the component tree:
<pre><code class="lang-python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> List
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_all_components</span><span class="hljs-params">(root: NXOpen.Assemblies.Component)</span> -&gt; List[NXOpen.Assemblies.Component]:</span>
    components = [root]
    <span class="hljs-keyword">for</span> child <span class="hljs-keyword">in</span> root.GetChildren():
        components.extend(get_all_components(child))
    <span class="hljs-keyword">return</span> components
<span class="hljs-comment"># Start from root</span>
root_comp = componentAssembly.RootComponent
all_comps = get_all_components(root_comp)
</code></pre>
</li>
<li>For each component: Get prototype part (<code>comp.Prototype</code>), position/orientation (<code>comp.Position</code> or matrix), name, etc.</li>
<li>Identify the "base" link (usually the root or fixed part).</li>
</ul>
</li>
<li>
<p><strong>Export Meshes for Links</strong>:</p>
<ul>
<li>For each unique prototype part (link), export visual/collision meshes.</li>
<li>Preferred formats: STL (simple, supported in URDF) or OBJ/DAE (better materials, via intermediate if needed).</li>
<li>Use UF functions for STL export (common in journals):
<pre><code class="lang-python">ufSession = NXOpen.UF.UFSession.GetUFSession()
<span class="hljs-comment"># Collect solid bodies in the part</span>
<span class="hljs-keyword">bodies </span>= part.<span class="hljs-keyword">Bodies.ToArray()
</span>for <span class="hljs-keyword">body </span>in <span class="hljs-keyword">bodies:
</span>    ufSession.Std.PutSolidInStlFile(file_handle, NXOpen.Tag.Null, <span class="hljs-keyword">body.Tag, </span>tolerance, <span class="hljs-number">0</span>.<span class="hljs-number">0</span>, <span class="hljs-number">0</span>.<span class="hljs-number">0</span>, num_errors, errors)
</code></pre>
</li>
<li>Export each link as a separate mesh file (e.g., <code>link_name_visual.stl</code>) to a output folder.</li>
<li>For collision, use simplified meshes or the same as visual.</li>
<li>Compute inertia/mass if possible (NXOpen has mass properties APIs).</li>
</ul>
</li>
<li>
<p><strong>Extract Joint Information from Constraints</strong>:</p>
<ul>
<li>NX assembly constraints are accessible via <code>NXOpen.Positioning.Constraint</code> and <code>ComponentConstraint</code>.</li>
<li>For each component: <code>constraints = comp.GetConstraints()</code> (or from Positioner).</li>
<li>Analyze constraint type (<code>constraint.ConstraintType</code>): e.g., TouchAlign, Concentric, Distance, Angle → map to URDF joint types:
<ul>
<li>Concentric/Cylindrical → revolute or continuous.</li>
<li>Slider/Linear → prismatic.</li>
<li>Fixed → fixed.</li>
<li>Ball/InPlane → ball or planar (limited in Webots).</li>
</ul>
</li>
<li>Determine parent/child links, joint origin (from constraint geometry), axis (from alignment vectors).</li>
<li>This is the most complex part: Constraints are between geometry (faces, edges, datums), not directly "joints" like in URDF. You'll need logic to infer DOF, axis, limits (from constraint expressions).</li>
<li>If the assembly uses Motion joints (requires Mechanisms license), use <code>NXOpen.Motion</code> APIs for explicit joints/links.</li>
</ul>
</li>
<li>
<p><strong>Generate URDF XML</strong>:</p>
<ul>
<li>Write a .urdf file using Python string templates or xml library.</li>
<li>Structure:
<ul>
<li><code>&lt;robot name="..."&gt;</code></li>
<li><code>&lt;link name="base_link"&gt; &lt;visual&gt; &lt;mesh filename="base.stl"/&gt; &lt;/visual&gt; ... &lt;/link&gt;</code></li>
<li><code>&lt;joint name="..." type="revolute"&gt; &lt;parent link="base"/&gt; &lt;child link="arm"/&gt; &lt;origin xyz="..." rpy="..."/&gt; &lt;axis xyz="..."/&gt; &lt;limit .../&gt; &lt;/joint&gt;</code></li>
</ul>
</li>
<li>Convert NX positions/matrices to URDF origin (xyz + roll-pitch-yaw).</li>
<li>Add inertial if computed.</li>
</ul>
</li>
<li>
<p><strong>Convert to Webots</strong>:</p>
<ul>
<li>Run the external tool: <code>python urdf2webots.py --input=my_robot.urdf --output=my_robot.proto</code></li>
<li>Options: Specify base translation/rotation, joint limits scaling, etc.</li>
<li>The resulting .proto file can be inserted into a Webots world as a reusable robot model.</li>
<li>For a one-off world, use <code>--output-inline</code> to get a Robot node string and paste into .wbt.</li>
</ul>
</li>
</ol>
<h4 id="challenges-and-tips">Challenges and Tips</h4>
<ul>
<li><strong>Joint Mapping Accuracy</strong>: NX constraints are positioning mates, not always kinematic joints. Complex/multi-DOF constraints may need manual rules or simplification. Test with simple assemblies first (e.g., revolute from concentric + align).</li>
<li><strong>Coordinate Systems</strong>: NX uses absolute CSYS; URDF/Webots use chain from base. Ensure consistent units (meters in Webots/URDF).</li>
<li><strong>Performance</strong>: In Webots, use simplified boundingObjects (primitives) instead of mesh collisions.</li>
<li><strong>Alternatives if URDF is Too Hard</strong>:
<ul>
<li>Directly generate Webots PROTO text: Recreate hierarchy with Solid/Transform/CadShape nodes, HingeJoint/SliderJoint for inferred joints.</li>
<li>But URDF route is cleaner and leverages existing converter.</li>
</ul>
</li>
<li><strong>Testing</strong>: Start with a simple 2-link arm assembly in NX. Export manually first, then automate.</li>
<li>Resources: NXOpen Python docs (Siemens site), example journals on GitHub (search "NXOpen assembly traverse"), urdf2webots repo.</li>
</ul>
<p>This would result in a powerful custom exporter script. If your assemblies use Motion Simulation joints explicitly, it's easier. For pure assembly constraints, expect some custom logic for joint inference. If you share a sample assembly structure, more specific code snippets could help!</p><h1>Projects</h1>
<p>利用 Solvespae、NX、Onshape 或其他 CAD 套件建立下列的五軸機械臂零組件。</p>
<p>驅動設計請採用 NEMA (National Electrical Manufacturers Association) 17 步進馬達:</p>
<p style="padding-left: 30px;">法蘭 (Flange) 尺寸 1.7 英吋: 約 43.2 mm x 43.2 mm</p>
<p style="padding-left: 30px;">軸心直徑: 5 mm</p>
<p style="padding-left: 30px;">螺絲孔間距: 約 31 mm</p>
<p style="padding-left: 30px;">長度 (厚度): 通常為 34~60 mm</p>
<p style="padding-left: 30px;">步進角: 一般為 1.8°（每轉 200 步）</p>
<p style="padding-left: 30px;">驅動電壓與電流: 視型號而定，常見如 12V, 1~2A</p>
<h4>Linkages</h4>
<p style="padding-left: 30px;"><a href="https://blog.rectorsquid.com/linkage-mechanism-designer-and-simulator/">https://blog.rectorsquid.com/linkage-mechanism-designer-and-simulator/</a> </p>
<p style="padding-left: 30px;">5-bar</p>
<p style="padding-left: 30px;"><a href="/downloads/plotter.7z">plotter.7z</a> (in Solvespace)</p>
<p style="padding-left: 30px;"><img alt="" height="300" src="/images/5bar_simulation.gif" width="300"/></p>
<p style="padding-left: 30px;"><img alt="" height="300" src="/images/mickey_mouse_plot.gif" width="300"/></p>
<p style="padding-left: 30px;"><img caption="false" height="348" src="/images/fivebar_plotter.gif" width="500"/></p>
<p style="padding-left: 30px;"><a href="/downloads/fivebar_parallel_linkage.7z">fivebar_parallel_linkage.7z</a> (in Solidworks and NX2312)</p>
<p style="padding-left: 30px;"><a href="https://github.com/mdecycu/5-Bar-Parallel-Robot-Kinematics-Simulation">https://github.com/mdecycu/5-Bar-Parallel-Robot-Kinematics-Simulation</a> </p>
<p style="padding-left: 30px;"><a href="https://github.com/mdecycu/parallel-five-bar-robot">https://github.com/mdecycu/parallel-five-bar-robot</a> </p>
<p style="padding-left: 30px;"><a href="https://github.com/mdecycu/five_bar_linkage">https://github.com/mdecycu/five_bar_linkage</a> </p>
<p style="padding-left: 30px;"><a href="https://github.com/mdecycu/FrostBot">https://github.com/mdecycu/FrostBot</a></p>
<p style="padding-left: 30px;"><a href="https://github.com/mdecycu/Robot-Sketcher-5-bar-parallel-manipulator-">https://github.com/mdecycu/Robot-Sketcher-5-bar-parallel-manipulator-</a> </p>
<p style="padding-left: 30px;"><a href="https://www.researchgate.net/publication/277299749_User's_manual_for_the_DexTAR_five-bar_parallel_robot">https://www.researchgate.net/publication/277299749_User's_manual_for_the_DexTAR_five-bar_parallel_robot</a></p>
<p style="padding-left: 30px;"><a href="https://www.mathworks.com/help/sm/ug/five-bar-robot.html">https://www.mathworks.com/help/sm/ug/five-bar-robot.html</a></p>
<p style="padding-left: 30px;"><a href="https://www.mdpi.com/2075-1702/10/11/971">Optimal Design of a Five-Bar Planar Manipulator and Its Controller by Using Different Algorithms for Minimum Shaking Forces and Moments for the Largest Trajectory in a Usable Workspace </a></p>
<p style="padding-left: 30px;"><a href="https://www.sciencedirect.com/science/article/pii/S0736584512001214">Kinematic calibration of a five-bar planar parallel robot using all working modes</a></p>
<p style="padding-left: 30px;"><a href="https://ieeexplore.ieee.org/document/9330526">Concurrent Design of a 2 Dof Five-Bar Parallel Robot a Hybrid Design of Rigid and Flexible Links</a></p>
<p style="padding-left: 30px;"><a href="/downloads/Kinematic Analysis of Five-Bar Mechanism.pdf">Kinematic Analysis of Five-Bar Mechanism.pdf</a></p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/dvi_3OcbsCI?si=uViJq3nPdyN4Jkda" title="YouTube video player" width="560"></iframe></p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/cPmnAHVEEYM?si=1qf8mlXzjz7RzdqQ" title="YouTube video player" width="560"></iframe></p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/yubS3_OUhQs?si=QGv55rstovztoQm2" title="YouTube video player" width="560"></iframe></p>
<p><a href="https://link.springer.com/chapter/10.1007/978-3-319-98020-1_28">Kinematic Design of Five-Bar Parallel Robot by Kinematically Defined Performance Index for Energy Consumption</a></p>
<p><a href="https://github.com/Phylliade/ikpy">https://github.com/Phylliade/ikpy</a> </p>
<p><a href="https://hackaday.io/project/173325-educational-five-bar-parallel-robot">https://hackaday.io/project/173325-educational-five-bar-parallel-robot</a></p>
<div class="markdown-body MarkdownRenderer-module__container--wIGWk" data-copilot-markdown="true" style="--markdownrenderer_streaming-fade-duration: 750ms;"></div><h2>Control</h2>
<p><a href="https://link.springer.com/book/10.1007/978-1-4842-9600-4">Essentials of Arduino Boards Programming</a> (電子書)  </p>
<p><a href="/downloads/PythonForControl.pdf">PythonForControl.pdf</a></p>
<p><a href="https://openmodelica.org/">OpenModelica</a> + <a href="https://github.com/modelon-community/PyFMI">Pyfmi</a> + Webots</p>
<p>1. 在 Modelica 建立控制器:</p>
<pre class="brush:js;auto-links:false;toolbar:false" contenteditable="false">model SimplePIDController
  input Real position;
  output Real torque;

  parameter Real Kp = 2.0;
  parameter Real Kd = 0.5;

  Real error;
  Real derror;
initial equation
  error = 0;
  derror = 0;
equation
  error = 0 - position;
  derror = der(error);
  torque = Kp * error + Kd * derror;
end SimplePIDController;
</pre>
<p>2. 匯出為 FMU</p>
<p>用 OpenModelica，匯出此模型為 FMU：<br/><br/>    使用 OMEdit ➜ 選擇 Export ➜ FMI<br/><br/>    勾選：<br/><br/>        ✔ FMU for Co-Simulation<br/><br/>        或 ✔ FMU for Model Exchange（自行利用 PyFMI 提供 solver）</p>
<p>會產生一個 .fmu 檔（zip 檔格式）。</p>
<p>3. Webots 中撰寫 Python 控制器:</p>
<p>以便讓 Webots 的機器人由 FMU 控制。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">from controller import Robot
from pyfmi import load_fmu

# Webots 設定
robot = Robot()
timestep = int(robot.getBasicTimeStep())

# 載入 FMU 控制器
controller = load_fmu("SimplePIDController.fmu")
controller.initialize()

# 獲取感測器與馬達
joint_sensor = robot.getPositionSensor("my_joint_sensor")
joint_sensor.enable(timestep)

motor = robot.getMotor("my_joint_motor")

while robot.step(timestep) != -1:
    position = joint_sensor.getValue()
    
    # 設定 FMU 輸入
    controller.set("position", position)
    
    # 執行一步 FMU 模型
    controller.do_step(current_t=robot.getTime(), step_size=timestep / 1000.0)
    
    # 取得輸出
    torque = controller.get("torque")
    
    # 輸出至 Webots 馬達
    motor.setTorque(torque)
</pre>
<p></p>
<h2>Printer</h2>
<p>這裡所指的 Printer 是 3D 列印機。</p>
<p><a href="https://en.wikipedia.org/wiki/3D_printing">3D Printing</a>:</p>
<p><b>3D printing</b>, or<span> </span><b>additive manufacturing</b>, is the<span> </span><a href="https://en.wikipedia.org/wiki/Manufacturing" title="Manufacturing">construction</a><span> </span>of a<span> </span><a class="mw-redirect" href="https://en.wikipedia.org/wiki/Three-dimensional_object" title="Three-dimensional object">three-dimensional object</a><span> </span>from a<span> </span><a href="https://en.wikipedia.org/wiki/Computer-aided_design" title="Computer-aided design">CAD</a><span> </span>model or a digital<span> </span><a href="https://en.wikipedia.org/wiki/3D_modeling" title="3D modeling">3D model</a>.<span> </span>It can be done in a variety of processes in which material is deposited, joined or solidified under<span> </span><a class="mw-redirect" href="https://en.wikipedia.org/wiki/Computer_Numerical_Control" title="Computer Numerical Control">computer control</a>,<span> </span>with the material being added together (such as plastics, liquids or powder grains being fused), typically layer by layer.</p>
<p>In the 1980s, 3D printing techniques were considered suitable only for the production of functional or aesthetic prototypes, and a more appropriate term for it at the time was<span> </span><a href="https://en.wikipedia.org/wiki/Rapid_prototyping" title="Rapid prototyping">rapid prototyping</a>.<span> </span>As of 2019, the precision, repeatability, and material range of 3D printing have increased to the point that some 3D printing processes are considered viable as an industrial-production technology; in this context, the term<span> </span><i>additive manufacturing</i><span> </span>can be used synonymously with<span> </span><i>3D printing</i>.One of the key advantages of 3D printing<span> </span>is the ability to produce very complex shapes or geometries that would be otherwise infeasible to construct by hand, including hollow parts or parts with internal<span> </span><a href="https://en.wikipedia.org/wiki/Truss" title="Truss">truss</a><span> </span>structures to reduce weight while creating less material waste.<span> </span><a href="https://en.wikipedia.org/wiki/Fused_filament_fabrication#Fused_deposition_modeling" title="Fused filament fabrication">Fused deposition modeling</a><span> </span>(FDM), which uses a continuous filament of a<span> </span><a href="https://en.wikipedia.org/wiki/Thermoplastic" title="Thermoplastic">thermoplastic</a><span> </span>material, is the most common 3D printing process in use as of 2020.</p>
<h2>Otto</h2>
<p><a href="/downloads/otto_robot.7z">otto_robot.7z</a></p>
<h2>Otto_ninja</h2>
<p><a href="https://www.printables.com/model/231580-otto-ninja-starter-robot/files">https://www.printables.com/model/231580-otto-ninja-starter-robot/files</a> </p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/NDIwhuxQPN8?si=ED_FAObUkAVFT5L-" title="YouTube video player" width="560"></iframe></p>
<h3>Simplify</h3>
<p>以下程式碼是一個專為 Blender 設計的 Python 程式，其目的是將複雜的 3D 模型零件簡化為凸包（Convex Hull），並在簡化後保留原始物件的物理屬性，最後將簡化後的模型匯出。<br/><br/>由於利用 CAD 繪出的零件，轉入 Webots 進行剛體動力學模擬運算時，若能將幾何外形轉換為網格資料較為簡單的凸包，可大幅減少物理引擎的運算負擔，進而提升模擬的流暢度和穩定性。<br/><br/>以下是程式碼的設計原理與主要流程：<br/><br/>設計原理:</p>
<p>分離設定與核心邏輯：程式碼將使用者可修改的參數（如檔案路徑、格式、簡化比率）放在程式開頭的「使用者設定」區塊，而將實際執行的功能封裝在獨立的函式中。這種設計使程式易於修改和維護，使用者不需要理解複雜的內部邏輯就能快速調整參數。<br/><br/>模組化函式：每個函式負責一個單一且明確的任務，例如 clear_scene() 清空場景、import_all_parts() 匯入模型、get_physics_properties() 獲取物理屬性等等。這種模組化設計使程式碼結構清晰，易於除錯和理解。<br/><br/>穩健的錯誤處理：在 import_all_parts()、get_physics_properties() 等函式中，程式碼都包含了對異常情況（如檔案夾不存在、物件無效）的檢查和錯誤訊息輸出。這確保了腳本在遇到問題時不會無故崩潰，而是能給出有用的提示。</p>
<p>複製-簡化-匹配三階段工作流程：</p>
<p style="padding-left: 30px;">複製：為每個原始零件建立一個副本。這樣可以避免直接修改原始物件。</p>
<p style="padding-left: 30px;">簡化：對這個副本執行凸包（Convex Hull）運算。凸包是一個包含原始物體所有頂點的最小凸多面體，可以將複雜的幾何體轉化為簡單的凸體。</p>
<p style="padding-left: 30px;">匹配：將簡化後的凸包賦予原始物件的物理屬性，包括位置、旋轉和質量。</p>
<p style="padding-left: 30px;">匯出：最後，刪除原始物件，只匯出簡化後的凸包。</p>
<p>利用 Blender scripting 簡化 OBJ 組立檔中的個別零件: <a href="/downloads/blender_simplify_obj_parts.7z">blender_simplify_obj_parts.7z</a></p>
<p><a href="/downloads/simplify_parts_v2.py">simplify_parts_v2.py</a></p>
<h2>OpenDuck</h2>
<p>登入 Onshape 後，連線至 <a href="https://cad.onshape.com/documents/64074dfcfa379b37d8a47762/w/3650ab4221e215a4f65eb7fe/e/0505c262d882183a25049d05">OpenDuck mini v2 官方 Onshape</a> 後，以滑鼠左鍵點選畫面左上方的功能表，點選 Copy workspace 後，選擇 Document name，滑鼠點選 Copy document to 中的 Owned by me，再點選下方的 Open 後，就可以取得 OpenDuck workspace 的副本。</p>
<p><img alt="" height="447" src="/images/openduck_mini.png" width="300"/></p>
<p><a href="https://github.com/apirrone/Open_Duck_Mini">https://github.com/apirrone/Open_Duck_Mini</a> </p>
<p><a href="/downloads/open_duck_mini.7z">open_duck_mini.7z</a></p>
<p><a href="https://cad.onshape.com/documents/59be6ef44ff9ea793708399b/w/03ff9d6a2e9b8a7faa389b8d/e/6187f5074585cebed7cda939?renderMode=0&amp;uiState=68bd91cbb7b7b693b837f515">STS3215 Onshape</a></p>
<p><a href="https://www.feetechrc.com/74v-19-kgcm-plastic-case-metal-tooth-magnetic-code-double-axis-ttl-series-steering-gear.html">STS3215 規格</a>、<a href="https://www.feetechrc.com/562636.html">STS3250 規格</a></p>
<p><a href="https://cad.onshape.com/documents/26c83cdd49510fc094b845a1/w/1f0ebd66fbcba930fc39351f/e/98c9ea7ad6f244e859d1e24a?renderMode=0&amp;uiState=68c666ca5b74dd05454f1e4f">Openduck mini Onshape</a></p>
<p><a href="/downloads/openduck_mini_nx2312.7z">openduck_mini_nx2312.7z</a></p>
<p><img caption="false" height="243" src="/images/openduck_mini_1.png" width="300"/></p>
<p><img alt="" height="275" src="/images/openduck_mini_2.png" width="300"/></p>
<p><img alt="" height="351" src="/images/openduck_mini_3.png" width="300"/></p>
<p><img alt="" height="488" src="/images/openduck_mini_4.png" width="300"/></p>
<p><img alt="" height="295" src="/images/openduck_mini_nx.png" width="300"/></p>
<p></p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/uZwMqvsVOQE?si=u9mo293eQLQ2wje-" title="YouTube video player" width="560"></iframe></p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/7_LW7u-nk6Q?si=vq_W0B4e1OgUCo-7" title="YouTube video player" width="560"></iframe></p><h2>Pupper</h2>
<p><a href="https://github.com/mangdangroboticsclub/mini_pupper_ros">https://github.com/mangdangroboticsclub/mini_pupper_ros</a> </p>
<p><a href="https://www.kickstarter.com/projects/mdrobotkits/mini-pupper-2-open-source-ros2-robot-kit-for-dreamers">https://www.kickstarter.com/projects/mdrobotkits/mini-pupper-2-open-source-ros2-robot-kit-for-dreamers</a> </p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/08J82rEK5bw?si=F-G8CgtcBF4m908f" title="YouTube video player" width="560"></iframe></p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/7KDan41gfN0?si=49v0ftkRirzJrHfY" title="YouTube video player" width="560"></iframe></p>
<h2>JetAcker</h2>
<p><a href="https://github.com/NVIDIA-AI-IOT/jetracer">https://github.com/NVIDIA-AI-IOT/jetracer</a> </p>
<p><a href="https://www.hiwonder.com/collections/robotics-1/products/jetacker">https://www.hiwonder.com/collections/robotics-1/products/jetacker</a> </p>
<p>SMARTmBOT:</p>
<p><a href="https://arxiv.org/pdf/2203.08903">https://arxiv.org/pdf/2203.08903</a> </p>
<p><a href="https://github.com/SMARTlab-Purdue/SMARTmBOT">https://github.com/SMARTlab-Purdue/SMARTmBOT</a> </p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/GW-PCGL0phY?si=DaEkmSpVARnf5Scw" title="YouTube video player" width="560"></iframe></p>
<h1>Brython</h1>
<p><button id="add1to100">1 add to 100</button></p>
<p><span node="[object Object]"><!-- 導入 brython 程式庫 --></span></p>
<p>
<script src="/static/brython.js"></script>
<script src="/static/brython_stdlib.js"></script>
</p>
<p><span node="[object Object]"><!-- 啟動 Brython --></span></p>
<p>
<script>
window.onload=function(){
brython({debug:1, pythonpath:['/static/','./../downloads/py/']});
}
</script>
</p>
<p><!-- 導入 FileSaver 與 filereader --></p>
<p>
<script src="/static/ace/FileSaver.min.js" type="text/javascript"></script>
<script src="/static/ace/filereader.js" type="text/javascript"></script>
</p>
<p><!-- 導入 ace --></p>
<p>
<script src="/static/ace/ace.js" type="text/javascript"></script>
<script src="/static/ace/ext-language_tools.js" type="text/javascript"></script>
<script src="/static/ace/mode-python3.js" type="text/javascript"></script>
<script src="/static/ace/snippets/python.js" type="text/javascript"></script>
</p>
<p><!-- 導入 gearUtils-0.9.js Cango 齒輪繪圖程式庫 -->
<script src="/static/Cango-24v03-min.js"></script>
<script src="/static/gearUtils-09.js"></script>
<script src="/static/SVGpathUtils-6v03-min.js"></script>
<script src="/static/sylvester.js"></script>
<script src="/static/PrairieDraw.js"></script>
</p>
<p><!-- 請注意, 這裡使用 Javascript 將 localStorage["kw_py_src1"] 中存在近端瀏覽器的程式碼, 由使用者決定存檔名稱--></p>
<p>
<script type="text/javascript">
function doSave(storage_id, filename){
    var blob = new Blob([localStorage[storage_id]], {type: "text/plain;charset=utf-8"});
    filename = document.getElementById(filename).value
    saveAs(blob, filename+".py");
}
</script>
</p>
<p>
<script type="text/python3">
from browser import document as doc
import ace
# 清除畫布
def clear_bd1(ev):
    bd = doc["brython_div1"]
    bd.clear()
Ace1 = ace.Editor(editor_id="kw_editor1", console_id="kw_console1", container_id="kw__container1", storage_id="kw_py_src1" )
# 從 gist 取出程式碼後, 放入 editor 作為 default 程式
def run1():
    # 利用 get 取下 src 變數值
    try:
        url = doc.query["src"]
    except:
        url = "https://gist.githubusercontent.com/mdecourse/0229a8a017091476a79700b8a190f185/raw/c3a6deaf717f8f2739a4b1392a5ab10936e9693a/from_1_add_to_10_1.py"
    prog = open(url).read()

    # 將程式載入編輯區
    Ace1.editor.setValue(prog)
    Ace1.editor.scrollToRow(0)
    Ace1.editor.gotoLine(0)
    # 直接執行程式
    #ns = {'__name__':'__main__'}
    #exec(prog, ns)
    # 按下 run 按鈕
    Ace1.run()

# 執行程式, 顯示輸出結果與清除輸出結果及對應按鈕綁定
doc['kw_run1'].bind('click', Ace1.run)
doc['kw_show_console1'].bind('click', Ace1.show_console)
doc['kw_clear_console1'].bind('click', Ace1.clear_console)
doc['clear_bd1'].bind('click', clear_bd1)
# 呼叫函式執行
run1()
</script>
</p>
<p><!-- add 1 to 100 開始 -->
<script type="text/python3">
from browser import document as doc
import ace

# 清除畫布
def clear_bd1(ev):
    bd = doc["brython_div1"]
    bd.clear()

# 利用 ace 中的 Editor 建立 Ace2 物件, 其中的輸入變數分別對應到頁面中的編輯區物件
Ace2 = ace.Editor(editor_id="kw_editor1", console_id="kw_console1", container_id="kw__container1", storage_id="kw_py_src1" )

add1to100_url = "https://gist.githubusercontent.com/mdecourse/0229a8a017091476a79700b8a190f185/raw/c48e37714f055c3a0027cbfef59e442a6ef659b9/from_1_add_to_100_1.py"

# 從 gist 取得程式碼
add_src = open(add1to100_url).read()
def add(ev):
    Ace2.editor.setValue(add_src)
    Ace2.editor.scrollToRow(0)
    Ace2.editor.gotoLine(0)
    Ace2.run()

# id 為 "add1to100" 的按鈕點按時, 執行 add 方法
doc["add1to100"].bind('click', add)
</script>
</p>
<p><!-- add 1 to 100 結束--></p>
<p><span node="[object Object]"><!-- editor1 開始 --></span></p>
<p><!-- 用來顯示程式碼的 editor 區域 --></p>
<div id="kw_editor1"></div>
<p><!-- 以下的表單與按鈕與前面的 Javascript doSave 函式以及 FileSaver.min.js 互相配合 --></p>
<p><!-- 存擋表單開始 --></p>
<form><label>Filename: <input id="kw_filename" placeholder="input file name" type="text"/>.py</label> <input onclick="doSave('kw_py_src1', 'kw_filename1');" type="submit" value="Save"/></form>
<p><!-- 存擋表單結束 --></p>
<p></p>
<p><!-- 執行與清除按鈕開始 --></p>
<p><button id="kw_run1">Run</button> <button id="kw_show_console1">Output</button> <button id="kw_clear_console1">清除輸出區</button><button id="clear_bd1">清除繪圖區</button><button onclick="window.location.reload()">Reload</button></p>
<p><!-- 執行與清除按鈕結束 --></p>
<p></p>
<p><!-- 程式執行 ouput 區 --></p>
<div><textarea autocomplete="off" id="kw_console1"></textarea></div>
<p><!-- Brython 程式執行的結果, 都以 brython_div1 作為切入位置 --></p>
<div id="brython_div1"></div>
<p><span node="[object Object]"><!-- editor1 結束 --></span></p>
<hr/>
<p><span node="[object Object]"><!-- ########################################## --></span></p>
<p>從 1 累加到 100 part2:</p>
<p><button id="add1to100part2">1 add to 100</button><button id="cango_three_gears">cango_three_gears</button><button id="bsnake">BSnake</button><button id="aitetris">AI Tetris</button></p>
<p><!-- 請注意, 這裡使用 Javascript 將 localStorage["kw_py_src2"] 中存在近端瀏覽器的程式碼, 由使用者決定存檔名稱--></p>
<p>
<script type="text/python3">
from browser import document as doc
import ace
# 清除畫布
def clear_bd2(ev):
    bd = doc["brython_div2"]
    bd.clear()
Ace3 = ace.Editor(editor_id="kw_editor2", console_id="kw_console2", container_id="kw__container2", storage_id="kw_py_src2" )
# 從 gist 取出程式碼後, 放入 editor 作為 default 程式
def run2():
    # 利用 get 取下 src 變數值
    try:
        url = doc.query["src2"]
    except:
        url = "https://gist.githubusercontent.com/mdecourse/0229a8a017091476a79700b8a190f185/raw/c3a6deaf717f8f2739a4b1392a5ab10936e9693a/from_1_add_to_10_1.py"
    prog = open(url).read()

    # 將程式載入編輯區
    Ace3.editor.setValue(prog)
    Ace3.editor.scrollToRow(0)
    Ace3.editor.gotoLine(0)
    # 直接執行程式
    #ns = {'__name__':'__main__'}
    #exec(prog, ns)
    # 按下 run 按鈕
    Ace3.run()

# 執行程式, 顯示輸出結果與清除輸出結果及對應按鈕綁定
doc['kw_run2'].bind('click', Ace3.run)
doc['kw_show_console2'].bind('click', Ace3.show_console)
doc['kw_clear_console2'].bind('click', Ace3.clear_console)
doc['clear_bd2'].bind('click', clear_bd2)
# 呼叫函式執行
run2()
</script>
</p>
<p><!-- add 1 to 100 part2 開始 -->
<script type="text/python3">
from browser import document as doc
import ace

# 清除畫布
def clear_bd2(ev):
    bd = doc["brython_div2"]
    bd.clear()

# 利用 ace 中的 Editor 建立 Ace2 物件, 其中的輸入變數分別對應到頁面中的編輯區物件
Ace4 = ace.Editor(editor_id="kw_editor2", console_id="kw_console2", container_id="kw__container2", storage_id="kw_py_src2" )

# 透過 Ace4 以類別建立一個通用的 button2, 可以在多個案例中將 gist 程導入編輯區

class button2:
    def __init__(self, url):
        self.url = url

    # 記得加入 event 輸入變數
    def do(self,ev):
        Ace4.editor.setValue(open(self.url).read())
        Ace4.editor.scrollToRow(0)
        Ace4.editor.gotoLine(0)
        Ace4.run()

add1to100_url = "https://gist.githubusercontent.com/mdecourse/0229a8a017091476a79700b8a190f185/raw/c48e37714f055c3a0027cbfef59e442a6ef659b9/from_1_add_to_100_1.py"

# 從 gist 取得程式碼
add_src = open(add1to100_url).read()
def add2(ev):
    Ace4.editor.setValue(add_src)
    Ace4.editor.scrollToRow(0)
    Ace4.editor.gotoLine(0)
    Ace4.run()

# id 為 "add1to100part2" 的按鈕點按時, 執行 add 方法
doc["add1to100part2"].bind('click', add2)
# 以下為運用 button2 class 的通用 gist 程式導入區
################################## cango_three_gears start
cango_three_gears_url = "https://gist.githubusercontent.com/mdecycu/d9082d678096bd58378d6afe2c7fa05d/raw/f7a85d737d6723d5e34c526d5daee990ed92c32b/cango_three_gears_brython_div2.py"
cango_three_gears = button2(cango_three_gears_url)
doc["cango_three_gears"].bind("click", cango_three_gears.do)
################################## cango_three_gears end
################################## bsnake start
bsnake_url = "https://gist.githubusercontent.com/mdecycu/d9082d678096bd58378d6afe2c7fa05d/raw/f7a85d737d6723d5e34c526d5daee990ed92c32b/kmol_snakey.py"
bsnake = button2(bsnake_url)
doc["bsnake"].bind("click", bsnake.do)
################################## bsnake end
################################## aitetris start
aitetris_url = "https://gist.githubusercontent.com/mdecycu/d9082d678096bd58378d6afe2c7fa05d/raw/f7a85d737d6723d5e34c526d5daee990ed92c32b/pygame_to_brython_tetris_ai.py"
aitetris = button2(aitetris_url)
doc["aitetris"].bind("click", aitetris.do)
################################## aitetris end
</script>
</p>
<p><!-- add 1 to 100 part2 結束--></p>
<p><span node="[object Object]"><!-- editor2 開始 --></span></p>
<p><!-- 用來顯示程式碼的 editor 區域 --></p>
<div id="kw_editor2"></div>
<p><!-- 以下的表單與按鈕與前面的 Javascript doSave 函式以及 FileSaver.min.js 互相配合 --></p>
<p><!-- 存擋表單開始 --></p>
<form><label>Filename: <input id="kw_filename2" placeholder="input file name" type="text"/>.py</label> <input onclick="doSave('kw_py_src2', 'kw_filename2');" type="submit" value="Save"/></form>
<p><!-- 存擋表單結束 --></p>
<p></p>
<p><!-- 執行與清除按鈕開始 --></p>
<p><button id="kw_run2">Run</button> <button id="kw_show_console2">Output</button> <button id="kw_clear_console2">清除輸出區</button><button id="clear_bd2">清除繪圖區</button><button onclick="window.location.reload()">Reload</button></p>
<p><!-- 執行與清除按鈕結束 --></p>
<p></p>
<p><!-- 程式執行 ouput 區 --></p>
<div><textarea autocomplete="off" id="kw_console2"></textarea></div>
<p><!-- Brython 程式執行的結果, 都以 brython_div1 作為切入位置 --></p>
<div id="brython_div2"></div>
<p><span node="[object Object]"><!-- editor2 結束 --></span></p>
<hr/></details></details></div>
<h1>w3</h1>
<p><span>w3: 用什麼套件完成 </span><a href="https://youtu.be/iOLFP90DneY">5-bar Linkage Plotter</a><span><span> </span>與<span> </span></span><a href="https://mde.tw/cad2025/content/OpenDuck.html">Openduck mini</a><span><span> </span>零組件設計繪圖？<span> </span></span><a href="https://solvespace.com/">Solvespace</a><span>,<span> </span></span><a href="https://plm.sw.siemens.com/en-US/nx/cad-online/">Siemens NX</a><span>,<span> </span></span><a href="https://www.onshape.com/en/">Onshape</a><span><span> </span>或其他？各有什麼優缺點？</span></p>
<p><span>41023235所作:</span></p>
<p><img alt="" height="2250" src="/images/w3 cad2025.jpg" width="800"/></p>
<h1>w7</h1>
<p><span>w7 (</span><span>2a 採 Youtube 影片簡報</span><span>):<span> </span></span><a href="https://youtu.be/iOLFP90DneY">5-bar Linkage Plotter</a><span><span> </span>與<span> </span></span><a href="https://mde.tw/cad2025/content/OpenDuck.html">Openduck mini</a><span> 零組件設計繪製完成之後，如何切割零件? 為何要切割零件？ 如何利用<span> </span></span><a href="https://cyberbotics.com/">Webots</a><span><span> </span>進行後續的控制系統設計與動態模擬 (Dynamic Simulation)？</span></p>
<p><span>41023235所作:</span></p>
<p><span>五連桿機構 切割零件 影片檔:</span></p>
<p><span><a href="https://www.youtube.com/watch?v=K8C22ZAvN-Q" target="_blank">https://www.youtube.com/watch?v=K8C22ZAvN-Q</a></span></p><h1>w10</h1>
<p><span>w10: </span><a href="https://cyberbotics.com/">Webots</a><span><span> </span>是什麼？有什麼特點？ 如何進行場景模擬？ 如何用 Python 進行控制系統設計？<span> </span></span></p>
<p><span>41023235所作:</span></p>
<p><img alt="" height="4500" src="/images/w10 cad2025.jpg" width="800"/></p>
<h1>w17</h1>
<p><span>w17: 如何實作一套 </span><a href="https://youtu.be/iOLFP90DneY">5-bar Linkage Plotter</a><span><span> </span>與<span> </span></span><a href="https://mde.tw/cad2025/content/OpenDuck.html">Openduck mini</a><span>？</span></p>
<p><span>41023235所作:</span></p>
<p><span><img alt="" height="5850" src="/images/w17 cad2025.jpg" width="800"/></span></p><h1>w18</h1>
<p><span>w18: 課程總結</span></p>
<p>《電腦輔助設計與實習》課程心得</p>
<p><span> </span></p>
<p>黃俊錡（<span>41023235</span>）</p>
<p><span> </span></p>
<p>在修習《電腦輔助設計與實習》課程的過程中，我首次系統性地接觸到以雲端與版本控制為核心的工程設計學習方式，包含<span> GitHub</span>、<span>Codespaces</span>、<span>Onshape </span>與<span> Webots </span>等工具，讓我對現代工程設計的實際流程有了全新的認識。</p>
<p><span> </span></p>
<p>在程式與專題管理方面，透過<span> Git </span>與<span> GitHub </span>的使用，我學會如何進行版本控制、提交修改、處理衝突，以及透過<span> fork </span>與<span> repository </span>進行課程作業的管理。搭配<span> GitHub Codespaces</span>，不需要額外安裝環境即可直接在瀏覽器中撰寫與執行程式，讓我體會到雲端開發在學習與協作上的便利性，也大幅降低了環境設定所帶來的困擾。</p>
<p><span> </span></p>
<p>在電腦輔助設計部分，課程中使用<span> Onshape </span>進行零組件建模與組合件設計。透過實際操作，我學會如何建立零件、組合零件之間的約束關係，以及將組合件中的零件拆分、另存為獨立檔案，進一步理解設計流程中「零件—組合—再利用」的概念。這些經驗讓我對雲端<span> CAD </span>在多人協作與版本管理上的優勢有更深刻的體會。</p>
<p><span> </span></p>
<p>此外，透過<span> Webots </span>的模擬練習，我開始將設計好的機構結合控制程式進行動態模擬。從機器人模型的建立、控制器程式的撰寫，到實際在模擬環境中觀察運動結果，讓我理解到機械設計、程式控制與系統整合之間的關聯性，也體會到僅有外型設計是不足以完成一個可運作系統的。</p>
<p><span> </span></p>
<p>在學習過程中，我經常遇到操作不熟、錯誤訊息看不懂，或流程觀念混淆的情況，但透過反覆嘗試、查資料與請教問題，我逐漸建立起解決問題的能力，也對工程學習需要耐心與邏輯思考有更深的認知。</p>
<p><span> </span></p>
<p>總結來說，《電腦輔助設計與實習》是一門結合程式設計、機構建模與模擬驗證的實務導向課程。透過<span> GitHub</span>、<span>Codespaces</span>、<span>Onshape </span>與<span> Webots </span>的整合使用，我不僅提升了實際操作能力，也更清楚了解現代工程設計從程式、建模到模擬的完整流程。感謝老師的指導，讓我在實作中累積經驗，並為未來進一步學習相關工程技術打下基礎。</p><h1>(3D模型)</h1>
<p><span><span>五連桿機構: <a href="https://cad.onshape.com/documents/59e3eee07b08365cb9fdbe41/w/0f1d8c56634316dcb90b8b76/e/5214b3925450f29f8b87f1b2">https://cad.onshape.com/documents/59e3eee07b08365cb9fdbe41/w/0f1d8c56634316dcb90b8b76/e/5214b3925450f29f8b87f1b2</a></span></span></p>
<p>openduck:<a href="https://cad.onshape.com/documents/8f67f671a9487b24228106c2/w/d6807f8e186eafbe761f9189/e/030824c0596a503cbb8bdba3">https://cad.onshape.com/documents/8f67f671a9487b24228106c2/w/d6807f8e186eafbe761f9189/e/030824c0596a503cbb8bdba3</a></p>
<p></p>
<h1>期末影片</h1>
<p><a href="https://www.youtube.com/watch?v=NaBb3PUw1K0">https://www.youtube.com/watch?v=NaBb3PUw1K0</a></p>
<p></p><h1>Ref</h1><h2>Reeborg</h2>
<p><a href="https://mde.tw/cp2025/reeborg?lang=en&amp;mode=python&amp;menu=worlds/menus/select_collection_en.json&amp;name=Alone&amp;url=worlds/tutorial_en/harvest1.json&amp;editor=python/harvest1.py">https://mde.tw/cp2025/reeborg?lang=en&amp;mode=python&amp;menu=worlds/menus/select_collection_en.json&amp;name=Alone&amp;url=worlds/tutorial_en/harvest1.json&amp;editor=python/harvest1.py</a></p>
<p><a href="https://mde.tw/cp2025/reeborg?lang=en&amp;mode=python&amp;menu=worlds/menus/select_collection_en.json&amp;name=Alone&amp;url=worlds/tutorial_en/harvest1.json&amp;editor=python/harvest1_east_west.py">https://mde.tw/cp2025/reeborg?lang=en&amp;mode=python&amp;menu=worlds/menus/select_collection_en.json&amp;name=Alone&amp;url=worlds/tutorial_en/harvest1.json&amp;editor=python/harvest1_east_west.py</a> </p>
<hr/>
<p><a href="https://mde.tw/reeborg">https://mde.tw/reeborg</a></p>
<p><a href="https://github.com/mdecycu/cs101">https://github.com/mdecycu/cs101</a></p>
<p><a href="https://reeborg.ca/docs/en/python/index.html">https://reeborg.ca/docs/en/python/index.html</a></p>
<p><a href="https://aroberge.github.io/reeborg-api/">https://aroberge.github.io/reeborg-api/</a></p>
<p>if using local static port 9442:</p>
<p style="padding-left: 30px;"><a href="https://127.0.0.1:8442/reeborg/?lang=en&amp;mode=python&amp;menu=%2Freeborg%2Fworlds%2Fmenus%2Fselect_collection_en.json&amp;name=Alone&amp;url=%2Freeborg%2Fworlds%2Ftutorial_en%2Fharvest1.json&amp;editor=%2Freeborg%2Fpython%2Fharvest1.py">Reeborg</a></p>
<p>For Github Pages:</p>
<p style="padding-left: 30px;"><a href="https://mde.tw/cp2025/reeborg?lang=en&amp;mode=python&amp;menu=%2Freeborg%2Fworlds%2Fmenus%2Fselect_collection_en.json&amp;name=Alone&amp;url=%2Freeborg%2Fworlds%2Ftutorial_en%2Fharvest1.json&amp;editor=%2Freeborg%2Fpython%2Fharvest1.py">Reeborg</a></p>
<p></p>
<h3>ex1</h3>
<p><a href="https://mde.tw/cp2025/reeborg?lang=en&amp;mode=python&amp;menu=worlds/menus/select_collection_en.json&amp;name=Alone&amp;url=worlds/tutorial_en/harvest1.json&amp;editor=python/harvest1.py">https://mde.tw/cp2025/reeborg?lang=en&amp;mode=python&amp;menu=worlds/menus/select_collection_en.json&amp;name=Alone&amp;url=worlds/tutorial_en/harvest1.json&amp;editor=python/harvest1.py</a> 是已知的機器人採收紅蘿蔔的程式，經由以下與 Copilot 的對話，希望透過 Python Class 的編寫解決特定範圍農作物採收的程式。</p>
<p>問句:</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">以下是 Reeborg 一個用來採收紅蘿蔔的程式, 目前位於 (3,3) 到 (8,8) 的區域中各座標點, 各有一個紅羅蔔等待採收, 現在想要建立一個 harvest() class, 可以利用 (3,3), (8,8)作為標定有農作物必須採收的兩個區域對角點座標, 而程式可以利用此一 harvest 類別生成案例完成採收的任務: def turn(int):
    for i in range(int):
        turn_left()
        
def new_move(int):
    for i in range(int):
        move()
        
def harvest_one_row():
    while object_here():
        take()
    else:
        move()
# move to the field
new_move(2)
turn_left()
new_move(2)

for i in range(3):
    while is_facing_north():
        for i in range(6):
            harvest_one_row()
        for i in range(2):
            turn(3)
            move() 
    else:
        for i in range(6):
            harvest_one_row()
        for i in range(2):
            turn_left()
            move()</pre>
<p>AI 回答: <a href="https://mde.tw/cp2025/reeborg?lang=en&amp;mode=python&amp;menu=worlds/menus/select_collection_en.json&amp;name=Alone&amp;url=worlds/tutorial_en/harvest1.json&amp;editor=python/harvest1_class_ex1.py">https://mde.tw/cp2025/reeborg?lang=en&amp;mode=python&amp;menu=worlds/menus/select_collection_en.json&amp;name=Alone&amp;url=worlds/tutorial_en/harvest1.json&amp;editor=python/harvest1_class_ex1.py</a> </p>
<p>進一步要求:</p>
<pre class="brush:js;auto-links:false;toolbar:false" contenteditable="false">請在類別中加上一個採收方向的參數, 內建變數是 horizontal 採收, 也就是由西邊往東邊的水平方向進行採收, 但若該方向變數設為 vertical 則會由南邊往北的所謂垂直方向進行採收</pre>
<p>AI 回應: <a href="https://mde.tw/cp2025/reeborg?lang=en&amp;mode=python&amp;menu=worlds/menus/select_collection_en.json&amp;name=Alone&amp;url=worlds/tutorial_en/harvest1.json&amp;editor=python/harvest1_class_ex2.py">https://mde.tw/cp2025/reeborg?lang=en&amp;mode=python&amp;menu=worlds/menus/select_collection_en.json&amp;name=Alone&amp;url=worlds/tutorial_en/harvest1.json&amp;editor=python/harvest1_class_ex2.py </a> </p>
<p>延伸到採收 harvest2 農田: <a href="https://mde.tw/cp2025/reeborg/?lang=en&amp;mode=python&amp;menu=worlds/menus/select_collection_en.json&amp;name=Alone&amp;url=worlds/tutorial_en/harvest2.json&amp;editor=python/harvest1_class_ex1.py">https://mde.tw/cp2025/reeborg/?lang=en&amp;mode=python&amp;menu=worlds/menus/select_collection_en.json&amp;name=Alone&amp;url=worlds/tutorial_en/harvest2.json&amp;editor=python/harvest1_class_ex1.py</a> </p>
<p>但卻沒能套用到 harvest3 農田: <a href="https://mde.tw/cp2025/reeborg/?lang=en&amp;mode=python&amp;menu=worlds/menus/select_collection_en.json&amp;name=Alone&amp;url=worlds/tutorial_en/harvest3.json&amp;editor=python/harvest1_class_ex1.py">https://mde.tw/cp2025/reeborg/?lang=en&amp;mode=python&amp;menu=worlds/menus/select_collection_en.json&amp;name=Alone&amp;url=worlds/tutorial_en/harvest3.json&amp;editor=python/harvest1_class_ex1.py</a> </p>
<p>而必須要在每一個座標點留下或放入一個紅蘿蔔: <a href="https://mde.tw/cp2025/reeborg/?lang=en&amp;mode=python&amp;menu=worlds/menus/select_collection_en.json&amp;name=Alone&amp;url=worlds/tutorial_en/harvest3.json&amp;editor=python/harvest1_class_ex3.py">https://mde.tw/cp2025/reeborg/?lang=en&amp;mode=python&amp;menu=worlds/menus/select_collection_en.json&amp;name=Alone&amp;url=worlds/tutorial_en/harvest3.json&amp;editor=python/harvest1_class_ex3.py </a> </p>
<h3>Otto_ninja</h3>
<p><a href="https://www.printables.com/model/231580-otto-ninja-starter-robot/files">https://www.printables.com/model/231580-otto-ninja-starter-robot/files</a> </p>
<p><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="allowfullscreen" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/NDIwhuxQPN8?si=ED_FAObUkAVFT5L-" title="YouTube video player" width="560"></iframe></p>
<h2>Pyodide</h2>
<p><a href="https://pyodide.org">Pyodide</a> 是一個將 <a href="https://en.wikipedia.org/wiki/Python_(programming_language)">Python</a> 解譯器和常用科學套件 (例如: <a href="https://numpy.org/">numpy</a>、<a href="https://scipy.org/">scipy</a>、<a href="https://matplotlib.org/">matplotlib</a> 等) 編譯成 <a href="https://webassembly.org/">WebAssembly</a>，可在瀏覽器中執行 <a href="https://en.wikipedia.org/wiki/Python_(programming_language)">Python</a> 程式的專案。</p>
<p><a href="https://pyodide.org">Pyodide</a> 是將 <a href="https://github.com/python/cpython">CPython</a> 編譯為 <a href="https://webassembly.org/">WebAssembly</a>，可在瀏覽器或其他 <a href="https://webassembly.org/">WebAssembly</a> 環境中執行；而 <a href="https://github.com/python/cpython">CPython</a> 是標準的原生 <a href="https://en.wikipedia.org/wiki/Python_(programming_language)">Python</a> 解譯器，運行在作業系統上。換言之，<a href="https://pyodide.org">Pyodide</a> 是為在瀏覽器中執行 <a href="https://en.wikipedia.org/wiki/Python_(programming_language)">Python</a> 而設計的 <a href="https://github.com/python/cpython">CPython</a> 移植版本。<a href="https://pyodide.org">Pyodide</a> 可與 <a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript">JavaScript</a> 雙向互動，讓 <a href="https://en.wikipedia.org/wiki/Python_(programming_language)">Python</a> 程式能呼叫 <a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript">JavaScript</a> 函數並操作網頁元素，也能被 <a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript">JavaScript</a> 呼叫執行 <a href="https://en.wikipedia.org/wiki/Python_(programming_language)">Python</a> 程式碼。</p>
<p>
<script src="https://cdn.jsdelivr.net/pyodide/v0.26.4/full/pyodide.js"></script>
</p>
<p><button id="version">version</button> <button id="hello_button">hello</button> <button id="add1to100">1 add to 100</button> <button id="robot1">機器人巡邏</button><button id="free_walk">自由行</button> <button id="numpy_ode">numpy_ode</button></p>
<!-- Ace Editor Scripts -->
<p>
<script src="/static/ace/FileSaver.min.js"></script>
<script src="/static/ace/filereader.js"></script>
<script src="/static/ace/ace.js"></script>
<script src="/static/ace/ext-language_tools.js"></script>
<script src="/static/ace/mode-python.js"></script>
<script src="/static/ace/snippets/python.js"></script>
</p>
<!-- Editor 1 -->
<div id="kw_editor1" style="width: 600px; height: 300px;"></div>
<p><button id="kw_run1">Run</button> <button id="kw_output1">Output</button> <button id="kw_clear_console1">清除輸出區</button> <button onclick="location.reload()">Reload</button></p>
<p><textarea id="kw_console1"></textarea></p>
<div id="pyodide_div1"></div>
<div id="mpl_output1"></div>
<div id="brython_div1"></div>
<hr/>
<p>從 1 累加到 100 part2:</p>
<p><button id="add1to100part2">1 add to 100</button></p>
<!-- Editor 2 -->
<div id="kw_editor2" style="width: 600px; height: 300px;"></div>
<p><button id="kw_run2">Run</button> <button id="kw_output2">Output</button> <button id="kw_clear_console2">清除輸出區</button> <button onclick="location.reload()">Reload</button></p>
<p><textarea id="kw_console2"></textarea></p>
<div id="pyodide_div2"></div>
<div id="mpl_output2"></div>
<div id="brython_div2"></div>
<p>
<script>
function getUrlParam(key) {
  return new URLSearchParams(window.location.search).get(key);
}
function updateUrlParam(key, value) {
  const url = new URL(window.location);
  url.searchParams.set(key, value);
  window.history.replaceState({}, "", url);
}

let pyodide, editor1, editor2;

document.addEventListener("DOMContentLoaded", async () => {
  editor1 = ace.edit("kw_editor1");
  editor1.setTheme("ace/theme/chrome");
  editor1.session.setMode("ace/mode/python");

  editor2 = ace.edit("kw_editor2");
  editor2.setTheme("ace/theme/chrome");
  editor2.session.setMode("ace/mode/python");

  pyodide = await loadPyodide();
  await pyodide.loadPackage(["numpy", "scipy", "matplotlib", "micropip"]);

  // 定義 hello() 模組
  const code = `
def hello():
    print("Hello from custom module!")
`;
  pyodide.runPython(code);

  const GIST_ADD1TO100 =
    "https://gist.githubusercontent.com/mdecourse/0229a8a017091476a79700b8a190f185/raw/" +
    "c48e37714f055c3a0027cbfef59e442a6ef659b9/from_1_add_to_100_1.py";
  const NUMPY_ODE =
    "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/" +
    "98d582539545b3c9fbfa35dd3e605c506367618e/pyodide_ode_ex1.py";
  const PYODIDE_ROBOT_ANIMATION =
    "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/" +
    "f3d75d08f2b90f4470342e91ee1e5c36b5f950bf/pyodide_robot_ex1.py";
  const FREE_WALK = 
    "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/" + "d1659628afe5d36a026ef305dc639f6be4c9f608/pyodide_robot_ex3.py"

  const src = getUrlParam("src");
  if (src === PYODIDE_ROBOT_ANIMATION) {
    const robotCode = await fetchCode(PYODIDE_ROBOT_ANIMATION);
    editor1.setValue(robotCode, -1);
    updateUrlParam("src", PYODIDE_ROBOT_ANIMATION);
    runPyodide(editor1, "kw_console1", "brython_div1");
  } else {
    const initialCode = await fetchCode(src || GIST_ADD1TO100);
    editor1.setValue(initialCode, -1);
    runPyodide(editor1, "kw_console1", "brython_div1");
  }

  editor2.setValue("", -1);

  document.getElementById("version").onclick = () => {
    const vcode = `
import pyodide
import sys
import matplotlib
import numpy
import scipy
print("Pyodide version:", pyodide.__version__)
print("Python version :", sys.version)
print("matplotlib version:", matplotlib.__version__)
print("numpy version:", numpy.__version__)
print("scipy version:", scipy.__version__)
`;
    editor1.setValue(vcode, -1);
    updateUrlParam("src", "inline_version");
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("hello_button").onclick = () => {
    editor1.setValue("hello()", -1);
    updateUrlParam("src", "inline_hello");
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("add1to100").onclick = async () => {
    const c = await fetchCode(GIST_ADD1TO100);
    editor1.setValue(c, -1);
    updateUrlParam("src", GIST_ADD1TO100);
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("numpy_ode").onclick = async () => {
    const c = await fetchCode(NUMPY_ODE);
    editor1.setValue(c, -1);
    updateUrlParam("src", NUMPY_ODE);
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("robot1").onclick = async () => {
    const rc = await fetchCode(PYODIDE_ROBOT_ANIMATION);
    editor1.setValue(rc, -1);
    updateUrlParam("src", PYODIDE_ROBOT_ANIMATION);
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("free_walk").onclick = async () => {
    const rc = await fetchCode(FREE_WALK);
    editor1.setValue(rc, -1);
    updateUrlParam("src", FREE_WALK);
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("add1to100part2").onclick = async () => {
    const c = await fetchCode(GIST_ADD1TO100);
    editor2.setValue(c, -1);
    runPyodide(editor2, "kw_console2", "brython_div2");
  };

  document.getElementById("kw_run1").onclick = () =>
    runPyodide(editor1, "kw_console1", "brython_div1");
  document.getElementById("kw_run2").onclick = () =>
    runPyodide(editor2, "kw_console2", "brython_div2");
  document.getElementById("kw_clear_console1").onclick = () =>
    clearOutput("kw_console1", "brython_div1");
  document.getElementById("kw_clear_console2").onclick = () =>
    clearOutput("kw_console2", "brython_div2");
});

// 處理兩個 Output 列數
  document.getElementById("kw_output1").onclick = () => {
    const ta = document.getElementById("kw_console1");
    ta.rows = "15";
    ta.cols = "70";
    ta.scrollTop = 0;
  };
  document.getElementById("kw_output2").onclick = () => {
    const ta = document.getElementById("kw_console2");
    ta.rows = "15";
    ta.cols = "70";
    ta.scrollTop = 0;
  };

async function fetchCode(url) {
  const r = await fetch(url);
  if (!r.ok) throw new Error(`載入失敗 ${r.status}`);
  return await r.text();
}

function clearOutput(consoleId, divId) {
  document.getElementById(consoleId).value = "";
  document.getElementById(divId).innerHTML = "";
}

async function runPyodide(editor, consoleId, divId) {
  document.getElementById(consoleId).value = "";
  document.getElementById(divId).innerHTML = "";

  await pyodide.runPythonAsync(`
import sys
class JsWriter:
  def write(self, s):
    from js import document
    ta = document.getElementById("${consoleId}")
    ta.value += s
    ta.scrollTop = ta.scrollHeight
sys.stdout = JsWriter()
sys.stderr = JsWriter()
`);

  try {
    await pyodide.runPythonAsync(editor.getValue());
  } catch (e) {
    document.getElementById(consoleId).value += "\n錯誤：" + e.toString();
  }
}
</script>
</p>
<h2>Pyodide_ex</h2>
<p><a href="https://mde.tw/cp2025/content/Pyodide.html?src=https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/f3d75d08f2b90f4470342e91ee1e5c36b5f950bf/pyodide_robot_ex1.py">Pyodide 機器人巡邏</a> - 由於網頁載入場景圍牆與 Pyodide 執行機器人行走模擬的速度差異，機器人巡邏畫面的圍牆無法及時顯示。</p>
<p>經過場景圍牆多次 (目前為 3 次) 載入 (必須配合瀏覽器 Client 端執行速度與網路傳輸速度進行調整)，<a href="https://mde.tw/cp2025/content/Pyodide.html?src=https%3A%2F%2Fgist.githubusercontent.com%2Fmdecycu%2Fec4bb35dd0769e7a83d2a9fa57878a67%2Fraw%2Ff3d75d08f2b90f4470342e91ee1e5c36b5f950bf%2Fpyodide_robot_ex1.py">Pyodide 機器人巡邏2</a> 可以正確載入圍牆圖檔。</p>
<p>Pyodide 導入客製化模組:</p>
<pre class="brush:js;auto-links:false;toolbar:false" contenteditable="false">const code = `
# 定義一個模組內容
def hello():
    print("Hello from custom module!")
`;
pyodide.runPython(code);
</pre>
<p><a href="https://mde.tw/cp2025/content/Pyodide.html?src=https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/3ed6869dcd7312254513ca507de17945e15a9b6f/box_max_volume_short.py">Volume_max_pyodide_de_short.py</a></p>
<p><a href="https://mde.tw/cp2025/content/Pyodide.html?src=https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/3ed6869dcd7312254513ca507de17945e15a9b6f/box_volume_max_pyodide_de.py">Volume_max_pyodide_de.py</a></p>
<p></p>
<h2>Pyodide2</h2>
<p>Pyodide2 在頁面中導入 <a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/ff833d14181c7e270d37432aa8589f5ecf00e383/robot.py">robot.py</a> (註解版: <a href="/downloads/pyodide_robot_commented.py">pyodide_robot_commented.py</a>) 後，可以直接在頁面編輯器中，直接利用 walk() 與 turn_left() 兩個方法，引導<a href="https://mde.tw/cp2025/content/Pyodide2.html?src=https%3A%2F%2Fgist.githubusercontent.com%2Fmdecycu%2Fec4bb35dd0769e7a83d2a9fa57878a67%2Fraw%2Fff833d14181c7e270d37432aa8589f5ecf00e383%2Fpyodide_walk_around2.py">機器人前行與左轉</a>。也可以在編輯器中自行<a href="https://mde.tw/cp2025/content/Pyodide2.html?src=https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/8ac3ce859d6aec327b7859e091168270d6a951f7/pyodide2_turn_right.py">定義右轉方法</a>，賦予機器人更多功能。</p>
<p>
<script src="https://cdn.jsdelivr.net/pyodide/v0.26.4/full/pyodide.js"></script>
</p>
<p><button id="version">version</button> <button id="hello_button">hello</button> <button id="add1to100">1 add to 100</button> <button id="robot1">機器人巡邏</button> <button id="free_walk">自由行</button> <button id="numpy_ode">numpy_ode</button></p>
<!-- Ace Editor Scripts -->
<p>
<script src="/static/ace/FileSaver.min.js"></script>
<script src="/static/ace/filereader.js"></script>
<script src="/static/ace/ace.js"></script>
<script src="/static/ace/ext-language_tools.js"></script>
<script src="/static/ace/mode-python.js"></script>
<script src="/static/ace/snippets/python.js"></script>
</p>
<!-- Editor 1 -->
<div id="kw_editor1" style="width: 600px; height: 300px;"></div>
<p><button id="kw_run1">Run</button> <button id="kw_output1">Output</button> <button id="kw_clear_console1">清除輸出區</button> <button onclick="location.reload()">Reload</button></p>
<p><textarea id="kw_console1"></textarea></p>
<div id="pyodide_div1"></div>
<div id="mpl_output1"></div>
<div id="brython_div1"></div>
<hr/>
<p>從 1 累加到 100 part2:</p>
<p><button id="add1to100part2">1 add to 100</button></p>
<!-- Editor 2 -->
<div id="kw_editor2" style="width: 600px; height: 300px;"></div>
<p><button id="kw_run2">Run</button> <button id="kw_output2">Output</button> <button id="kw_clear_console2">清除輸出區</button> <button onclick="location.reload()">Reload</button></p>
<p><textarea id="kw_console2"></textarea></p>
<div id="pyodide_div2"></div>
<div id="mpl_output2"></div>
<div id="brython_div2"></div>
<p>
<script>
function getUrlParam(key) {
  return new URLSearchParams(window.location.search).get(key);
}
function updateUrlParam(key, value) {
  const url = new URL(window.location);
  url.searchParams.set(key, value);
  window.history.replaceState({}, "", url);
}

let pyodide, editor1, editor2;

// 新增：把 robot.py 寫入 pyodide FS
async function loadRobotModule() {
  const robotUrl = "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/4b94533a86b41ed8905cbb2d2bcae4e21a3e7410/robot.py";
  const r = await fetch(robotUrl);
  if (!r.ok) throw new Error(`載入 robot.py 失敗: ${r.status}`);
  const code = await r.text();
  pyodide.FS.writeFile("/robot.py", code);
  pyodide.runPython(`import sys; sys.path.append("/")`);  // 加入根目錄到 sys.path
}

document.addEventListener("DOMContentLoaded", async () => {
  editor1 = ace.edit("kw_editor1");
  editor1.setTheme("ace/theme/chrome");
  editor1.session.setMode("ace/mode/python");

  editor2 = ace.edit("kw_editor2");
  editor2.setTheme("ace/theme/chrome");
  editor2.session.setMode("ace/mode/python");

  pyodide = await loadPyodide();
  await pyodide.loadPackage(["numpy", "scipy", "matplotlib", "micropip"]);

  // 預先載入 robot.py
  await loadRobotModule();

  // 你現有的 hello() 定義
  const code = `
def hello():
    print("Hello from custom module!")
`;
  pyodide.runPython(code);

  // 這是你之前其他按鈕用的 Gist 連結
  const GIST_ADD1TO100 =
    "https://gist.githubusercontent.com/mdecourse/0229a8a017091476a79700b8a190f185/raw/" +
    "c48e37714f055c3a0027cbfef59e442a6ef659b9/from_1_add_to_100_1.py";
  const NUMPY_ODE =
    "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/" +
    "98d582539545b3c9fbfa35dd3e605c506367618e/pyodide_ode_ex1.py";
  const PYODIDE_ROBOT_ANIMATION =
    "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/" +
    "ff833d14181c7e270d37432aa8589f5ecf00e383/pyodide_walk_around2.py";
  const FREE_WALK = 
    "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/" + "2a66dceb4a1dbdd0c384d4d17453f1e4f03f2493/pyodide_free_walk2.py"

  // 預設載入 GIST_ADD1TO100（或 URL 參數決定）
  const src = getUrlParam("src");
  if (src === PYODIDE_ROBOT_ANIMATION) {
    const robotCode = await fetchCode(PYODIDE_ROBOT_ANIMATION);
    editor1.setValue(robotCode, -1);
    updateUrlParam("src", PYODIDE_ROBOT_ANIMATION);
    runPyodide(editor1, "kw_console1", "brython_div1");
  } else {
    const initialCode = await fetchCode(src || GIST_ADD1TO100);
    editor1.setValue(initialCode, -1);
    runPyodide(editor1, "kw_console1", "brython_div1");
  }

  editor2.setValue("", -1);

  // 按鈕事件
  document.getElementById("version").onclick = () => {
    const vcode = `
import pyodide
import sys
import matplotlib
import numpy
import scipy
print("Pyodide version:", pyodide.__version__)
print("Python version :", sys.version)
print("matplotlib version:", matplotlib.__version__)
print("numpy version:", numpy.__version__)
print("scipy version:", scipy.__version__)
`;
    editor1.setValue(vcode, -1);
    updateUrlParam("src", "inline_version");
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("hello_button").onclick = () => {
    editor1.setValue("hello()", -1);
    updateUrlParam("src", "inline_hello");
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("add1to100").onclick = async () => {
    const c = await fetchCode(GIST_ADD1TO100);
    editor1.setValue(c, -1);
    updateUrlParam("src", GIST_ADD1TO100);
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("numpy_ode").onclick = async () => {
    const c = await fetchCode(NUMPY_ODE);
    editor1.setValue(c, -1);
    updateUrlParam("src", NUMPY_ODE);
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("robot1").onclick = async () => {
    const rc = await fetchCode(PYODIDE_ROBOT_ANIMATION);
    editor1.setValue(rc, -1);
    updateUrlParam("src", PYODIDE_ROBOT_ANIMATION);
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("free_walk").onclick = async () => {
    const rc = await fetchCode(FREE_WALK);
    editor1.setValue(rc, -1);
    updateUrlParam("src", FREE_WALK);
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("add1to100part2").onclick = async () => {
    const c = await fetchCode(GIST_ADD1TO100);
    editor2.setValue(c, -1);
    runPyodide(editor2, "kw_console2", "brython_div2");
  };

  document.getElementById("kw_run1").onclick = () =>
    runPyodide(editor1, "kw_console1", "brython_div1");
  document.getElementById("kw_run2").onclick = () =>
    runPyodide(editor2, "kw_console2", "brython_div2");
  document.getElementById("kw_clear_console1").onclick = () =>
    clearOutput("kw_console1", "brython_div1");
  document.getElementById("kw_clear_console2").onclick = () =>
    clearOutput("kw_console2", "brython_div2");
});

// 調整 output textarea 行數
document.getElementById("kw_output1").onclick = () => {
  const ta = document.getElementById("kw_console1");
  ta.rows = "15";
  ta.cols = "70";
  ta.scrollTop = 0;
};
document.getElementById("kw_output2").onclick = () => {
  const ta = document.getElementById("kw_console2");
  ta.rows = "15";
  ta.cols = "70";
  ta.scrollTop = 0;
};

async function fetchCode(url) {
  const r = await fetch(url);
  if (!r.ok) throw new Error(`載入失敗 ${r.status}`);
  return await r.text();
}

function clearOutput(consoleId, divId) {
  document.getElementById(consoleId).value = "";
  document.getElementById(divId).innerHTML = "";
}

async function runPyodide(editor, consoleId, divId) {
  document.getElementById(consoleId).value = "";
  document.getElementById(divId).innerHTML = "";

  await pyodide.runPythonAsync(`
import sys
class JsWriter:
  def write(self, s):
    from js import document
    ta = document.getElementById("${consoleId}")
    ta.value += s
    ta.scrollTop = ta.scrollHeight
sys.stdout = JsWriter()
sys.stderr = JsWriter()
`);

  try {
    await pyodide.runPythonAsync(editor.getValue());
  } catch (e) {
    document.getElementById(consoleId).value += "\\n錯誤：" + e.toString();
  }
}
</script>
</p>
<h3>robot.py</h3>
<p><a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/ff833d14181c7e270d37432aa8589f5ecf00e383/robot.py">robot.py</a></p>
<p>第一段：模組匯入與常數定義</p>
<p>js 是 Brython 提供的 JS-Python 橋接模組，可直接操作 JavaScript DOM。<br/><br/>asyncio 是 Python 的非同步處理模組，用來讓動畫非同步進行。<br/><br/>CELL_SIZE 設定地圖中每個格子的大小（40px × 40px）。<br/><br/>WALL_THICKNESS 是用於繪製牆壁的線條厚度。<br/><br/>IMG_PATH 是儲存所有圖片的伺服器路徑（用於載入牆壁與機器人圖）。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">import js, asyncio

# 每個格子的像素寬度
CELL_SIZE = 40

# 牆壁的厚度（像素）
WALL_THICKNESS = 6

# 圖片資源的網址前綴
IMG_PATH = "https://mde.tw/cp2025/reeborg/src/images/"
</pre>
<p>第二段：World 類別 – 建立世界與地圖圖層</p>
<p>World 類負責建立整個地圖畫面，並初始化所需的畫布圖層。<br/><br/>_image_cache 是類別層級變數，用來快取圖片物件。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">class World:
    _image_cache = {}  # 用來暫存載入過的圖片，避免重複下載

    def __init__(self, width, height):
        self.width = width     # 地圖寬（幾格）
        self.height = height   # 地圖高（幾格）
        self.layers = self._create_layers()  # 建立四個 canvas 圖層
        self._init_html()      # 將圖層與控制按鈕加到 HTML 畫面
</pre>
<p>第三段：建立圖層</p>
<p>這些圖層都是 canvas 元素，彼此重疊在一起，依序繪製地圖。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    def _create_layers(self):
        return {
            "grid": js.document.createElement("canvas"),    # 網格底圖
            "walls": js.document.createElement("canvas"),   # 牆壁
            "objects": js.document.createElement("canvas"), # 痕跡/物件
            "robots": js.document.createElement("canvas"),  # 機器人
        }
</pre>
<p>第四段：初始化 HTML 結構</p>
<p>建立一個 container 容器，設定為相對定位。<br/><br/>將四層 canvas 疊放進容器中，每層用不同的 zIndex 疊層排序。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    def _init_html(self):
        container = js.document.createElement("div")
        container.style.position = "relative"
        container.style.width = f"{self.width * CELL_SIZE}px"
        container.style.height = f"{self.height * CELL_SIZE}px"

        for z, canvas in enumerate(self.layers.values()):
            canvas.width = self.width * CELL_SIZE
            canvas.height = self.height * CELL_SIZE
            canvas.style.position = "absolute"
            canvas.style.top = "0px"
            canvas.style.left = "0px"
            canvas.style.zIndex = str(z)
            container.appendChild(canvas)
</pre>
<p>第五段：建立控制按鈕並加入畫面</p>
<p>建立兩個按鈕：「前進」與「左轉」。<br/><br/>設定美觀的樣式（內邊距、字體大小等）。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">        button_container = js.document.createElement("div")
        button_container.style.marginTop = "10px"
        button_container.style.textAlign = "center"

        move_button = js.document.createElement("button")
        move_button.innerHTML = "Move Forward"
        move_button.style.margin = "5px"
        move_button.style.padding = "10px 20px"
        move_button.style.fontSize = "16px"
        button_container.appendChild(move_button)

        turn_button = js.document.createElement("button")
        turn_button.innerHTML = "Turn Left"
        turn_button.style.margin = "5px"
        turn_button.style.padding = "10px 20px"
        turn_button.style.fontSize = "16px"
        button_container.appendChild(turn_button)
</pre>
<p> 第六段：掛載進 HTML 與按鈕綁定</p>
<p>將畫面掛載到 HTML 中的 brython_div1 元素內。<br/><br/>同時記錄兩個按鈕到 self.move_button、self.turn_button 屬性，以便之後綁定事件</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">        brython_div = js.document.getElementById("brython_div1")
        if not brython_div:
            raise RuntimeError("🚨 'brython_div1' element not found in HTML!")
        brython_div.innerHTML = ""
        brython_div.appendChild(container)
        brython_div.appendChild(button_container)

        self.move_button = move_button
        self.turn_button = turn_button
</pre>
<p>第七段：繪製地圖網格線（grid）</p>
<p>這段程式會畫出地圖的格線，形成棋盤狀的網格。<br/><br/>每格大小為 CELL_SIZE = 40 像素。<br/><br/>格線只是視覺輔助，沒有碰撞作用。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    def _draw_grid(self):
        ctx = self.layers["grid"].getContext("2d")  # 取得網格圖層的繪圖上下文
        ctx.strokeStyle = "#cccccc"  # 設定線條顏色為淡灰色

        # 垂直線（每列格線）
        for i in range(self.width + 1):
            ctx.beginPath()
            ctx.moveTo(i * CELL_SIZE, 0)
            ctx.lineTo(i * CELL_SIZE, self.height * CELL_SIZE)
            ctx.stroke()

        # 水平線（每欄格線）
        for j in range(self.height + 1):
            ctx.beginPath()
            ctx.moveTo(0, j * CELL_SIZE)
            ctx.lineTo(self.width * CELL_SIZE, j * CELL_SIZE)
            ctx.stroke()
</pre>
<p>第八段：通用繪圖函式 _draw_image()</p>
<p>此函式負責畫圖片在指定格子位置。<br/><br/>需要傳入：<br/><br/>    ctx: 要繪製的畫布上下文。<br/><br/>    img_key: 要畫的圖片鍵（例如 "blue_robot_e"）。<br/><br/>    (x, y): 要畫在哪個格子（以地圖邏輯座標為主）。<br/><br/>    (w, h): 圖片的寬與高。<br/><br/>會自動調整畫面位置，將 y 軸上下反轉，使原點在左下角。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    def _draw_image(self, ctx, img_key, x, y, w, h, offset_x=0, offset_y=0):
        img = World._image_cache.get(img_key)
        if img and img.complete and img.naturalWidth &gt; 0:
            px = x * CELL_SIZE + offset_x
            py = (self.height - 1 - y) * CELL_SIZE + offset_y
            ctx.drawImage(img, px, py, w, h)
            return True
        else:
            print(f"⚠️ Image '{img_key}' not ready for drawing.")
            return False
</pre>
<p>第九段：繪製牆壁 _draw_walls()</p>
<p>這段會將四周的「邊界牆」畫出來。<br/><br/>利用 _draw_image 畫出 north.png 與 east.png。<br/><br/>offset_x / offset_y 用來對齊圖片位置（不會蓋到格子內）。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    async def _draw_walls(self):
        ctx = self.layers["walls"].getContext("2d")
        ctx.clearRect(0, 0, self.width * CELL_SIZE, self.height * CELL_SIZE)
        success = True

        # 繪製上下兩排的北牆（頂部與底部）
        for x in range(self.width):
            success &amp;= self._draw_image(ctx, "north", x, self.height - 1, CELL_SIZE, WALL_THICKNESS, offset_y=0)
            success &amp;= self._draw_image(ctx, "north", x, 0, CELL_SIZE, WALL_THICKNESS, offset_y=CELL_SIZE - WALL_THICKNESS)

        # 繪製左右兩側的東牆（左邊與右邊）
        for y in range(self.height):
            success &amp;= self._draw_image(ctx, "east", 0, y, WALL_THICKNESS, CELL_SIZE, offset_x=0)
            success &amp;= self._draw_image(ctx, "east", self.width - 1, y, WALL_THICKNESS, CELL_SIZE, offset_x=CELL_SIZE - WALL_THICKNESS)

        return success
</pre>
<p>第十段：預先載入圖片 _preload_images()</p>
<p>此函式會載入所有需要用到的圖片（牆壁與機器人朝向圖）。<br/><br/>利用 Promise 建立圖片載入完成的非同步事件，確保載入成功。<br/><br/>透過 await js.await_promise(js.Promise.all(...)) 等待所有圖片載入完畢。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    async def _preload_images(self):
        image_files = {
            "blue_robot_e": "blue_robot_e.png",
            "blue_robot_n": "blue_robot_n.png",
            "blue_robot_w": "blue_robot_w.png",
            "blue_robot_s": "blue_robot_s.png",
            "north": "north.png",
            "east": "east.png",
        }

        promises = []
        for key, filename in image_files.items():
            if key in World._image_cache and World._image_cache[key].complete:
                continue

            img = js.document.createElement("img")
            img.crossOrigin = "Anonymous"
            img.src = IMG_PATH + filename
            World._image_cache[key] = img

            def make_promise(img_element):
                def executor(resolve, reject):
                    def on_load(event):
                        img_element.removeEventListener("load", on_load)
                        img_element.removeEventListener("error", on_error)
                        resolve(img_element)
                    def on_error(event):
                        img_element.removeEventListener("load", on_load)
                        img_element.removeEventListener("error", on_error)
                        reject(f"Failed to load image: {img_element.src}")
                    img_element.addEventListener("load", on_load)
                    img_element.addEventListener("error", on_error)
                    if img_element.complete and img_element.naturalWidth &gt; 0:
                        resolve(img_element)
                return js.Promise.new(executor)

            promises.append(make_promise(img))

        if not promises:
            return True
        try:
            await js.await_promise(js.Promise.all(promises))
            return True
        except Exception as e:
            print(f"🚨 Error during image preloading: {str(e)}")
            return False
</pre>
<p>第十一段：初始化地圖與資源 setup()</p>
<p>setup() 是建構完世界後必須呼叫的初始化函式。<br/><br/>包含資源載入、地圖格線與牆壁的繪製。<br/><br/>使用 asyncio.sleep(0) 是一種「讓出主控權給瀏覽器」的技巧，避免卡住畫面。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    async def setup(self):
        # 嘗試三次載入圖片資源，若載入成功則跳出迴圈
        for _ in range(3):
            if await self._preload_images():
                break
            await asyncio.sleep(0.5)  # 等待 0.5 秒後再試
        else:
            print("🚨 Failed to preload images after retries.")
            return False

        await asyncio.sleep(0)  # 放棄當前事件迴圈執行權，確保 UI 有機會更新

        self._draw_grid()  # 繪製底層的網格

        # 嘗試三次繪製牆壁，等待圖片載入完成
        for _ in range(3):
            if await self._draw_walls():
                break
            await asyncio.sleep(0.5)
        else:
            print("🚨 Failed to draw walls after retries.")
            return False

        # 最後確認機器人朝向東的圖片是否可用
        robot_img_key = "blue_robot_e"
        if not (World._image_cache.get(robot_img_key) and World._image_cache[robot_img_key].complete):
            print(f"🚨 Robot image '{robot_img_key}' still not ready after setup!")
            return False

        return True  # 所有步驟成功後回傳 True
</pre>
<p>第十二段：機器人類別 Robot</p>
<p>每個 Robot 物件都有座標與面向，並能畫出自己與移動的軌跡。<br/><br/>傳入 world 是為了能取得地圖的畫布資訊。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">class Robot:
    def __init__(self, world, x, y):
        self.world = world
        self.x = x - 1  # 將人類習慣的 1-index 轉成 0-index
        self.y = y - 1
        self.facing = "E"  # 預設朝東（右邊）
        self._facing_order = ["E", "N", "W", "S"]  # 左轉時的順序

        self.robot_ctx = world.layers["robots"].getContext("2d")   # 機器人圖層
        self.trace_ctx = world.layers["objects"].getContext("2d")  # 移動軌跡圖層

        self._draw_robot()  # 初始畫上機器人
</pre>
<p>_robot_image_key()：依面向回傳圖片鍵</p>
<p>根據面向回傳對應的圖片鍵，例如 <code data-end="1939" data-start="1936">E</code> 會回傳 <code data-end="1960" data-start="1944">"blue_robot_e"</code>。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    def _robot_image_key(self):
        return f"blue_robot_{self.facing.lower()}"
</pre>
<p>_draw_robot()：畫出機器人圖像</p>
<p>先清除原圖，避免留下殘影，再畫上新的機器人圖像。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    def _draw_robot(self):
        self.robot_ctx.clearRect(0, 0, self.world.width * CELL_SIZE, self.world.height * CELL_SIZE)
        self.world._draw_image(self.robot_ctx, self._robot_image_key(), self.x, self.y, CELL_SIZE, CELL_SIZE)
</pre>
<p>_draw_trace()：畫出移動路徑</p>
<p>此方法畫出機器人從起點到終點的直線軌跡。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    def _draw_trace(self, from_x, from_y, to_x, to_y):
        ctx = self.trace_ctx
        ctx.strokeStyle = "#d33"  # 紅色線條
        ctx.lineWidth = 2
        ctx.beginPath()
        fx = from_x * CELL_SIZE + CELL_SIZE / 2
        fy = (self.world.height - 1 - from_y) * CELL_SIZE + CELL_SIZE / 2
        tx = to_x * CELL_SIZE + CELL_SIZE / 2
        ty = (self.world.height - 1 - to_y) * CELL_SIZE + CELL_SIZE / 2
        ctx.moveTo(fx, fy)
        ctx.lineTo(tx, ty)
        ctx.stroke()
</pre>
<p>第十三段：機器人行走與轉彎</p>
<p>walk(steps)：前進</p>
<p>根據面向方向更新位置，並畫出移動。<br/><br/>超出地圖邊界時停止。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    async def walk(self, steps=1):
        for _ in range(steps):
            from_x, from_y = self.x, self.y
            dx, dy = 0, 0
            if self.facing == "E": dx = 1
            elif self.facing == "W": dx = -1
            elif self.facing == "N": dy = 1
            elif self.facing == "S": dy = -1

            next_x = self.x + dx
            next_y = self.y + dy

            if 0 &lt;= next_x &lt; self.world.width and 0 &lt;= next_y &lt; self.world.height:
                self.x, self.y = next_x, next_y
                self._draw_trace(from_x, from_y, self.x, self.y)
                self._draw_robot()
                await asyncio.sleep(0.2)
            else:
                print("🚨 Hit a wall, stop moving!")
                break
</pre>
<p>turn_left()：左轉</p>
<p>從目前面向向左轉一格，更新圖片。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    async def turn_left(self):
        idx = self._facing_order.index(self.facing)
        self.facing = self._facing_order[(idx + 1) % 4]  # 循環轉向
        self._draw_robot()
        await asyncio.sleep(0.3)
</pre>
<p>第十四段：綁定控制 _bind_controls(robot)</p>
<p>定義一個私有方法，將控制行為綁定給特定 robot 實例。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">def _bind_controls(robot: Robot):
</pre>
<p>鍵盤控制</p>
<p>設定 j → 前進，i → 左轉。<br/><br/>使用 asyncio.create_task() 以非同步方式執行，避免卡住主執行緒。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    def handle_key(event):
        try:
            if event.key == 'j':
                asyncio.create_task(robot.walk(1))     # 按下 j 移動一步
            elif event.key == 'i':
                asyncio.create_task(robot.turn_left()) # 按下 i 左轉
        except Exception as e:
            print(f"🚨 Error in key handler: {e}")
</pre>
<p>按鈕點擊控制</p>
<p>這兩個函式綁定到 UI 裡的按鈕（前面 _init_html() 中定義的）。<br/><br/>功能與鍵盤控制一樣，只是透過滑鼠點擊。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    def handle_move_button(event):
        try:
            asyncio.create_task(robot.walk(1))
        except Exception as e:
            print(f"🚨 Error in move button handler: {e}")

    def handle_turn_button(event):
        try:
            asyncio.create_task(robot.turn_left())
        except Exception as e:
            print(f"🚨 Error in turn button handler: {e}")
</pre>
<p>註冊事件到 JavaScript</p>
<p>將 handle_key() 註冊為全域 py_handle_key，讓 JavaScript 層級可以呼叫 Python。</p>
<p>將按鈕的點擊事件對應到 Python 定義的控制函式。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    js.window.py_handle_key = handle_key
    js.document.addEventListener('keydown', js.Function("event", "py_handle_key(event);"))
    js.window.py_handle_move_button = handle_move_button
    js.window.py_handle_turn_button = handle_turn_button
    robot.world.move_button.addEventListener('click', js.Function("event", "py_handle_move_button(event);"))
    robot.world.turn_button.addEventListener('click', js.Function("event", "py_handle_turn_button(event);"))</pre>
<p>第十五段：初始化並啟動 init()</p>
<p>提供一個使用者簡單快速初始化整個世界與機器人的介面。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">def init(world_width=10, world_height=10, robot_x=1, robot_y=1):
</pre>
<p>包裝為非同步任務</p>
<p>這個包裝函式 async def _inner() 是用來實作內部非同步邏輯。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    async def _inner():
        world = World(world_width, world_height)  # 建立世界
        if not await world.setup():               # 等待世界初始化完成
            raise RuntimeError("World setup failed!")  # 若失敗則丟出錯誤

        robot = Robot(world, robot_x, robot_y)    # 建立機器人
        _bind_controls(robot)                     # 綁定控制事件
        return world, robot                       # 傳回 world 和 robot 物件
</pre>
<p>建立並啟動非同步任務</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">    return asyncio.create_task(_inner())
</pre>
<p>回傳一個非同步任務（asyncio.Task），讓使用者可以這樣呼叫：</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">world, robot = await init(10, 10, 1, 1)
</pre>
<p>等待 init() 的結果後，就可以直接控制 robot.walk() 或 robot.turn_left()。</p>
<h3>Example2</h3>
<p>自行定義機器人右轉的非同步執行函式:</p>
<p><a href="https://mde.tw/cp2025/content/Pyodide2.html?src=https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/8ac3ce859d6aec327b7859e091168270d6a951f7/pyodide2_turn_right.py">執行 turn_right 程式</a>範例。</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">import robot
import asyncio

# 定義右轉的非同步函式
async def turn_right(bot):
    for _ in range(3):
        await bot.turn_left()

async def main():
    world, bot = await robot.init(10, 10, 1, 1)
    print("機器人開始行動")
    await bot.turn_left()
    await bot.walk(9)
    await turn_right(bot) 
    print("機器人完成行動")

# main() 讓出執行控制權，由頁面中的 even loop 決定何時執行 main()
await main()
</pre>
<h2>Pyodide3</h2>
<p>Pyodide3 則在 <a href="https://mde.tw/cp2025/content/Pyodide.html">Pyodide</a> 與 <a href="https://mde.tw/cp2025/content/Pyodide2.html">Pyodide2</a> 頁面架構下，進一步導入 <a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/9f43571ec070ea3e24b083525ee27275a96efcc8/robot_w_world.py">robot_w_world.py</a>，在既有的水平圍牆 <a href="https://mde.tw/cp2025/reeborg/src/images/north.png">north.png</a> 與垂直圍牆 <a href="https://mde.tw/cp2025/reeborg/src/images/east.png">east.png</a> 檔案之外，加入 <a href="https://mde.tw/cp2025/reeborg/src/images/carrot.png">carrot.png</a>、<a href="https://mde.tw/cp2025/reeborg/src/images/grass.png">grass.png</a> 與 <a href="https://mde.tw/cp2025/reeborg/src/images/pale_grass.png">pale_grass.png</a> 等圖檔。並且擴充可從 URL 讀進 json 格式的 world 變數功能，以便製作出更多元的場景任務，要求機器人執行。</p>
<p>其中 src URL 變數，可以將網路上的機器人控制程式導入 Pyodide3 頁面外，world URL 變數則可以導入源自 <a href="https://mde.tw/reeborg">Reeborg</a> 機器人程式所設定的 json 格式場景。</p>
<p>由於 Reeborg 系統中的 png 圖檔均非透明背景，<a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/9f43571ec070ea3e24b083525ee27275a96efcc8/robot_w_world.py">robot_w_world.py</a> 必須利用 HTML 中的 CANVAS，將關鍵的白色背景，以透明的方式顯示。</p>
<p>src URL 變數讀進 <a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/8ac3ce859d6aec327b7859e091168270d6a951f7/pyodide2_turn_right.py">turn_right 程式</a>，而 world URL 變數則讀進 <a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/43517f3f54a5ac24d55d5a5cf8d316e6db2f3b65/harvest2.json">harvest2.json</a>，執行<a href="https://mde.tw/cp2025/content/Pyodide3.html?src=https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/8ac3ce859d6aec327b7859e091168270d6a951f7/pyodide2_turn_right.py&amp;world=https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/43517f3f54a5ac24d55d5a5cf8d316e6db2f3b65/harvest2.json">結果</a>。</p>
<p>讀進 <a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/1b1c26eca7f5d772c6301bae865efaddb00a87bb/harvest3.json">harvest3.json</a>, 執行<a href="https://mde.tw/cp2025/content/Pyodide3.html?src=https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/8ac3ce859d6aec327b7859e091168270d6a951f7/pyodide2_turn_right.py&amp;world=https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/9f43571ec070ea3e24b083525ee27275a96efcc8/harvest3.json">結果</a>。</p>
<p>
<script src="https://cdn.jsdelivr.net/pyodide/v0.26.4/full/pyodide.js"></script>
</p>
<p><button id="version">version</button> <button id="hello_button">hello</button> <button id="add1to100">1 add to 100</button> <button id="robot1">機器人巡邏</button> <button id="free_walk">自由行</button> <button id="numpy_ode">numpy_ode</button></p>
<!-- Ace Editor Scripts -->
<p>
<script src="/static/ace/FileSaver.min.js"></script>
<script src="/static/ace/filereader.js"></script>
<script src="/static/ace/ace.js"></script>
<script src="/static/ace/ext-language_tools.js"></script>
<script src="/static/ace/mode-python.js"></script>
<script src="/static/ace/snippets/python.js"></script>
</p>
<!-- Editor 1 -->
<div id="kw_editor1" style="width: 600px; height: 300px;"></div>
<p><button id="kw_run1">Run</button> <button id="kw_output1">Output</button> <button id="kw_clear_console1">清除輸出區</button> <button onclick="location.reload()">Reload</button></p>
<p><textarea id="kw_console1"></textarea></p>
<div id="pyodide_div1"></div>
<div id="mpl_output1"></div>
<div id="brython_div1"></div>
<hr/>
<p>從 1 累加到 100 part2:</p>
<p><button id="add1to100part2">1 add to 100</button></p>
<!-- Editor 2 -->
<div id="kw_editor2" style="width: 600px; height: 300px;"></div>
<p><button id="kw_run2">Run</button> <button id="kw_output2">Output</button> <button id="kw_clear_console2">清除輸出區</button> <button onclick="location.reload()">Reload</button></p>
<p><textarea id="kw_console2"></textarea></p>
<div id="pyodide_div2"></div>
<div id="mpl_output2"></div>
<div id="brython_div2"></div>
<p>
<script>
function getUrlParam(key) {
  return new URLSearchParams(window.location.search).get(key);
}
function updateUrlParam(key, value) {
  const url = new URL(window.location);
  url.searchParams.set(key, value);
  window.history.replaceState({}, "", url);
}

let pyodide, editor1, editor2;

// 新增：把 robot_w_world.py 寫入 pyodide FS
async function loadRobotModule() {
  const robotUrl = "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/9f43571ec070ea3e24b083525ee27275a96efcc8/robot_w_world.py";
  const r = await fetch(robotUrl);
  if (!r.ok) throw new Error(`載入 robot.py 失敗: ${r.status}`);
  const code = await r.text();
  pyodide.FS.writeFile("/robot.py", code);
  pyodide.runPython(`import sys; sys.path.append("/")`);  // 加入根目錄到 sys.path
}

document.addEventListener("DOMContentLoaded", async () => {
  editor1 = ace.edit("kw_editor1");
  editor1.setTheme("ace/theme/chrome");
  editor1.session.setMode("ace/mode/python");

  editor2 = ace.edit("kw_editor2");
  editor2.setTheme("ace/theme/chrome");
  editor2.session.setMode("ace/mode/python");

  pyodide = await loadPyodide();
  await pyodide.loadPackage(["numpy", "scipy", "matplotlib", "micropip"]);

  // 預先載入 robot.py
  await loadRobotModule();

  // 你現有的 hello() 定義
  const code = `
def hello():
    print("Hello from custom module!")
`;
  pyodide.runPython(code);

  // 這是你之前其他按鈕用的 Gist 連結
  const GIST_ADD1TO100 =
    "https://gist.githubusercontent.com/mdecourse/0229a8a017091476a79700b8a190f185/raw/" +
    "c48e37714f055c3a0027cbfef59e442a6ef659b9/from_1_add_to_100_1.py";
  const NUMPY_ODE =
    "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/" +
    "98d582539545b3c9fbfa35dd3e605c506367618e/pyodide_ode_ex1.py";
  const PYODIDE_ROBOT_ANIMATION =
    "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/" +
    "ff833d14181c7e270d37432aa8589f5ecf00e383/pyodide_walk_around2.py";
  const FREE_WALK = 
    "https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/" + "2a66dceb4a1dbdd0c384d4d17453f1e4f03f2493/pyodide_free_walk2.py"

  // 預設載入 GIST_ADD1TO100（或 URL 參數決定）
  const src = getUrlParam("src");
  if (src === PYODIDE_ROBOT_ANIMATION) {
    const robotCode = await fetchCode(PYODIDE_ROBOT_ANIMATION);
    editor1.setValue(robotCode, -1);
    updateUrlParam("src", PYODIDE_ROBOT_ANIMATION);
    runPyodide(editor1, "kw_console1", "brython_div1");
  } else {
    const initialCode = await fetchCode(src || GIST_ADD1TO100);
    editor1.setValue(initialCode, -1);
    runPyodide(editor1, "kw_console1", "brython_div1");
  }

  editor2.setValue("", -1);

  // 按鈕事件
  document.getElementById("version").onclick = () => {
    const vcode = `
import pyodide
import sys
import matplotlib
import numpy
import scipy
print("Pyodide version:", pyodide.__version__)
print("Python version :", sys.version)
print("matplotlib version:", matplotlib.__version__)
print("numpy version:", numpy.__version__)
print("scipy version:", scipy.__version__)
`;
    editor1.setValue(vcode, -1);
    updateUrlParam("src", "inline_version");
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("hello_button").onclick = () => {
    editor1.setValue("hello()", -1);
    updateUrlParam("src", "inline_hello");
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("add1to100").onclick = async () => {
    const c = await fetchCode(GIST_ADD1TO100);
    editor1.setValue(c, -1);
    updateUrlParam("src", GIST_ADD1TO100);
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("numpy_ode").onclick = async () => {
    const c = await fetchCode(NUMPY_ODE);
    editor1.setValue(c, -1);
    updateUrlParam("src", NUMPY_ODE);
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("robot1").onclick = async () => {
    const rc = await fetchCode(PYODIDE_ROBOT_ANIMATION);
    editor1.setValue(rc, -1);
    updateUrlParam("src", PYODIDE_ROBOT_ANIMATION);
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("free_walk").onclick = async () => {
    const rc = await fetchCode(FREE_WALK);
    editor1.setValue(rc, -1);
    updateUrlParam("src", FREE_WALK);
    runPyodide(editor1, "kw_console1", "brython_div1");
  };

  document.getElementById("add1to100part2").onclick = async () => {
    const c = await fetchCode(GIST_ADD1TO100);
    editor2.setValue(c, -1);
    runPyodide(editor2, "kw_console2", "brython_div2");
  };

  document.getElementById("kw_run1").onclick = () =>
    runPyodide(editor1, "kw_console1", "brython_div1");
  document.getElementById("kw_run2").onclick = () =>
    runPyodide(editor2, "kw_console2", "brython_div2");
  document.getElementById("kw_clear_console1").onclick = () =>
    clearOutput("kw_console1", "brython_div1");
  document.getElementById("kw_clear_console2").onclick = () =>
    clearOutput("kw_console2", "brython_div2");
});

// 調整 output textarea 行數
document.getElementById("kw_output1").onclick = () => {
  const ta = document.getElementById("kw_console1");
  ta.rows = "15";
  ta.cols = "70";
  ta.scrollTop = 0;
};
document.getElementById("kw_output2").onclick = () => {
  const ta = document.getElementById("kw_console2");
  ta.rows = "15";
  ta.cols = "70";
  ta.scrollTop = 0;
};

async function fetchCode(url) {
  const r = await fetch(url);
  if (!r.ok) throw new Error(`載入失敗 ${r.status}`);
  return await r.text();
}

function clearOutput(consoleId, divId) {
  document.getElementById(consoleId).value = "";
  document.getElementById(divId).innerHTML = "";
}

async function runPyodide(editor, consoleId, divId) {
  document.getElementById(consoleId).value = "";
  document.getElementById(divId).innerHTML = "";

  await pyodide.runPythonAsync(`
import sys
class JsWriter:
  def write(self, s):
    from js import document
    ta = document.getElementById("${consoleId}")
    ta.value += s
    ta.scrollTop = ta.scrollHeight
sys.stdout = JsWriter()
sys.stderr = JsWriter()
`);

  try {
    await pyodide.runPythonAsync(editor.getValue());
  } catch (e) {
    document.getElementById(consoleId).value += "\\n錯誤：" + e.toString();
  }
}
</script>
</p>
<h3>png_files</h3>
<p>利用 <a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/9f43571ec070ea3e24b083525ee27275a96efcc8/robot_w_world.py">robot_w_world.py</a> 將 png 圖檔實踐「關鍵色透明」:<br/><br/>作法是在程式碼中額外添加像素處理的邏輯。Canvas 的 drawImage 方法本身不會自動識別並跳過特定顏色的像素，所以我們必須手動介入。<br/><br/>處理方法:<br/><br/>要讓 <a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/9f43571ec070ea3e24b083525ee27275a96efcc8/robot_w_world.py">robot_w_world.py</a> 實現這個功能，必須修改 _draw_image 方法，或者在圖片載入後進行預處理。最直接的方法是在繪製數字圖片時，讀取其像素數據，並將特定顏色（例如白色）的像素的 Alpha 值設置為 0。<br/><br/>這會涉及以下步驟：<br/><br/>    取得圖片像素資料： 將圖片繪製到一個臨時的、看不見的 Canvas 上。<br/><br/>    讀進所有像素： 讀取這個臨時 Canvas 的像素資料。<br/><br/>    修改像素的 Alpha 值： 檢查每個像素的 RGB 值，如果它符合預設的「關鍵色」（例如，純白色 (255, 255, 255)），就將其 Alpha (透明度) 值設為 0。<br/><br/>    將修改後的像素資料放回： 將修改後的像素資料重新放回臨時 Canvas。<br/><br/>    繪製臨時 Canvas： 最後，將這個處理過的臨時 Canvas 繪製到我們實際要顯示的圖層上。<br/><br/>缺點與考量:<br/><br/>    性能影響： 像素級的處理是相對耗費資源的，特別是當有很多數字需要顯示時。這可能會導致動畫或初始加載時出現輕微的延遲。<br/><br/>    複雜性增加： 程式碼會變得更複雜，需要處理 Canvas API 的 getImageData 和 putImageData 方法。<br/><br/>    關鍵色選擇： 您需要確定一個所有數字圖片背景都一致的「關鍵色」。如果有些數字圖片背景是白色，有些是淺灰色，這個方法就會失效。</p>
<h3>Harvest</h3>
<p><a href="https://mde.tw/cp2025/content/Pyodide3.html">Pyodide3</a> 在頁面中導入 <a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/9f43571ec070ea3e24b083525ee27275a96efcc8/robot_w_world.py">robot_w_world.py</a> 後，可以透過 <a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/a1de47ae2a2c941d6abe945bd58ae79ba38be8c6/pyodide3_harvest_ex1.py">pyodide3_harvest_ex1.py</a> 繼承 robot 物件，加入農作物採收功能。</p>
<p>但因為 <a href="https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/9f43571ec070ea3e24b083525ee27275a96efcc8/robot_w_world.py">robot_w_world.py</a> 版本中的 trace 繪製圖層並未獨立，除了採收農作物之後的座標背景會從 pale_grass.png 置換為 grass.png 外，農作物採收後的座標畫面刷新會一併將之前的機器人行走路徑刪除，因此後續版本必須將所有不同屬性的圖像，以各自的獨立圖層進行繪製，才不會互相影響下，產生錯誤的機器人農作物採收模擬。</p>
<p>在 Pyodide3 執行 <a href="/downloads/pyodide3_harvest_ex1.py">pyodide3_harvest_ex1.py</a>，執行<a href="https://mde.tw/cp2025/content/Pyodide3.html?src=https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/f1663c2de7f7f7a7fe24723c196810642865822f/pyodide3_harvest_ex1.py&amp;world=https://gist.githubusercontent.com/mdecycu/ec4bb35dd0769e7a83d2a9fa57878a67/raw/9f43571ec070ea3e24b083525ee27275a96efcc8/harvest3.json">結果</a>。</p>
<p></p>